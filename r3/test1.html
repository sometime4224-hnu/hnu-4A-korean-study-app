import React, { useState } from 'react';
import { Check, X, RefreshCw, ChevronRight, Award, BookOpen } from 'lucide-react';

const QuizApp = () => {
  const [currentScreen, setCurrentScreen] = useState('start'); // start, quiz, result
  const [currentQuestionIndex, setCurrentQuestionIndex] = useState(0);
  const [score, setScore] = useState(0);
  const [userAnswers, setUserAnswers] = useState({});
  const [showFeedback, setShowFeedback] = useState(false);

  const questions = [
    {
      id: 1,
      question: "이번에 새로 나온 텔레비전은 디자인이 (      ) 가격도 비싸지 않아 젊은 사람들에게 인기를 얻고 있다.",
      options: ["흔하고", "신나고", "평범하며", "독특하며"],
      answer: 3, // Index 3 -> 독특하며
      explanation: "'디자인이 ( ) 가격도 비싸지 않아 인기가 있다'는 문맥에서, 긍정적이고 차별화된 특징인 '독특하며(unique)'가 가장 적절합니다."
    },
    {
      id: 2,
      question: "도서관에서 큰 소리로 통화하는 사람 때문에 (      ). 전화 통화를 도서관 안에서 하는 것은 예의에 맞지 않는 행동이라고 본다.",
      options: ["먼저 양해를 구했다", "공부에 방해가 된다", "서로 배려하는 것이 필요하다", "불편을 주지 않아야 한다"],
      answer: 1, // Index 1 -> 공부에 방해가 된다
      explanation: "큰 소리로 통화하는 사람 때문에 생기는 부정적인 결과가 와야 하므로 '공부에 방해가 된다'가 가장 적절합니다."
    },
    {
      id: 3,
      question: "부산에 여행 갔다가 (      ) 대학교 때 친구를 만났다. 한국에서 고향 친구를 만날 거라고 생각해 본 적이 없었기 때문에 깜짝 놀랐다.",
      options: ["급히", "솔직히", "우연히", "은근히"],
      answer: 2, // Index 2 -> 우연히
      explanation: "예상치 못하게 친구를 만난 상황이므로 '우연히(coincidentally)'가 적절합니다."
    },
    {
      id: 4,
      question: "밑줄 친 부분과 의미가 비슷한 것을 고르십시오.\n\n내 전자사전이 고장이 나는 바람에 친구에게 **사전을 빌려다가** 숙제를 끝냈다.",
      options: ["사전을 빌리다가", "사전을 빌려와서", "사전을 빌린 채로", "사전을 빌렸더라면"],
      answer: 1, // Index 1 -> 사전을 빌려와서
      explanation: "'-아/어다가'는 장소를 이동하여 어떤 행동을 함을 나타냅니다. '빌려서 (집으로) 와서'라는 의미인 '빌려와서'가 가장 비슷합니다."
    },
    {
      id: 5,
      question: "밑줄 친 부분과 의미가 비슷한 것을 고르십시오.\n\n하루 종일 집 안에만 있어서 밖에 날씨가 좋은지 나쁜지 **모르겠다**.",
      options: ["날씨가 좋을 듯하다", "날씨가 좋지 않다고 본다", "날씨를 알 수가 없다", "날씨가 좋든지 나쁘든지 상관없다"],
      answer: 2, // Index 2 -> 날씨를 알 수가 없다
      explanation: "'모르겠다'는 상황을 파악할 수 없다는 뜻이므로 '알 수가 없다'와 의미가 같습니다."
    },
    {
      id: 6,
      question: "밑줄 친 부분과 의미가 비슷한 것을 고르십시오.\n\n그 친구의 도움이 **없었더라면** 무사히 대학을 졸업하지 못했을 것이다.",
      options: ["없다가는", "없었으면", "없었다더니", "없으나 마나"],
      answer: 1, // Index 1 -> 없었으면
      explanation: "가정법 과거 상황으로, 조건의 의미를 가진 '없었으면(if not for)'이 가장 유사합니다."
    },
    {
      id: 7,
      question: "최근 50대 남자가 선풍기를 켜 놓은 채로 잠을 자다가 사망했다는 신문 기사가 (      ). 선풍기 때문에 사망할 수도 있다는 생각은 과학적으로 근거가 없다고 하는데...",
      options: ["논란이 되고 있다", "현실성이 없다고 한다", "문제가 안 된다고 한다", "앞뒤가 안 맞는다고 한다"],
      answer: 0, // Index 0 -> 논란이 되고 있다
      explanation: "과학적 근거가 없는데도 기사가 계속 나와 사람들이 믿게 되는 상황은 사회적 '논란'이 되고 있는 상황입니다."
    },
    {
      id: 8,
      question: "김서영 작가의 소설 '비밀'이 영화로 만들어진다... 배우 이정민이 이 작품에 주인공으로 (      ).",
      options: ["출연을 한다", "주목을 받는다", "반응을 얻었다", "인기를 끌었다"],
      answer: 0, // Index 0 -> 출연을 한다
      explanation: "배우가 배역을 맡아 연기하는 것은 '출연을 한다'입니다."
    },
    {
      id: 9,
      question: "올해 동아리에 가입한 신입생을 위한 환영회가 열립니다... (      ) 회원 여러분께서는 꼭 참석해 주시기 바랍니다.",
      options: ["바쁘시거든", "바쁘시며", "바쁘시더라도", "바쁘셨더라면"],
      answer: 2, // Index 2 -> 바쁘시더라도
      explanation: "상황이 어렵더라도 행동을 요청할 때 쓰는 양보의 표현 '-더라도'가 적절합니다."
    },
    {
      id: 10,
      question: "아침에 급하게 나오는 바람에 깜박 잊고 창문을 (      ) 집을 나왔다.",
      options: ["열어 놓다가", "열어 놓았다가", "열어 놓더라도", "열어 놓은 채로"],
      answer: 3, // Index 3 -> 열어 놓은 채로
      explanation: "어떤 상태가 지속됨을 나타내는 '-은 채로'가 적절합니다. (창문이 열려 있는 상태로)"
    },
    {
      id: 11,
      question: "(건의문) ...하지만 대출이 안 되기 때문에... 책을 (      ) 집에서도 읽을 수 있도록 해 주시면 좋겠습니다...",
      options: ["빌려다가", "빌리거든", "빌리더라도", "빌리기는커녕"],
      answer: 0, // Index 0 -> 빌려다가
      explanation: "도서관의 책을 빌려서 장소를 이동(집)하여 읽기를 원하므로 '-어다가'가 쓰인 '빌려다가'가 맞습니다."
    },
    {
      id: 12,
      question: "노량진 수산 시장은 서울 동작구 노량진동에 위치한 시장이다. (      ) 다양한 수산물이 판매되는 곳인데...",
      options: ["생선이라는", "생선이든지", "생선이야말로", "생선을 비롯한"],
      answer: 3, // Index 3 -> 생선을 비롯한
      explanation: "대표적인 것을 예로 들고 그 외의 것들을 포함할 때 '-(을)를 비롯한'을 사용합니다."
    }
  ];

  const handleStart = () => {
    setScore(0);
    setCurrentQuestionIndex(0);
    setUserAnswers({});
    setShowFeedback(false);
    setCurrentScreen('quiz');
  };

  const handleAnswer = (optionIndex) => {
    if (showFeedback) return; // Prevent clicking while feedback is shown

    const isCorrect = optionIndex === questions[currentQuestionIndex].answer;
    setUserAnswers({
      ...userAnswers,
      [currentQuestionIndex]: optionIndex
    });

    if (isCorrect) {
      setScore(score + 1);
    }
    
    setShowFeedback(true);
  };

  const handleNext = () => {
    setShowFeedback(false);
    if (currentQuestionIndex < questions.length - 1) {
      setCurrentQuestionIndex(currentQuestionIndex + 1);
    } else {
      setCurrentScreen('result');
    }
  };

  const StartScreen = () => (
    <div className="flex flex-col items-center justify-center min-h-screen bg-blue-50 p-4 text-center animate-fade-in">
      <div className="bg-white p-8 rounded-2xl shadow-xl max-w-md w-full">
        <div className="bg-blue-100 w-20 h-20 rounded-full flex items-center justify-center mx-auto mb-6">
          <BookOpen className="w-10 h-10 text-blue-600" />
        </div>
        <h1 className="text-3xl font-bold text-gray-800 mb-2">한국어 능력 평가</h1>
        <p className="text-gray-600 mb-8">서울대학교 한국어 4A Workbook<br/>기반 모의고사</p>
        
        <div className="space-y-4 text-left bg-gray-50 p-4 rounded-lg mb-8 text-sm text-gray-600">
          <div className="flex items-center gap-2">
            <span className="bg-blue-200 text-blue-700 px-2 py-0.5 rounded text-xs font-bold">문항</span>
            <span>총 12문제</span>
          </div>
          <div className="flex items-center gap-2">
            <span className="bg-green-200 text-green-700 px-2 py-0.5 rounded text-xs font-bold">내용</span>
            <span>어휘, 문법, 읽기, 기능</span>
          </div>
          <div className="flex items-center gap-2">
            <span className="bg-purple-200 text-purple-700 px-2 py-0.5 rounded text-xs font-bold">시간</span>
            <span>제한 없음 (권장 10분)</span>
          </div>
        </div>

        <button 
          onClick={handleStart}
          className="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-4 rounded-xl transition-all transform hover:scale-105 shadow-md flex items-center justify-center gap-2"
        >
          퀴즈 시작하기
          <ChevronRight className="w-5 h-5" />
        </button>
      </div>
    </div>
  );

  const QuizScreen = () => {
    const currentQ = questions[currentQuestionIndex];
    const isAnswered = userAnswers[currentQuestionIndex] !== undefined;
    const isCorrect = isAnswered && userAnswers[currentQuestionIndex] === currentQ.answer;

    return (
      <div className="min-h-screen bg-gray-100 p-4 flex flex-col items-center">
        <div className="w-full max-w-2xl">
          {/* Progress Bar */}
          <div className="mb-6 bg-white rounded-full h-3 w-full overflow-hidden shadow-sm">
            <div 
              className="bg-blue-500 h-full transition-all duration-500 ease-out"
              style={{ width: `${((currentQuestionIndex) / questions.length) * 100}%` }}
            ></div>
          </div>

          {/* Question Card */}
          <div className="bg-white rounded-2xl shadow-lg p-6 md:p-8 mb-6">
            <div className="flex justify-between items-center mb-4">
              <span className="text-sm font-bold text-blue-500 tracking-widest">QUESTION {currentQuestionIndex + 1} / {questions.length}</span>
              <span className="text-xs bg-gray-100 text-gray-500 px-2 py-1 rounded-md">빈칸 / 유의어 찾기</span>
            </div>
            
            <h2 className="text-xl md:text-2xl font-bold text-gray-800 leading-relaxed mb-8 whitespace-pre-wrap">
              {currentQ.question}
            </h2>

            <div className="space-y-3">
              {currentQ.options.map((option, idx) => {
                let btnClass = "w-full p-4 text-left rounded-xl border-2 transition-all duration-200 font-medium flex justify-between items-center ";
                
                if (!isAnswered) {
                  btnClass += "border-gray-200 hover:border-blue-400 hover:bg-blue-50 bg-white text-gray-700";
                } else {
                  if (idx === currentQ.answer) {
                    btnClass += "border-green-500 bg-green-50 text-green-700 shadow-sm";
                  } else if (idx === userAnswers[currentQuestionIndex]) {
                    btnClass += "border-red-500 bg-red-50 text-red-700";
                  } else {
                    btnClass += "border-gray-100 bg-gray-50 text-gray-400";
                  }
                }

                return (
                  <button 
                    key={idx} 
                    onClick={() => !isAnswered && handleAnswer(idx)}
                    disabled={isAnswered}
                    className={btnClass}
                  >
                    <span className="flex items-center gap-3">
                      <span className={`w-6 h-6 rounded-full flex items-center justify-center text-xs border ${
                        !isAnswered ? 'border-gray-300 text-gray-500' :
                        idx === currentQ.answer ? 'border-green-500 bg-green-500 text-white' :
                        idx === userAnswers[currentQuestionIndex] ? 'border-red-500 bg-red-500 text-white' :
                        'border-gray-200 text-gray-300'
                      }`}>
                        {idx + 1}
                      </span>
                      {option}
                    </span>
                    {isAnswered && idx === currentQ.answer && <Check className="w-5 h-5 text-green-600" />}
                    {isAnswered && idx === userAnswers[currentQuestionIndex] && idx !== currentQ.answer && <X className="w-5 h-5 text-red-600" />}
                  </button>
                );
              })}
            </div>

            {/* Feedback Section */}
            {showFeedback && (
              <div className="mt-6 pt-6 border-t border-gray-100 animate-fade-in-up">
                <div className={`p-4 rounded-lg mb-4 ${isCorrect ? 'bg-green-50 border border-green-100' : 'bg-red-50 border border-red-100'}`}>
                  <div className="flex items-center gap-2 mb-2">
                    {isCorrect ? 
                      <Check className="w-5 h-5 text-green-600" /> : 
                      <X className="w-5 h-5 text-red-600" />
                    }
                    <span className={`font-bold ${isCorrect ? 'text-green-700' : 'text-red-700'}`}>
                      {isCorrect ? '정답입니다!' : '오답입니다.'}
                    </span>
                  </div>
                  <p className="text-gray-700 text-sm leading-relaxed">
                    <span className="font-semibold text-gray-900">해설:</span> {currentQ.explanation}
                  </p>
                </div>
                <button 
                  onClick={handleNext}
                  className="w-full bg-blue-600 text-white font-bold py-3 rounded-xl shadow-md hover:bg-blue-700 transition-colors flex items-center justify-center gap-2"
                >
                  {currentQuestionIndex < questions.length - 1 ? '다음 문제' : '결과 보기'}
                  <ChevronRight className="w-5 h-5" />
                </button>
              </div>
            )}
          </div>
        </div>
      </div>
    );
  };

  const ResultScreen = () => {
    const percentage = Math.round((score / questions.length) * 100);
    let message = "";
    let colorClass = "";

    if (percentage >= 90) {
      message = "완벽해요! 뛰어난 한국어 실력입니다.";
      colorClass = "text-blue-600";
    } else if (percentage >= 70) {
      message = "훌륭해요! 조금만 더 노력하면 만점이겠네요.";
      colorClass = "text-green-600";
    } else {
      message = "수고하셨습니다! 오답 노트를 확인해보세요.";
      colorClass = "text-orange-600";
    }

    return (
      <div className="min-h-screen bg-gray-50 p-4 md:p-8">
        <div className="max-w-3xl mx-auto">
          <div className="bg-white rounded-3xl shadow-xl overflow-hidden mb-8">
            <div className="bg-blue-600 p-8 text-center text-white">
              <div className="bg-white/20 w-24 h-24 rounded-full flex items-center justify-center mx-auto mb-4 backdrop-blur-sm">
                <Award className="w-12 h-12 text-white" />
              </div>
              <h2 className="text-3xl font-bold mb-2">퀴즈 결과</h2>
              <div className="text-6xl font-extrabold mb-2 tracking-tight">
                {score}<span className="text-3xl text-blue-200 font-normal">/{questions.length}</span>
              </div>
              <p className="text-blue-100 font-medium">{message}</p>
            </div>
            
            <div className="p-8">
              <h3 className="text-xl font-bold text-gray-800 mb-6 flex items-center gap-2">
                <BookOpen className="w-5 h-5 text-blue-500" />
                문제 다시보기
              </h3>
              
              <div className="space-y-4">
                {questions.map((q, idx) => {
                  const isUserCorrect = userAnswers[idx] === q.answer;
                  return (
                    <div key={q.id} className={`border rounded-xl p-5 ${isUserCorrect ? 'bg-white border-gray-200' : 'bg-red-50 border-red-200'}`}>
                      <div className="flex justify-between items-start gap-3 mb-3">
                        <div className="flex items-center gap-3">
                          <span className={`flex-shrink-0 w-8 h-8 flex items-center justify-center rounded-full font-bold text-sm ${isUserCorrect ? 'bg-green-100 text-green-700' : 'bg-red-100 text-red-700'}`}>
                            {idx + 1}
                          </span>
                          <span className={`font-bold text-sm ${isUserCorrect ? 'text-green-600' : 'text-red-600'}`}>
                            {isUserCorrect ? '정답' : '오답'}
                          </span>
                        </div>
                      </div>
                      <p className="text-gray-800 font-medium mb-3 pl-11 text-sm md:text-base leading-relaxed">
                        {q.question}
                      </p>
                      <div className="pl-11 text-sm space-y-1">
                        <div className="text-gray-500">
                          내가 고른 답: <span className={`font-medium ${isUserCorrect ? 'text-green-600' : 'text-red-600 line-through'}`}>{q.options[userAnswers[idx]]}</span>
                        </div>
                        {!isUserCorrect && (
                          <div className="text-blue-600 font-bold">
                            정답: {q.options[q.answer]}
                          </div>
                        )}
                        <div className="mt-3 bg-gray-50 p-3 rounded-lg text-gray-600 text-xs md:text-sm">
                          <span className="font-bold text-gray-700">해설:</span> {q.explanation}
                        </div>
                      </div>
                    </div>
                  );
                })}
              </div>

              <button 
                onClick={handleStart}
                className="mt-8 w-full bg-gray-800 hover:bg-gray-900 text-white font-bold py-4 rounded-xl transition-all shadow-md flex items-center justify-center gap-2"
              >
                <RefreshCw className="w-5 h-5" />
                다시 풀기
              </button>
            </div>
          </div>
        </div>
      </div>
    );
  };

  return (
    <div className="font-sans">
      {currentScreen === 'start' && <StartScreen />}
      {currentScreen === 'quiz' && <QuizScreen />}
      {currentScreen === 'result' && <ResultScreen />}
      
      <style jsx global>{`
        @keyframes fadeIn {
          from { opacity: 0; transform: translateY(10px); }
          to { opacity: 1; transform: translateY(0); }
        }
        .animate-fade-in {
          animation: fadeIn 0.5s ease-out forwards;
        }
        .animate-fade-in-up {
          animation: fadeIn 0.3s ease-out forwards;
        }
      `}</style>
    </div>
  );
};

export default QuizApp;
