<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>í•œêµ­ì–´ ì–´íœ˜ í€´ì¦ˆ</title>
    <!-- Tailwind CSS ë¡œë“œ -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Inter í°íŠ¸ ë¡œë“œ -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <!-- Noto Sans KR í°íŠ¸ (í•œêµ­ì–´ìš©) -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700&display=swap" rel="stylesheet">
    
    <style>
        /* ê¸°ë³¸ í°íŠ¸ ì„¤ì • */
        body {
            font-family: 'Noto Sans KR', 'Inter', sans-serif;
        }
        
        /* ì„ íƒëœ ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
        .option-btn.selected {
            background-color: #3b82f6; /* bg-blue-600 */
            color: white;
            border-color: #3b82f6; /* border-blue-600 */
        }
        
        /* ì •ë‹µ ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
        .option-btn.correct {
            background-color: #22c55e; /* bg-green-500 */
            color: white;
            border-color: #22c55e; /* border-green-500 */
        }
        
        /* ì˜¤ë‹µ ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
        .option-btn.incorrect {
            background-color: #ef4444; /* bg-red-500 */
            color: white;
            border-color: #ef4444; /* border-red-500 */
        }
    </style>
</head>
<body class="bg-gray-100 min-h-screen flex items-center justify-center p-4">

    <div class="bg-white w-full max-w-2xl rounded-2xl shadow-xl p-6 md:p-8">
        
        <!-- ë¡œë”© ìŠ¤í”¼ë„ˆ -->
        <div id="loading" class="text-center p-8">
            <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500 mx-auto"></div>
            <p class="mt-4 text-gray-600">í€´ì¦ˆë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ì…ë‹ˆë‹¤...</p>
        </div>

        <!-- í€´ì¦ˆ ì»¨í…Œì´ë„ˆ (ì²˜ìŒì—ëŠ” ìˆ¨ê¹€) -->
        <div id="quiz-app" class="hidden">
            
            <!-- í€´ì¦ˆ ì„¹ì…˜ -->
            <div id="quiz-container">
                <h1 class="text-2xl md:text-3xl font-bold text-center text-blue-600 mb-6">í•œêµ­ì–´ ì–´íœ˜ í€´ì¦ˆ</h1>
                
                <!-- ì§ˆë¬¸ í‘œì‹œ -->
                <div id="question-container" class="mb-6 min-h-[100px]">
                    <div class="flex justify-between items-center mb-4">
                        <span class="text-lg font-semibold text-gray-700">ë¬¸ì œ <span id="question-number">1</span> / <span id="total-questions">15</span></span>
                        <!-- 'question-word'ë¥¼ í‘œì‹œí•˜ë˜ spanì„ ìˆ¨ê¹€ ì²˜ë¦¬ (hidden í´ë˜ìŠ¤ ì¶”ê°€) -->
                        <span id="question-word" class="hidden text-xl md:text-2xl font-bold text-blue-700 bg-blue-50 p-2 rounded-lg"></span>
                    </div>
                    <p id="question-text" class="text-lg md:text-xl text-gray-800 leading-relaxed"></p>
                </div>
                
                <!-- ì„ íƒì§€ ë²„íŠ¼ -->
                <div id="options-container" class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                    <!-- Javascriptë¡œ ë²„íŠ¼ ìƒì„± -->
                </div>
                
                <!-- ë„¤ë¹„ê²Œì´ì…˜ ë²„íŠ¼ -->
                <div class="flex justify-between">
                    <button id="prev-btn" class="bg-gray-300 hover:bg-gray-400 text-gray-800 font-bold py-2 px-6 rounded-lg transition duration-200 disabled:opacity-50">ì´ì „</button>
                    <button id="next-btn" class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-6 rounded-lg transition duration-200">ë‹¤ìŒ</button>
                    <button id="submit-btn" class="bg-green-500 hover:bg-green-600 text-white font-bold py-2 px-6 rounded-lg transition duration-200 hidden">ì±„ì í•˜ê¸°</button>
                </div>
            </div>

            <!-- ê²°ê³¼ ì„¹ì…˜ (ì²˜ìŒì—ëŠ” ìˆ¨ê¹€) -->
            <div id="result-container" class="hidden text-center">
                <h2 class="text-3xl font-bold text-blue-600 mb-4">í€´ì¦ˆ ê²°ê³¼</h2>
                <p class="text-5xl font-bold mb-6">
                    <span id="score" class="text-green-500">0</span> / <span id="total-score">15</span>
                </p>
                <p id="score-message" class="text-xl text-gray-700 mb-8"></p>
                
                <!-- í‹€ë¦° ë¬¸ì œ í”¼ë“œë°± -->
                <div id="feedback-container" class="text-left bg-gray-50 p-4 rounded-lg">
                    <h3 class="text-xl font-semibold mb-4 text-red-600">í‹€ë¦° ë¬¸ì œ ë‹¤ì‹œ ë³´ê¸°</h3>
                    <div id="feedback-list" class="space-y-4">
                        <!-- Javascriptë¡œ í”¼ë“œë°± ë‚´ìš© ì¶”ê°€ -->
                    </div>
                </div>
                
                <button id="restart-btn" class="mt-8 bg-blue-500 hover:bg-blue-600 text-white font-bold py-3 px-8 rounded-lg transition duration-200">ë‹¤ì‹œ í’€ê¸°</button>
            </div>
            
        </div>
        
        <!-- ì´ì „ ê¸°ë¡ ì„¹ì…˜ -->
        <div id="previous-results-container" class="mt-8 pt-6 border-t border-gray-200 hidden">
            <h3 class="text-xl font-semibold text-gray-700 mb-4">ë‚˜ì˜ í€´ì¦ˆ ê¸°ë¡ ğŸ“</h3>
            <div id="results-list" class="space-y-2 max-h-40 overflow-y-auto">
                <p id="no-results" class="text-gray-500">ì•„ì§ ì €ì¥ëœ ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤.</p>
                <!-- Javascriptë¡œ ê¸°ë¡ ì¶”ê°€ -->
            </div>
        </div>

    </div>

    <!-- Firebase SDK -->
    <script type="module">
        // Firebase ëª¨ë“ˆ ê°€ì ¸ì˜¤ê¸°
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { 
            getAuth, 
            signInAnonymously, 
            signInWithCustomToken, 
            onAuthStateChanged,
            setPersistence,
            browserSessionPersistence
        } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { 
            getFirestore, 
            doc, 
            collection, 
            addDoc, 
            getDocs, 
            query,
            onSnapshot,
            serverTimestamp,
            setLogLevel
        } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // Firebase ì„¤ì • (Canvas í™˜ê²½ ë³€ìˆ˜ ì‚¬ìš©)
        const firebaseConfig = JSON.parse(typeof __firebase_config !== 'undefined' ? __firebase_config : '{}');
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-korean-quiz-app';
        const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;

        // Firebase ì•±, ì¸ì¦, Firestore ì´ˆê¸°í™”
        let app, auth, db;
        let userId = null; // ì‚¬ìš©ì ID
        let resultsCollectionPath = ''; // Firestore ì €ì¥ ê²½ë¡œ
        let unsubscribeResults = null; // onSnapshot êµ¬ë… ì·¨ì†Œ í•¨ìˆ˜

        // Firestore ë¡œê¹… ì„¤ì • (ë””ë²„ê¹…ìš©)
        setLogLevel('Debug');

        // í€´ì¦ˆ ë°ì´í„° (ì†ë‹´ ë° ê´€ìš©ì–´ë¡œ ë³€ê²½)
        const quizData = [
            // --- ì†ë‹´ (Proverbs) ---
            {
                word: "ì½© ì‹¬ì€ ë° ì½© ë‚œë‹¤",
                question: "ë‹¤ìŒ ì¤‘ 'ì½© ì‹¬ì€ ë° ì½© ë‚œë‹¤' ì†ë‹´ì„ ì‚¬ìš©í•˜ê¸° ì¢‹ì€ ìƒí™©ì€ ë¬´ì—‡ì¸ê°€ìš”?",
                options: [
                    "ì—´ì‹¬íˆ ê³µë¶€í–ˆë”ë‹ˆ ì‹œí—˜ì„ ì˜ ë´¤ì–´ìš”.", 
                    "ìì „ê±°ë¥¼ ìƒì–´ë²„ë¦° í›„ì— ìë¬¼ì‡ ë¥¼ ìƒ€ì–´ìš”.", 
                    "ìš”ë¦¬ì‚¬ê°€ ìš”ë¦¬í•˜ë‹¤ê°€ ìŒì‹ì„ íƒœì› ì–´ìš”.", 
                    "ì—„ë§ˆì™€ ì•„ë¹ ê°€ ì‹¸ìš°ëŠ”ë° ë‚˜ë§Œ í˜¼ë‚¬ì–´ìš”."
                ],
                answer: "ì—´ì‹¬íˆ ê³µë¶€í–ˆë”ë‹ˆ ì‹œí—˜ì„ ì˜ ë´¤ì–´ìš”.",
                feedback: "'ì½© ì‹¬ì€ ë° ì½© ë‚œë‹¤'ëŠ” ì›ì¸ëŒ€ë¡œ ê²°ê³¼ê°€ ë‚˜ì˜¨ë‹¤ëŠ” ëœ»ì…ë‹ˆë‹¤. ì—´ì‹¬íˆ ë…¸ë ¥í–ˆìœ¼ë‹ˆ ì¢‹ì€ ê²°ê³¼ê°€ ë‚˜ì˜¨ ìƒí™©ì— ì”ë‹ˆë‹¤."
            },
            {
                word: "ê°œêµ¬ë¦¬ ì˜¬ì±™ì´ ì  ìƒê° ëª» í•œë‹¤",
                question: "ë‹¤ìŒ ì¤‘ 'ê°œêµ¬ë¦¬ ì˜¬ì±™ì´ ì  ìƒê° ëª» í•œë‹¤' ì†ë‹´ì„ ì‚¬ìš©í•˜ê¸° ì¢‹ì€ ìƒí™©ì€ ë¬´ì—‡ì¸ê°€ìš”?",
                options: [
                    "ë¶€ìê°€ ëœ í›„ì—, ê°€ë‚œí–ˆë˜ ë•Œë¥¼ ìŠê³  ë‹¤ë¥¸ ì‚¬ëŒì„ ë¬´ì‹œí•´ìš”.", 
                    "ì–´ë¦´ ë•Œë¶€í„° ì†í†±ì„ ë¬¼ì–´ëœ¯ì—ˆëŠ”ë°, ì–´ë¥¸ì´ ë˜ì–´ì„œë„ ê³ ì¹˜ê¸° ì–´ë ¤ì›Œìš”.", 
                    "ê°€ì¥ ì¹œí•œ ì¹œêµ¬ê°€ ë‚´ ë¹„ë°€ì„ ë‹¤ë¥¸ ì‚¬ëŒì—ê²Œ ë§í–ˆì–´ìš”.", 
                    "ìš”ë¦¬ì‚¬ê°€ ìš”ë¦¬í•˜ë‹¤ê°€ ìŒì‹ì„ íƒœì› ì–´ìš”."
                ],
                answer: "ë¶€ìê°€ ëœ í›„ì—, ê°€ë‚œí–ˆë˜ ë•Œë¥¼ ìŠê³  ë‹¤ë¥¸ ì‚¬ëŒì„ ë¬´ì‹œí•´ìš”.",
                feedback: "'ê°œêµ¬ë¦¬ ì˜¬ì±™ì´ ì  ìƒê° ëª» í•œë‹¤'ëŠ” ìì‹ ì´ ë¶€ì¡±í–ˆë˜ ì˜›ë‚ ì„ ìŠì–´ë²„ë¦¬ê³  ì˜ë‚œ ì²™í•˜ëŠ” ìƒí™©ì— ì”ë‹ˆë‹¤."
            },
            {
                word: "ì†Œ ìƒê³  ì™¸ì–‘ê°„ ê³ ì¹œë‹¤",
                question: "ë‹¤ìŒ ì¤‘ 'ì†Œ ìƒê³  ì™¸ì–‘ê°„ ê³ ì¹œë‹¤' ì†ë‹´ì„ ì‚¬ìš©í•˜ê¸° ì¢‹ì€ ìƒí™©ì€ ë¬´ì—‡ì¸ê°€ìš”?",
                options: [
                    "ìì „ê±°ë¥¼ ìƒì–´ë²„ë¦° í›„ì— ìë¬¼ì‡ ë¥¼ ìƒ€ì–´ìš”.", 
                    "ì—´ì‹¬íˆ ê³µë¶€í–ˆë”ë‹ˆ ì‹œí—˜ì„ ì˜ ë´¤ì–´ìš”.", 
                    "íšŒì‚¬ì—ì„œ í˜¼ë‚˜ê³  ì§‘ì— ì™€ì„œ ë™ìƒì—ê²Œ í™”ë¥¼ ëƒˆì–´ìš”.", 
                    "ì—„ë§ˆì™€ ì•„ë¹ ê°€ ì‹¸ìš°ëŠ”ë° ë‚˜ë§Œ í˜¼ë‚¬ì–´ìš”."
                ],
                answer: "ìì „ê±°ë¥¼ ìƒì–´ë²„ë¦° í›„ì— ìë¬¼ì‡ ë¥¼ ìƒ€ì–´ìš”.",
                feedback: "'ì†Œ ìƒê³  ì™¸ì–‘ê°„ ê³ ì¹œë‹¤'ëŠ” ì¼ì´ ì´ë¯¸ ì˜ëª»ëœ í›„ì— ê³ ì¹˜ë ¤ê³  í•´ì„œ ì†Œìš©ì´ ì—†ëŠ” ìƒí™©ì— ì”ë‹ˆë‹¤."
            },
            {
                word: "ê³ ë˜ ì‹¸ì›€ì— ìƒˆìš° ë“± í„°ì§„ë‹¤",
                question: "ë‹¤ìŒ ì¤‘ 'ê³ ë˜ ì‹¸ì›€ì— ìƒˆìš° ë“± í„°ì§„ë‹¤' ì†ë‹´ì„ ì‚¬ìš©í•˜ê¸° ì¢‹ì€ ìƒí™©ì€ ë¬´ì—‡ì¸ê°€ìš”?",
                options: [
                    "ì—„ë§ˆì™€ ì•„ë¹ ê°€ ì‹¸ìš°ëŠ”ë°, ì˜ëª» ì—†ëŠ” ë‚˜ë§Œ í˜¼ë‚¬ì–´ìš”.", 
                    "ê°€ì¥ ì¹œí•œ ì¹œêµ¬ê°€ ë‚´ ë¹„ë°€ì„ ë‹¤ë¥¸ ì‚¬ëŒì—ê²Œ ë§í–ˆì–´ìš”.", 
                    "ë¶€ìê°€ ëœ í›„ì—, ê°€ë‚œí–ˆë˜ ë•Œë¥¼ ìŠê³  ë‹¤ë¥¸ ì‚¬ëŒì„ ë¬´ì‹œí•´ìš”.", 
                    "ì—´ì‹¬íˆ ê³µë¶€í–ˆë”ë‹ˆ ì‹œí—˜ì„ ì˜ ë´¤ì–´ìš”."
                ],
                answer: "ì—„ë§ˆì™€ ì•„ë¹ ê°€ ì‹¸ìš°ëŠ”ë°, ì˜ëª» ì—†ëŠ” ë‚˜ë§Œ í˜¼ë‚¬ì–´ìš”.",
                feedback: "'ê³ ë˜ ì‹¸ì›€ì— ìƒˆìš° ë“± í„°ì§„ë‹¤'ëŠ” í˜ì´ ì„¼ ì‚¬ëŒë“¤ ì‹¸ì›€ì— ì•½í•œ ì‚¬ëŒì´ í”¼í•´ë¥¼ ë³´ëŠ” ìƒí™©ì— ì”ë‹ˆë‹¤."
            },
            {
                word: "ì„¸ ì‚´ ë²„ë¦‡ ì—¬ë“ ê¹Œì§€ ê°„ë‹¤",
                question: "ë‹¤ìŒ ì¤‘ 'ì„¸ ì‚´ ë²„ë¦‡ ì—¬ë“ ê¹Œì§€ ê°„ë‹¤' ì†ë‹´ì„ ì‚¬ìš©í•˜ê¸° ì¢‹ì€ ìƒí™©ì€ ë¬´ì—‡ì¸ê°€ìš”?",
                options: [
                    "ì–´ë¦´ ë•Œë¶€í„° ì†í†±ì„ ë¬¼ì–´ëœ¯ì—ˆëŠ”ë°, ì–´ë¥¸ì´ ë˜ì–´ì„œë„ ê³ ì¹˜ê¸° ì–´ë ¤ì›Œìš”.", 
                    "ìš”ë¦¬ì‚¬ê°€ ìš”ë¦¬í•˜ë‹¤ê°€ ìŒì‹ì„ íƒœì› ì–´ìš”.", 
                    "ìì „ê±°ë¥¼ ìƒì–´ë²„ë¦° í›„ì— ìë¬¼ì‡ ë¥¼ ìƒ€ì–´ìš”.", 
                    "ê°€ì¥ ì¹œí•œ ì¹œêµ¬ê°€ ë‚´ ë¹„ë°€ì„ ë‹¤ë¥¸ ì‚¬ëŒì—ê²Œ ë§í–ˆì–´ìš”."
                ],
                answer: "ì–´ë¦´ ë•Œë¶€í„° ì†í†±ì„ ë¬¼ì–´ëœ¯ì—ˆëŠ”ë°, ì–´ë¥¸ì´ ë˜ì–´ì„œë„ ê³ ì¹˜ê¸° ì–´ë ¤ì›Œìš”.",
                feedback: "'ì„¸ ì‚´ ë²„ë¦‡ ì—¬ë“ ê¹Œì§€ ê°„ë‹¤'ëŠ” ì–´ë¦´ ë•Œ ìƒê¸´ ë‚˜ìœ ìŠµê´€ì€ ê³ ì¹˜ê¸° ì–´ë µë‹¤ëŠ” ëœ»ì…ë‹ˆë‹¤."
            },
            {
                word: "ë¯¿ëŠ” ë„ë¼ì— ë°œë“± ì°íŒë‹¤",
                question: "ë‹¤ìŒ ì¤‘ 'ë¯¿ëŠ” ë„ë¼ì— ë°œë“± ì°íŒë‹¤' ì†ë‹´ì„ ì‚¬ìš©í•˜ê¸° ì¢‹ì€ ìƒí™©ì€ ë¬´ì—‡ì¸ê°€ìš”?",
                options: [
                    "ê°€ì¥ ì¹œí•œ ì¹œêµ¬ê°€ ë‚´ ë¹„ë°€ì„ ë‹¤ë¥¸ ì‚¬ëŒì—ê²Œ ë§í–ˆì–´ìš”.", 
                    "ì—„ë§ˆì™€ ì•„ë¹ ê°€ ì‹¸ìš°ëŠ”ë°, ì˜ëª» ì—†ëŠ” ë‚˜ë§Œ í˜¼ë‚¬ì–´ìš”.", 
                    "ì—´ì‹¬íˆ ê³µë¶€í–ˆë”ë‹ˆ ì‹œí—˜ì„ ì˜ ë´¤ì–´ìš”.", 
                    "ë¶€ìê°€ ëœ í›„ì—, ê°€ë‚œí–ˆë˜ ë•Œë¥¼ ìŠê³  ë‹¤ë¥¸ ì‚¬ëŒì„ ë¬´ì‹œí•´ìš”."
                ],
                answer: "ê°€ì¥ ì¹œí•œ ì¹œêµ¬ê°€ ë‚´ ë¹„ë°€ì„ ë‹¤ë¥¸ ì‚¬ëŒì—ê²Œ ë§í–ˆì–´ìš”.",
                feedback: "'ë¯¿ëŠ” ë„ë¼ì— ë°œë“± ì°íŒë‹¤'ëŠ” ë‚´ê°€ ë¯¿ì—ˆë˜ ì‚¬ëŒì—ê²Œ ë°°ì‹ ì„ ë‹¹í•œ ìƒí™©ì— ì”ë‹ˆë‹¤."
            },
            {
                word: "ì›ìˆ­ì´ë„ ë‚˜ë¬´ì—ì„œ ë–¨ì–´ì§„ë‹¤",
                question: "ë‹¤ìŒ ì¤‘ 'ì›ìˆ­ì´ë„ ë‚˜ë¬´ì—ì„œ ë–¨ì–´ì§„ë‹¤' ì†ë‹´ì„ ì‚¬ìš©í•˜ê¸° ì¢‹ì€ ìƒí™©ì€ ë¬´ì—‡ì¸ê°€ìš”?",
                options: [
                    "ë§¤ì¼ ìš”ë¦¬í•˜ëŠ” ìš”ë¦¬ì‚¬ê°€ ì˜¤ëŠ˜ ìŒì‹ì„ íƒœì› ì–´ìš”.", 
                    "ì–´ë¦´ ë•Œë¶€í„° ìƒê¸´ ë‚˜ìœ ìŠµê´€ì„ ê³ ì¹˜ê¸° ì–´ë ¤ì›Œìš”.", 
                    "ìì „ê±°ë¥¼ ìƒì–´ë²„ë¦° í›„ì— ìë¬¼ì‡ ë¥¼ ìƒ€ì–´ìš”.", 
                    "íšŒì‚¬ì—ì„œ í˜¼ë‚˜ê³  ì§‘ì— ì™€ì„œ ë™ìƒì—ê²Œ í™”ë¥¼ ëƒˆì–´ìš”."
                ],
                answer: "ë§¤ì¼ ìš”ë¦¬í•˜ëŠ” ìš”ë¦¬ì‚¬ê°€ ì˜¤ëŠ˜ ìŒì‹ì„ íƒœì› ì–´ìš”.",
                feedback: "'ì›ìˆ­ì´ë„ ë‚˜ë¬´ì—ì„œ ë–¨ì–´ì§„ë‹¤'ëŠ” ì•„ë¬´ë¦¬ ì˜í•˜ëŠ” ì‚¬ëŒë„ ì‹¤ìˆ˜í•  ìˆ˜ ìˆë‹¤ëŠ” ëœ»ì…ë‹ˆë‹¤."
            },
            {
                word: "ì¢…ë¡œì—ì„œ ëº¨ ë§ê³  í•œê°•ì—ì„œ í™”í’€ì´í•œë‹¤",
                question: "ë‹¤ìŒ ì¤‘ 'ì¢…ë¡œì—ì„œ ëº¨ ë§ê³  í•œê°•ì—ì„œ í™”í’€ì´í•œë‹¤' ì†ë‹´ì„ ì‚¬ìš©í•˜ê¸° ì¢‹ì€ ìƒí™©ì€ ë¬´ì—‡ì¸ê°€ìš”?",
                options: [
                    "íšŒì‚¬ì—ì„œ ìƒì‚¬ì—ê²Œ í˜¼ë‚˜ê³ , ì§‘ì— ì™€ì„œ ë™ìƒì—ê²Œ í™”ë¥¼ ëƒˆì–´ìš”.", 
                    "ê°€ì¥ ì¹œí•œ ì¹œêµ¬ê°€ ë‚´ ë¹„ë°€ì„ ë‹¤ë¥¸ ì‚¬ëŒì—ê²Œ ë§í–ˆì–´ìš”.", 
                    "ë¶€ìê°€ ëœ í›„ì—, ê°€ë‚œí–ˆë˜ ë•Œë¥¼ ìŠê³  ë‹¤ë¥¸ ì‚¬ëŒì„ ë¬´ì‹œí•´ìš”.", 
                    "ì—„ë§ˆì™€ ì•„ë¹ ê°€ ì‹¸ìš°ëŠ”ë°, ì˜ëª» ì—†ëŠ” ë‚˜ë§Œ í˜¼ë‚¬ì–´ìš”."
                ],
                answer: "íšŒì‚¬ì—ì„œ ìƒì‚¬ì—ê²Œ í˜¼ë‚˜ê³ , ì§‘ì— ì™€ì„œ ë™ìƒì—ê²Œ í™”ë¥¼ ëƒˆì–´ìš”.",
                feedback: "'ì¢…ë¡œì—ì„œ ëº¨ ë§ê³  í•œê°•ì—ì„œ í™”í’€ì´í•œë‹¤'ëŠ” ë‹¤ë¥¸ ê³³ì—ì„œ ìƒê¸´ í™”ë¥¼ ê´€ê³„ì—†ëŠ” ì‚¬ëŒì—ê²Œ í‘¸ëŠ” ìƒí™©ì— ì”ë‹ˆë‹¤."
            },

            // --- ê´€ìš©ì–´ (Idioms) ---
            {
                word: "ì†ì´ ëª¨ìë¼ë‹¤",
                question: "ë‹¤ìŒ ì¤‘ 'ì†ì´ ëª¨ìë¼ë‹¤' í‘œí˜„ì„ ì‚¬ìš©í•˜ê¸° ì¢‹ì€ ìƒí™©ì€ ë¬´ì—‡ì¸ê°€ìš”?",
                options: [
                    "ì‹ë‹¹ì— ì†ë‹˜ì´ ë„ˆë¬´ ë§ì•„ì„œ ì¼í•  ì‚¬ëŒì´ ë” í•„ìš”í•´ìš”.", 
                    "ê·¸ ì‚¬ëŒì€ 1ì‹œê°„ ê±¸ë¦´ ì¼ì„ 30ë¶„ ë§Œì— ëëƒˆì–´ìš”.", 
                    "ì–´ë””ë¥¼ ê°€ë„ ì•„ëŠ” ì‚¬ëŒì´ ì •ë§ ë§ì•„ìš”.", 
                    "ìŒì‹ì„ ì¡°ê¸ˆë§Œ í•˜ë ¤ê³  í–ˆëŠ”ë°, í•­ìƒ ë„ˆë¬´ ë§ì´ ë§Œë“¤ì–´ìš”."
                ],
                answer: "ì‹ë‹¹ì— ì†ë‹˜ì´ ë„ˆë¬´ ë§ì•„ì„œ ì¼í•  ì‚¬ëŒì´ ë” í•„ìš”í•´ìš”.",
                feedback: "'ì†ì´ ëª¨ìë¼ë‹¤'ëŠ” ì¼í•  ì‚¬ëŒì´ ë¶€ì¡±í•˜ë‹¤ëŠ” ëœ»ì…ë‹ˆë‹¤."
            },
            {
                word: "ì†ì´ ë¹ ë¥´ë‹¤",
                question: "ë‹¤ìŒ ì¤‘ 'ì†ì´ ë¹ ë¥´ë‹¤' í‘œí˜„ì„ ì‚¬ìš©í•˜ê¸° ì¢‹ì€ ìƒí™©ì€ ë¬´ì—‡ì¸ê°€ìš”?",
                options: [
                    "ê·¸ ì‚¬ëŒì€ 1ì‹œê°„ ê±¸ë¦´ ì¼ì„ 30ë¶„ ë§Œì— ëëƒˆì–´ìš”.", 
                    "ë¹„ë°€ ì´ì•¼ê¸°ë¥¼ í•´ë„ ë‹¤ë¥¸ ì‚¬ëŒì—ê²Œ ì ˆëŒ€ ë§í•˜ì§€ ì•Šì•„ìš”.", 
                    "ë‹¤ë¥¸ ì‚¬ëŒì˜ ë§ì„ ë„ˆë¬´ ì‰½ê²Œ ë¯¿ê³ , ë¬¼ê±´ì„ ê¸ˆë°© ì‚¬ìš”.", 
                    "ì§€ê¸ˆ ë‹¹ì¥ ì—¬í–‰ì„ ë– ë‚˜ê³  ì‹¶ì–´ìš”."
                ],
                answer: "ê·¸ ì‚¬ëŒì€ 1ì‹œê°„ ê±¸ë¦´ ì¼ì„ 30ë¶„ ë§Œì— ëëƒˆì–´ìš”.",
                feedback: "'ì†ì´ ë¹ ë¥´ë‹¤'ëŠ” ì¼ì„ ì•„ì£¼ ë¹¨ë¦¬ ì˜í•œë‹¤ëŠ” ëœ»ì…ë‹ˆë‹¤."
            },
            {
                word: "ë°œì´ ë„“ë‹¤",
                question: "ë‹¤ìŒ ì¤‘ 'ë°œì´ ë„“ë‹¤' í‘œí˜„ì„ ì‚¬ìš©í•˜ê¸° ì¢‹ì€ ìƒí™©ì€ ë¬´ì—‡ì¸ê°€ìš”?",
                options: [
                    "ê·¸ ì‚¬ëŒì€ ì–´ë””ë¥¼ ê°€ë„ ì•„ëŠ” ì‚¬ëŒì´ ì •ë§ ë§ì•„ìš”.", 
                    "ì‹ë‹¹ì— ì†ë‹˜ì´ ë„ˆë¬´ ë§ì•„ì„œ ì¼í•  ì‚¬ëŒì´ ë” í•„ìš”í•´ìš”.", 
                    "ì‡¼í•‘ì„ ì˜¤ë˜ í–ˆì§€ë§Œ, ë§ˆìŒì— ë“œëŠ” ì˜·ì´ í•˜ë‚˜ë„ ì—†ì–´ìš”.", 
                    "ìŒì‹ì„ ì¡°ê¸ˆë§Œ í•˜ë ¤ê³  í–ˆëŠ”ë°, í•­ìƒ ë„ˆë¬´ ë§ì´ ë§Œë“¤ì–´ìš”."
                ],
                answer: "ê·¸ ì‚¬ëŒì€ ì–´ë””ë¥¼ ê°€ë„ ì•„ëŠ” ì‚¬ëŒì´ ì •ë§ ë§ì•„ìš”.",
                feedback: "'ë°œì´ ë„“ë‹¤'ëŠ” ì•„ëŠ” ì‚¬ëŒì´ ë§ê³  ì‚¬ëŒë“¤ê³¼ ê´€ê³„ê°€ ì¢‹ë‹¤ëŠ” ëœ»ì…ë‹ˆë‹¤."
            },
            {
                word: "ì†ì´ í¬ë‹¤",
                question: "ë‹¤ìŒ ì¤‘ 'ì†ì´ í¬ë‹¤' í‘œí˜„ì„ ì‚¬ìš©í•˜ê¸° ì¢‹ì€ ìƒí™©ì€ ë¬´ì—‡ì¸ê°€ìš”?",
                options: [
                    "ìŒì‹ì„ ì¡°ê¸ˆë§Œ í•˜ë ¤ê³  í–ˆëŠ”ë°, í•­ìƒ ë„ˆë¬´ ë§ì´ ë§Œë“¤ì–´ìš”.", 
                    "ë¹„ë°€ ì´ì•¼ê¸°ë¥¼ í•´ë„ ë‹¤ë¥¸ ì‚¬ëŒì—ê²Œ ì ˆëŒ€ ë§í•˜ì§€ ì•Šì•„ìš”.", 
                    "ê·¸ ì‚¬ëŒì€ 1ì‹œê°„ ê±¸ë¦´ ì¼ì„ 30ë¶„ ë§Œì— ëëƒˆì–´ìš”.", 
                    "ì¼í•  ì‚¬ëŒì´ ë¶€ì¡±í•´ì„œ ë„ì›€ì´ í•„ìš”í•´ìš”."
                ],
                answer: "ìŒì‹ì„ ì¡°ê¸ˆë§Œ í•˜ë ¤ê³  í–ˆëŠ”ë°, í•­ìƒ ë„ˆë¬´ ë§ì´ ë§Œë“¤ì–´ìš”.",
                feedback: "'ì†ì´ í¬ë‹¤'ëŠ” ëˆì´ë‚˜ ë¬¼ê±´ì„ ì•„ë¼ì§€ ì•Šê³  ë„‰ë„‰í•˜ê²Œ ì“°ê±°ë‚˜, ìŒì‹ì„ ë§ì´ ë§Œë“œëŠ” ì‚¬ëŒì—ê²Œ ì”ë‹ˆë‹¤."
            },
            {
                word: "ì…ì´ ë¬´ê²ë‹¤",
                question: "ë‹¤ìŒ ì¤‘ 'ì…ì´ ë¬´ê²ë‹¤' í‘œí˜„ì„ ì‚¬ìš©í•˜ê¸° ì¢‹ì€ ìƒí™©ì€ ë¬´ì—‡ì¸ê°€ìš”?",
                options: [
                    "ê·¸ ì‚¬ëŒì—ê²Œ ë¹„ë°€ ì´ì•¼ê¸°ë¥¼ í•´ë„ ì ˆëŒ€ ë‹¤ë¥¸ ì‚¬ëŒì—ê²Œ ë§í•˜ì§€ ì•Šì•„ìš”.", 
                    "ë‹¤ë¥¸ ì‚¬ëŒì˜ ë§ì„ ë„ˆë¬´ ì‰½ê²Œ ë¯¿ê³ , ë¬¼ê±´ì„ ê¸ˆë°© ì‚¬ìš”.", 
                    "ê·¸ ì‚¬ëŒì€ ì–´ë””ë¥¼ ê°€ë„ ì•„ëŠ” ì‚¬ëŒì´ ì •ë§ ë§ì•„ìš”.", 
                    "ì§€ê¸ˆ ë‹¹ì¥ ì—¬í–‰ì„ ë– ë‚˜ê³  ì‹¶ì–´ìš”."
                ],
                answer: "ê·¸ ì‚¬ëŒì—ê²Œ ë¹„ë°€ ì´ì•¼ê¸°ë¥¼ í•´ë„ ì ˆëŒ€ ë‹¤ë¥¸ ì‚¬ëŒì—ê²Œ ë§í•˜ì§€ ì•Šì•„ìš”.",
                feedback: "'ì…ì´ ë¬´ê²ë‹¤'ëŠ” ë¹„ë°€ì„ ì˜ ì§€í‚¤ëŠ” ì‚¬ëŒì„ ë§í•©ë‹ˆë‹¤."
            },
            {
                word: "ê·€ê°€ ì–‡ë‹¤",
                question: "ë‹¤ìŒ ì¤‘ 'ê·€ê°€ ì–‡ë‹¤' í‘œí˜„ì„ ì‚¬ìš©í•˜ê¸° ì¢‹ì€ ìƒí™©ì€ ë¬´ì—‡ì¸ê°€ìš”?",
                options: [
                    "ë‹¤ë¥¸ ì‚¬ëŒì˜ ë§ì„ ë„ˆë¬´ ì‰½ê²Œ ë¯¿ê³ , ë¬¼ê±´ì„ ê¸ˆë°© ì‚¬ìš”.", 
                    "ë¹„ë°€ ì´ì•¼ê¸°ë¥¼ í•´ë„ ë‹¤ë¥¸ ì‚¬ëŒì—ê²Œ ì ˆëŒ€ ë§í•˜ì§€ ì•Šì•„ìš”.", 
                    "ì‡¼í•‘ì„ ì˜¤ë˜ í–ˆì§€ë§Œ, ë§ˆìŒì— ë“œëŠ” ì˜·ì´ í•˜ë‚˜ë„ ì—†ì–´ìš”.", 
                    "ê·¸ ì‚¬ëŒì€ 1ì‹œê°„ ê±¸ë¦´ ì¼ì„ 30ë¶„ ë§Œì— ëëƒˆì–´ìš”."
                ],
                answer: "ë‹¤ë¥¸ ì‚¬ëŒì˜ ë§ì„ ë„ˆë¬´ ì‰½ê²Œ ë¯¿ê³ , ë¬¼ê±´ì„ ê¸ˆë°© ì‚¬ìš”.",
                feedback: "'ê·€ê°€ ì–‡ë‹¤'ëŠ” ë‹¤ë¥¸ ì‚¬ëŒì˜ ë§ì„ ì‰½ê²Œ ë¯¿ëŠ”ë‹¤ëŠ” ëœ»ì…ë‹ˆë‹¤."
            },
            {
                word: "ë§ˆìŒì´ êµ´ëšê°™ë‹¤",
                question: "ë‹¤ìŒ ì¤‘ 'ë§ˆìŒì´ êµ´ëšê°™ë‹¤' í‘œí˜„ì„ ì‚¬ìš©í•˜ê¸° ì¢‹ì€ ìƒí™©ì€ ë¬´ì—‡ì¸ê°€ìš”?",
                options: [
                    "ì§€ê¸ˆ ë‹¹ì¥ ì—¬í–‰ì„ ë– ë‚˜ê³  ì‹¶ì€ ë§ˆìŒì´ ì•„ì£¼ ì»¤ìš”.", 
                    "ì¼í•  ì‚¬ëŒì´ ë¶€ì¡±í•´ì„œ ë„ì›€ì´ í•„ìš”í•´ìš”.", 
                    "ê·¸ ì‚¬ëŒì€ ì–´ë””ë¥¼ ê°€ë„ ì•„ëŠ” ì‚¬ëŒì´ ì •ë§ ë§ì•„ìš”.", 
                    "ë‹¤ë¥¸ ì‚¬ëŒì˜ ë§ì„ ë„ˆë¬´ ì‰½ê²Œ ë¯¿ì–´ìš”."
                ],
                answer: "ì§€ê¸ˆ ë‹¹ì¥ ì—¬í–‰ì„ ë– ë‚˜ê³  ì‹¶ì€ ë§ˆìŒì´ ì•„ì£¼ ì»¤ìš”.",
                feedback: "'ë§ˆìŒì´ êµ´ëšê°™ë‹¤'ëŠ” ì–´ë–¤ ê²ƒì„ ì•„ì£¼ ê°„ì ˆí•˜ê²Œ í•˜ê³  ì‹¶ë‹¤ëŠ” ëœ»ì…ë‹ˆë‹¤."
            },
            {
                word: "ëˆˆì— ì°¨ë‹¤",
                question: "ë‹¤ìŒ ì¤‘ 'ëˆˆì— ì°¨ë‹¤' í‘œí˜„ì„ ì‚¬ìš©í•˜ê¸° ì¢‹ì€ ìƒí™©ì€ ë¬´ì—‡ì¸ê°€ìš”?",
                options: [
                    "ì‡¼í•‘ì„ ì˜¤ë˜ í–ˆì§€ë§Œ, ë§ˆìŒì— ë“œëŠ” ì˜·ì´ í•˜ë‚˜ë„ ì—†ì–´ìš”.", 
                    "ìŒì‹ì„ ì¡°ê¸ˆë§Œ í•˜ë ¤ê³  í–ˆëŠ”ë°, í•­ìƒ ë„ˆë¬´ ë§ì´ ë§Œë“¤ì–´ìš”.", 
                    "ë¹„ë°€ ì´ì•¼ê¸°ë¥¼ í•´ë„ ë‹¤ë¥¸ ì‚¬ëŒì—ê²Œ ì ˆëŒ€ ë§í•˜ì§€ ì•Šì•„ìš”.", 
                    "ì¼í•  ì‚¬ëŒì´ ë¶€ì¡±í•´ì„œ ë„ì›€ì´ í•„ìš”í•´ìš”."
                ],
                answer: "ì‡¼í•‘ì„ ì˜¤ë˜ í–ˆì§€ë§Œ, ë§ˆìŒì— ë“œëŠ” ì˜·ì´ í•˜ë‚˜ë„ ì—†ì–´ìš”.",
                feedback: "'ëˆˆì— ì°¨ë‹¤'ëŠ” ë§ˆìŒì— ë“¤ì–´ì„œ ë§Œì¡±ìŠ¤ëŸ½ë‹¤ëŠ” ëœ»ì…ë‹ˆë‹¤. (ì˜ˆ: ëˆˆì— ì°¨ëŠ” ì˜·ì´ ì—†ë‹¤ = ë§ˆìŒì— ë“œëŠ” ì˜·ì´ ì—†ë‹¤)"
            }
        ];

        // í€´ì¦ˆ ìƒíƒœ ë³€ìˆ˜
        let currentQuestionIndex = 0;
        let userAnswers = new Array(quizData.length).fill(null);
        let quizSubmitted = false;

        // HTML ìš”ì†Œ ê°€ì ¸ì˜¤ê¸°
        const loadingEl = document.getElementById('loading');
        const quizAppEl = document.getElementById('quiz-app');
        const quizContainer = document.getElementById('quiz-container');
        const resultContainer = document.getElementById('result-container');
        
        const questionNumberEl = document.getElementById('question-number');
        const totalQuestionsEl = document.getElementById('total-questions');
        const questionWordEl = document.getElementById('question-word');
        const questionTextEl = document.getElementById('question-text');
        const optionsContainer = document.getElementById('options-container');
        
        const prevBtn = document.getElementById('prev-btn');
        const nextBtn = document.getElementById('next-btn');
        const submitBtn = document.getElementById('submit-btn');
        
        const scoreEl = document.getElementById('score');
        const totalScoreEl = document.getElementById('total-score');
        const scoreMessageEl = document.getElementById('score-message');
        const feedbackContainer = document.getElementById('feedback-container');
        const feedbackListEl = document.getElementById('feedback-list');
        const restartBtn = document.getElementById('restart-btn');

        const prevResultsContainer = document.getElementById('previous-results-container');
        const resultsListEl = document.getElementById('results-list');
        const noResultsEl = document.getElementById('no-results');


        // Firebase ì´ˆê¸°í™” ë° ì¸ì¦ í•¨ìˆ˜
        async function initializeFirebase() {
            try {
                // ì•± ì´ˆê¸°í™” í™•ì¸
                if (!firebaseConfig || Object.keys(firebaseConfig).length === 0) {
                    console.error("Firebase ì„¤ì •ì´ ë¹„ì–´ìˆìŠµë‹ˆë‹¤.");
                    loadingEl.textContent = "ì˜¤ë¥˜: Firebase ì„¤ì •ì„ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.";
                    return;
                }
                
                app = initializeApp(firebaseConfig);
                auth = getAuth(app);
                db = getFirestore(app);

                // ì„¸ì…˜ ì§€ì†ì„± ì„¤ì •
                await setPersistence(auth, browserSessionPersistence);

                // ì¸ì¦ ìƒíƒœ ë¦¬ìŠ¤ë„ˆ
                onAuthStateChanged(auth, async (user) => {
                    if (user) {
                        console.log("ë¡œê·¸ì¸ ì„±ê³µ:", user.uid);
                        userId = user.uid;
                        setupApp();
                    } else {
                        console.log("ë¡œê·¸ì¸ í•„ìš”. í† í° í™•ì¸ ì¤‘...");
                        // ë¡œê·¸ì¸ ì‹œë„
                        try {
                            if (initialAuthToken) {
                                console.log("ì»¤ìŠ¤í…€ í† í°ìœ¼ë¡œ ë¡œê·¸ì¸ ì‹œë„...");
                                await signInWithCustomToken(auth, initialAuthToken);
                            } else {
                                console.log("ìµëª…ìœ¼ë¡œ ë¡œê·¸ì¸ ì‹œë„...");
                                await signInAnonymously(auth);
                            }
                        } catch (authError) {
                            console.error("ë¡œê·¸ì¸ ì‹¤íŒ¨:", authError);
                            loadingEl.textContent = "ì˜¤ë¥˜: ë¡œê·¸ì¸ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.";
                        }
                    }
                });

            } catch (error) {
                console.error("Firebase ì´ˆê¸°í™” ì˜¤ë¥˜:", error);
                loadingEl.textContent = "ì•±ì„ ì‹œì‘í•˜ëŠ” ë° ë¬¸ì œê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.";
            }
        }
        
        // ì•± ì„¤ì • (ë¡œê·¸ì¸ ì„±ê³µ í›„)
        function setupApp() {
            if (!userId) {
                console.error("ì‚¬ìš©ì IDê°€ ì—†ìŠµë‹ˆë‹¤.");
                return;
            }
            // Firestore ê²½ë¡œ ì„¤ì •
            resultsCollectionPath = `/artifacts/${appId}/users/${userId}/koreanQuizResults`;
            
            // í€´ì¦ˆ ì‹œì‘
            startQuiz();
            
            // ì´ì „ ê¸°ë¡ ë¶ˆëŸ¬ì˜¤ê¸°
            loadPreviousResults();
            
            // ë¡œë”© ìˆ¨ê¸°ê³  ì•± í‘œì‹œ
            loadingEl.classList.add('hidden');
            quizAppEl.classList.remove('hidden');
            prevResultsContainer.classList.remove('hidden');
        }

        // ë°°ì—´ ì„ê¸° í•¨ìˆ˜ (Fisher-Yates Shuffle)
        function shuffleArray(array) {
            let currentIndex = array.length,  randomIndex;
            
            // ë°°ì—´ì— ìš”ì†Œê°€ ë‚¨ì•„ìˆëŠ” ë™ì•ˆ
            while (currentIndex != 0) {
                // ë‚¨ì€ ìš”ì†Œ ì¤‘ í•˜ë‚˜ë¥¼ ì„ íƒ
                randomIndex = Math.floor(Math.random() * currentIndex);
                currentIndex--;

                // í˜„ì¬ ìš”ì†Œì™€ êµí™˜
                [array[currentIndex], array[randomIndex]] = [
                    array[randomIndex], array[currentIndex]];
            }

            return array;
        }

        // í€´ì¦ˆ ì‹œì‘ í•¨ìˆ˜
        function startQuiz() {
            currentQuestionIndex = 0;
            userAnswers.fill(null);
            quizSubmitted = false;
            
            totalQuestionsEl.textContent = quizData.length;
            totalScoreEl.textContent = quizData.length;
            
            renderQuestion();
            
            quizContainer.classList.remove('hidden');
            resultContainer.classList.add('hidden');
            feedbackListEl.innerHTML = '';
        }

        // ì§ˆë¬¸ ë Œë”ë§ í•¨ìˆ˜
        function renderQuestion() {
            if (currentQuestionIndex < 0 || currentQuestionIndex >= quizData.length) {
                return;
            }
            
            const question = quizData[currentQuestionIndex];
            
            questionNumberEl.textContent = currentQuestionIndex + 1;
            questionTextEl.textContent = question.question;
            // 'question-word'ë¥¼ ì—…ë°ì´íŠ¸í•˜ëŠ” ì½”ë“œ ì œê±°
            // questionWordEl.textContent = question.word; 
            
            optionsContainer.innerHTML = '';

            // --- ì„ íƒì§€ ìˆœì„œ ì„ê¸° ---
            // 1. ì›ë³¸ ì˜µì…˜ ë°°ì—´ì„ ë³µì‚¬í•©ë‹ˆë‹¤.
            const shuffledOptions = [...question.options];
            // 2. ë³µì‚¬ëœ ë°°ì—´ì˜ ìˆœì„œë¥¼ ì„ìŠµë‹ˆë‹¤.
            shuffleArray(shuffledOptions);
            // --- ---
            
            // ì„ì¸ ë°°ì—´(shuffledOptions)ì„ ì‚¬ìš©í•˜ì—¬ ë²„íŠ¼ì„ ë§Œë“­ë‹ˆë‹¤.
            shuffledOptions.forEach(option => {
                const button = document.createElement('button');
                button.textContent = option;
                button.classList.add('option-btn', 'w-full', 'text-left', 'p-4', 'border-2', 'border-gray-300', 'rounded-lg', 'transition', 'duration-200', 'hover:bg-gray-100', 'hover:border-blue-400');
                
                if (userAnswers[currentQuestionIndex] === option) {
                    button.classList.add('selected');
                }
                
                // í€´ì¦ˆ ì œì¶œ í›„ ìŠ¤íƒ€ì¼
                if (quizSubmitted) {
                    button.disabled = true;
                    if (option === question.answer) {
                        button.classList.add('correct');
                    } else if (userAnswers[currentQuestionIndex] === option) {
                        button.classList.add('incorrect');
                    }
                } else {
                    button.onclick = () => selectAnswer(option);
                }
                
                optionsContainer.appendChild(button);
            });
            
            updateNavigationButtons();
        }
        
        // ë‹µ ì„ íƒ í•¨ìˆ˜
        function selectAnswer(selectedOption) {
            if (quizSubmitted) return;
            
            userAnswers[currentQuestionIndex] = selectedOption;
            
            // ì„ íƒëœ ë²„íŠ¼ ìŠ¤íƒ€ì¼ ì—…ë°ì´íŠ¸
            document.querySelectorAll('.option-btn').forEach(btn => {
                btn.classList.remove('selected');
                if (btn.textContent === selectedOption) {
                    btn.classList.add('selected');
                }
            });
            
            // 0.5ì´ˆ í›„ ìë™ìœ¼ë¡œ ë‹¤ìŒ ë¬¸ì œë¡œ ì´ë™ (ì„ íƒ ì‚¬í•­)
            // setTimeout(() => {
            //     if (currentQuestionIndex < quizData.length - 1) {
            //         nextQuestion();
            //     }
            // }, 500);
        }

        // ë„¤ë¹„ê²Œì´ì…˜ ë²„íŠ¼ ì—…ë°ì´íŠ¸
        function updateNavigationButtons() {
            prevBtn.disabled = currentQuestionIndex === 0;
            
            if (currentQuestionIndex === quizData.length - 1) {
                nextBtn.classList.add('hidden');
                submitBtn.classList.remove('hidden');
            } else {
                nextBtn.classList.remove('hidden');
                submitBtn.classList.add('hidden');
            }
            
            // í€´ì¦ˆ ì œì¶œ í›„ ë²„íŠ¼ ìˆ¨ê¸°ê¸°
            if (quizSubmitted) {
                prevBtn.classList.add('hidden');
                nextBtn.classList.add('hidden');
                submitBtn.classList.add('hidden');
            } else {
                 prevBtn.classList.remove('hidden');
                 // nextBtn/submitBtn ì€ ìœ„ ë¡œì§ ë”°ë¦„
            }
        }

        // ë‹¤ìŒ ë¬¸ì œ
        function nextQuestion() {
            if (currentQuestionIndex < quizData.length - 1) {
                currentQuestionIndex++;
                renderQuestion();
            }
        }
        
        // ì´ì „ ë¬¸ì œ
        function prevQuestion() {
            if (currentQuestionIndex > 0) {
                currentQuestionIndex--;
                renderQuestion();
            }
        }

        // í€´ì¦ˆ ì±„ì 
        async function submitQuiz() {
            quizSubmitted = true;
            let score = 0;
            const incorrectAnswers = [];

            quizData.forEach((question, index) => {
                if (userAnswers[index] === question.answer) {
                    score++;
                } else {
                    incorrectAnswers.push({
                        question: question.question,
                        word: question.word,
                        yourAnswer: userAnswers[index] || "ì„ íƒ ì•ˆ í•¨",
                        correctAnswer: question.answer,
                        feedback: question.feedback
                    });
                }
            });

            // ê²°ê³¼ í‘œì‹œ
            scoreEl.textContent = score;
            if (score === quizData.length) {
                scoreMessageEl.textContent = "ì™„ë²½í•´ìš”! ëª¨ë“  ë¬¸ì œë¥¼ ë§í˜”ìŠµë‹ˆë‹¤! ğŸ¥³";
            } else if (score >= quizData.length * 0.7) {
                scoreMessageEl.textContent = "ì˜í–ˆì–´ìš”! ì¡°ê¸ˆë§Œ ë” ë…¸ë ¥í•´ ë³´ì„¸ìš”! ğŸ‘";
            } else {
                scoreMessageEl.textContent = "ì•„ì‰¬ì›Œìš”. ë‹¤ì‹œ í•œë²ˆ ë³µìŠµí•´ ë³´ì„¸ìš”! ğŸ¤“";
            }
            
            // í”¼ë“œë°± ìƒì„±
            if (incorrectAnswers.length > 0) {
                feedbackListEl.innerHTML = incorrectAnswers.map(item => `
                    <div class="p-4 bg-white rounded-lg shadow-sm border border-red-200">
                        <p class="font-semibold text-gray-800">${item.word}: ${item.question}</p>
                        <p class="text-sm text-red-600">ë‚´ ë‹µ: ${item.yourAnswer}</p>
                        <p class="text-sm text-green-600">ì •ë‹µ: ${item.correctAnswer}</p>
                        <p class="text-sm text-gray-600 mt-2">ğŸ’¡ ${item.feedback}</p>
                    </div>
                `).join('');
                feedbackContainer.classList.remove('hidden');
            } else {
                feedbackListEl.innerHTML = '<p class="text-green-600">í‹€ë¦° ë¬¸ì œê°€ ì—†ìŠµë‹ˆë‹¤. ì¶•í•˜í•©ë‹ˆë‹¤!</p>';
            }

            // í™”ë©´ ì „í™˜
            quizContainer.classList.add('hidden');
            resultContainer.classList.remove('hidden');
            
            // í€´ì¦ˆ ì œì¶œ í›„ í˜„ì¬ ìƒíƒœ(ì˜¤ë‹µ/ì •ë‹µ í‘œì‹œ)ë¥¼ ë‹¤ì‹œ ë Œë”ë§
            // ì‚¬ìš©ìê°€ ë§ˆì§€ë§‰ ë¬¸ì œë¥¼ ë³´ê³  ì±„ì í•  ë•Œ ìœ ìš©
            currentQuestionIndex = quizData.length - 1; 
            renderQuestion();
            
            // ê²°ê³¼ í™”ë©´ì´ ë³´ì´ë„ë¡ ë²„íŠ¼ ìˆ¨ê¸°ê¸°
            prevBtn.classList.add('hidden');
            nextBtn.classList.add('hidden');
            submitBtn.classList.add('hidden');

            // Firestoreì— ê²°ê³¼ ì €ì¥
            try {
                await saveResultToFirestore(score, quizData.length, incorrectAnswers.map(item => item.word));
            } catch (error) {
                console.error("ê²°ê³¼ ì €ì¥ ì‹¤íŒ¨:", error);
                // ì‚¬ìš©ìì—ê²Œ í”¼ë“œë°±ì„ ì¤„ ìˆ˜ ìˆìŒ (ì˜ˆ: alert)
            }
        }
        
        // Firestoreì— ê²°ê³¼ ì €ì¥
        async function saveResultToFirestore(score, total, incorrectWords) {
            if (!db || !userId) {
                console.error("Firestore DB ë˜ëŠ” ì‚¬ìš©ì IDê°€ ì—†ìŠµë‹ˆë‹¤.");
                return;
            }
            
            try {
                const docRef = await addDoc(collection(db, resultsCollectionPath), {
                    score: score,
                    total: total,
                    incorrectWords: incorrectWords,
                    timestamp: serverTimestamp() // ì„œë²„ ì‹œê°„ ê¸°ì¤€
                });
                console.log("ê²°ê³¼ ì €ì¥ ì„±ê³µ, ID: ", docRef.id);
            } catch (error) {
                console.error("Firestore ì €ì¥ ì˜¤ë¥˜: ", error);
                // ì¬ì‹œë„ ë¡œì§ì´ë‚˜ ì‚¬ìš©ì ì•Œë¦¼ ì¶”ê°€ ê°€ëŠ¥
            }
        }

        // ì´ì „ ê¸°ë¡ ë¶ˆëŸ¬ì˜¤ê¸° (ì‹¤ì‹œê°„)
        function loadPreviousResults() {
            if (!db || !userId) return;
            
            // ì´ì „ êµ¬ë…ì´ ìˆë‹¤ë©´ ì·¨ì†Œ
            if (unsubscribeResults) {
                unsubscribeResults();
            }

            const q = query(collection(db, resultsCollectionPath));
            
            unsubscribeResults = onSnapshot(q, (querySnapshot) => {
                if (querySnapshot.empty) {
                    noResultsEl.classList.remove('hidden');
                    resultsListEl.innerHTML = '';
                    return;
                }
                
                noResultsEl.classList.add('hidden');
                resultsListEl.innerHTML = ''; // ëª©ë¡ ì´ˆê¸°í™”
                
                const results = [];
                querySnapshot.forEach((doc) => {
                    results.push({ id: doc.id, ...doc.data() });
                });
                
                // ìµœì‹ ìˆœìœ¼ë¡œ ì •ë ¬ (timestampê°€ ìˆëŠ” ê²½ìš°)
                results.sort((a, b) => (b.timestamp?.seconds || 0) - (a.timestamp?.seconds || 0));

                results.forEach(result => {
                    const li = document.createElement('div');
                    li.classList.add('p-3', 'bg-gray-100', 'rounded-lg', 'flex', 'justify-between', 'items-center');
                    
                    const date = result.timestamp ? new Date(result.timestamp.seconds * 1000).toLocaleString('ko-KR') : 'ë‚ ì§œ ì—†ìŒ';
                    
                    li.innerHTML = `
                        <span class="text-gray-700">${date}</span>
                        <span class="font-bold text-blue-600">${result.score} / ${result.total} ì </span>
                    `;
                    resultsListEl.appendChild(li);
                });

            }, (error) => {
                console.error("ì´ì „ ê¸°ë¡ ë¶ˆëŸ¬ì˜¤ê¸° ì˜¤ë¥˜:", error);
                noResultsEl.textContent = "ê¸°ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.";
                noResultsEl.classList.remove('hidden');
            });
        }


        // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì—°ê²°
        prevBtn.addEventListener('click', prevQuestion);
        nextBtn.addEventListener('click', nextQuestion);
        submitBtn.addEventListener('click', submitQuiz);
        restartBtn.addEventListener('click', startQuiz);
        
        // ì•± ì‹¤í–‰
        initializeFirebase();

    </script>
</body>
</html>



