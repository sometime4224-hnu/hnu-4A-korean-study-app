<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>í•œêµ­ì–´ ì–´íœ˜ í€´ì¦ˆ</title>
    <!-- Tailwind CSS ë¡œë“œ -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Inter í°íŠ¸ ë¡œë“œ -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <!-- Noto Sans KR í°íŠ¸ (í•œêµ­ì–´ìš©) -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700&display=swap" rel="stylesheet">
    
    <style>
        /* ê¸°ë³¸ í°íŠ¸ ì„¤ì • */
        body {
            font-family: 'Noto Sans KR', 'Inter', sans-serif;
        }
        
        /* ì„ íƒëœ ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
        .option-btn.selected {
            background-color: #3b82f6; /* bg-blue-600 */
            color: white;
            border-color: #3b82f6; /* border-blue-600 */
        }
        
        /* ì •ë‹µ ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
        .option-btn.correct {
            background-color: #22c55e; /* bg-green-500 */
            color: white;
            border-color: #22c55e; /* border-green-500 */
        }
        
        /* ì˜¤ë‹µ ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
        .option-btn.incorrect {
            background-color: #ef4444; /* bg-red-500 */
            color: white;
            border-color: #ef4444; /* border-red-500 */
        }
    </style>
</head>
<body class="bg-gray-100 min-h-screen flex items-center justify-center p-4">

    <div class="bg-white w-full max-w-2xl rounded-2xl shadow-xl p-6 md:p-8">
        
        <!-- ë¡œë”© ìŠ¤í”¼ë„ˆ -->
        <div id="loading" class="text-center p-8">
            <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500 mx-auto"></div>
            <p class="mt-4 text-gray-600">í€´ì¦ˆë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ì…ë‹ˆë‹¤...</p>
        </div>

        <!-- í€´ì¦ˆ ì»¨í…Œì´ë„ˆ (ì²˜ìŒì—ëŠ” ìˆ¨ê¹€) -->
        <div id="quiz-app" class="hidden">
            
            <!-- í€´ì¦ˆ ì„¹ì…˜ -->
            <div id="quiz-container">
                <h1 class="text-2xl md:text-3xl font-bold text-center text-blue-600 mb-6">í•œêµ­ì–´ ì–´íœ˜ í€´ì¦ˆ</h1>
                
                <!-- ì§ˆë¬¸ í‘œì‹œ -->
                <div id="question-container" class="mb-6 min-h-[100px]">
                    <div class="flex justify-between items-center mb-4">
                        <span class="text-lg font-semibold text-gray-700">ë¬¸ì œ <span id="question-number">1</span> / <span id="total-questions">15</span></span>
                        <!-- 'question-word'ë¥¼ í‘œì‹œí•˜ë˜ spanì„ ìˆ¨ê¹€ ì²˜ë¦¬ (hidden í´ë˜ìŠ¤ ì¶”ê°€) -->
                        <span id="question-word" class="hidden text-xl md:text-2xl font-bold text-blue-700 bg-blue-50 p-2 rounded-lg"></span>
                    </div>
                    <p id="question-text" class="text-lg md:text-xl text-gray-800 leading-relaxed"></p>
                </div>
                
                <!-- ì„ íƒì§€ ë²„íŠ¼ -->
                <div id="options-container" class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                    <!-- Javascriptë¡œ ë²„íŠ¼ ìƒì„± -->
                </div>
                
                <!-- ë„¤ë¹„ê²Œì´ì…˜ ë²„íŠ¼ -->
                <div class="flex justify-between">
                    <button id="prev-btn" class="bg-gray-300 hover:bg-gray-400 text-gray-800 font-bold py-2 px-6 rounded-lg transition duration-200 disabled:opacity-50">ì´ì „</button>
                    <button id="next-btn" class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-6 rounded-lg transition duration-200">ë‹¤ìŒ</button>
                    <button id="submit-btn" class="bg-green-500 hover:bg-green-600 text-white font-bold py-2 px-6 rounded-lg transition duration-200 hidden">ì±„ì í•˜ê¸°</button>
                </div>
            </div>

            <!-- ê²°ê³¼ ì„¹ì…˜ (ì²˜ìŒì—ëŠ” ìˆ¨ê¹€) -->
            <div id="result-container" class="hidden text-center">
                <h2 class="text-3xl font-bold text-blue-600 mb-4">í€´ì¦ˆ ê²°ê³¼</h2>
                <p class="text-5xl font-bold mb-6">
                    <span id="score" class="text-green-500">0</span> / <span id="total-score">15</span>
                </p>
                <p id="score-message" class="text-xl text-gray-700 mb-8"></p>
                
                <!-- í‹€ë¦° ë¬¸ì œ í”¼ë“œë°± -->
                <div id="feedback-container" class="text-left bg-gray-50 p-4 rounded-lg">
                    <h3 class="text-xl font-semibold mb-4 text-red-600">í‹€ë¦° ë¬¸ì œ ë‹¤ì‹œ ë³´ê¸°</h3>
                    <div id="feedback-list" class="space-y-4">
                        <!-- Javascriptë¡œ í”¼ë“œë°± ë‚´ìš© ì¶”ê°€ -->
                    </div>
                </div>
                
                <button id="restart-btn" class="mt-8 bg-blue-500 hover:bg-blue-600 text-white font-bold py-3 px-8 rounded-lg transition duration-200">ë‹¤ì‹œ í’€ê¸°</button>
            </div>
            
        </div>
        
        <!-- ì´ì „ ê¸°ë¡ ì„¹ì…˜ -->
        <div id="previous-results-container" class="mt-8 pt-6 border-t border-gray-200 hidden">
            <h3 class="text-xl font-semibold text-gray-700 mb-4">ë‚˜ì˜ í€´ì¦ˆ ê¸°ë¡ ğŸ“</h3>
            <div id="results-list" class="space-y-2 max-h-40 overflow-y-auto">
                <p id="no-results" class="text-gray-500">ì•„ì§ ì €ì¥ëœ ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤.</p>
                <!-- Javascriptë¡œ ê¸°ë¡ ì¶”ê°€ -->
            </div>
        </div>

    </div>

    <!-- Firebase SDK -->
    <script type="module">
        // Firebase ëª¨ë“ˆ ê°€ì ¸ì˜¤ê¸°
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { 
            getAuth, 
            signInAnonymously, 
            signInWithCustomToken, 
            onAuthStateChanged,
            setPersistence,
            browserSessionPersistence
        } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { 
            getFirestore, 
            doc, 
            collection, 
            addDoc, 
            getDocs, 
            query,
            onSnapshot,
            serverTimestamp,
            setLogLevel
        } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // --- ìˆ˜ì •ëœ ë¶€ë¶„ (ì‹œì‘) ---
        
        // Firebase ì„¤ì • (Canvas í™˜ê²½ ë³€ìˆ˜ ì‚¬ìš©)
        const rawFirebaseConfig = typeof __firebase_config !== 'undefined' ? __firebase_config : null;
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-korean-quiz-app';
        const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;

        // Firebase ì•±, ì¸ì¦, Firestore ì´ˆê¸°í™”
        let app, auth, db;
        let userId = null; // ì‚¬ìš©ì ID
        let resultsCollectionPath = ''; // Firestore ì €ì¥ ê²½ë¡œ
        let unsubscribeResults = null; // onSnapshot êµ¬ë… ì·¨ì†Œ í•¨ìˆ˜
        let firebaseConfig = {}; // Firebase ì„¤ì • ê°ì²´ë¥¼ ë‹´ì„ ë³€ìˆ˜
        
        // --- ìˆ˜ì •ëœ ë¶€ë¶„ (ë) ---


        // Firestore ë¡œê¹… ì„¤ì • (ë””ë²„ê¹…ìš©)
        setLogLevel('Debug');

        // í€´ì¦ˆ ë°ì´í„°
        const quizData = [
            // --- ê°ìƒ/í‰ê°€ ì–´íœ˜ ---
            {
                word: "ìˆ˜ì¤€ì´ ë†’ë‹¤",
                question: "'ìˆ˜ì¤€ì´ ë†’ë‹¤'ì˜ ëœ»ì€ ë¬´ì—‡ì¸ê°€ìš”?",
                options: ["ì•„ì£¼ í›Œë¥­í•˜ê³  ì¢‹ë‹¤", "ë³´ê¸°ì— ì¬ë¯¸ì—†ë‹¤", "ë¬´ìŠ¨ ëœ»ì¸ì§€ ëª¨ë¥´ê² ë‹¤", "ê³„ì† ìƒê°ë‚œë‹¤"],
                answer: "ì•„ì£¼ í›Œë¥­í•˜ê³  ì¢‹ë‹¤",
                feedback: "'ìˆ˜ì¤€ì´ ë†’ë‹¤'ëŠ” ì‹¤ë ¥ì´ë‚˜ í’ˆì§ˆì´ ì•„ì£¼ ì¢‹ë‹¤ëŠ” ëœ»ì…ë‹ˆë‹¤."
            },
            {
                word: "ê¸°ëŒ€ë§Œ ëª»í•˜ë‹¤",
                question: "'ê¸°ëŒ€ë§Œ ëª»í•˜ë‹¤'ì˜ ëœ»ì€ ë¬´ì—‡ì¸ê°€ìš”?",
                options: ["ìƒê°ë³´ë‹¤ í›¨ì”¬ ì¢‹ë‹¤", "ìƒê°í–ˆë˜ ê²ƒë³´ë‹¤ ì¢‹ì§€ ì•Šë‹¤", "ë§ˆìŒì— ê°ë™ì„ ì¤€ë‹¤", "ë³´ê¸°ì— ê´œì°®ë‹¤"],
                answer: "ìƒê°í–ˆë˜ ê²ƒë³´ë‹¤ ì¢‹ì§€ ì•Šë‹¤",
                feedback: "'ê¸°ëŒ€ë§Œ ëª»í•˜ë‹¤'ëŠ” ê¸°ëŒ€í–ˆë˜ ê²ƒë³´ë‹¤ ê²°ê³¼ê°€ ë‚˜ì˜ë‹¤ëŠ” ëœ»ì…ë‹ˆë‹¤."
            },
            {
                word: "ì´í•´í•˜ê¸° ì•ˆ ë˜ë‹¤",
                question: "'ì´í•´í•˜ê¸° ì•ˆ ë˜ë‹¤'ì˜ ëœ»ì€ ë¬´ì—‡ì¸ê°€ìš”?",
                options: ["ì •ë§ ë†€ëë‹¤", "ë¶„ìœ„ê¸°ê°€ ë‚˜ì˜ë‹¤", "ë¬´ìŠ¨ ëœ»ì¸ì§€ ì˜ ëª¨ë¥´ê² ë‹¤", "ìŠì„ ìˆ˜ ì—†ë‹¤"],
                answer: "ë¬´ìŠ¨ ëœ»ì¸ì§€ ì˜ ëª¨ë¥´ê² ë‹¤",
                feedback: "'ì´í•´í•˜ê¸° ì•ˆ ë˜ë‹¤'ëŠ” ë‚´ìš©ì´ ì–´ë µê±°ë‚˜ ë³µì¡í•´ì„œ ëœ»ì„ ì•Œê¸° ì–´ë µë‹¤ëŠ” ë§ì…ë‹ˆë‹¤."
            },
            {
                word: "ìƒí™©ì´ ë³„ë¡œ ì•ˆ ì¢‹ë‹¤",
                question: "'ìƒí™©ì´ ë³„ë¡œ ì•ˆ ì¢‹ë‹¤'ì˜ ëœ»ì€ ë¬´ì—‡ì¸ê°€ìš”?",
                options: ["ì¬ë¯¸ì—†ê³  ë³„ë¡œë‹¤", "íŠ¹ë³„íˆ ì¢‹ì§€ë„ ë‚˜ì˜ì§€ë„ ì•Šë‹¤", "ë¶„ìœ„ê¸°ë‚˜ ëŠë‚Œì´ ì¢‹ì§€ ì•Šë‹¤", "ì•„ì£¼ í›Œë¥­í•˜ë‹¤"],
                answer: "ë¶„ìœ„ê¸°ë‚˜ ëŠë‚Œì´ ì¢‹ì§€ ì•Šë‹¤",
                feedback: "'ìƒí™©ì´ ë³„ë¡œ ì•ˆ ì¢‹ë‹¤'ëŠ” ì§€ê¸ˆì˜ ë¶„ìœ„ê¸°ë‚˜ ìƒíƒœê°€ ì¢‹ì§€ ì•Šë‹¤ëŠ” ëœ»ì…ë‹ˆë‹¤."
            },
            {
                word: "ëŒ€ë‹¨í•˜ë‹¤",
                question: "'ëŒ€ë‹¨í•˜ë‹¤'ì˜ ëœ»ì€ ë¬´ì—‡ì¸ê°€ìš”?",
                options: ["ì •ë§ ë†€ëê³  í›Œë¥­í•˜ë‹¤", "ì¬ë¯¸ì—†ê³  ì§€ë£¨í•˜ë‹¤", "ë¬´ìŠ¨ ëœ»ì¸ì§€ ëª¨ë¥´ê² ë‹¤", "ìƒê°ë³´ë‹¤ ë³„ë¡œë‹¤"],
                answer: "ì •ë§ ë†€ëê³  í›Œë¥­í•˜ë‹¤",
                feedback: "'ëŒ€ë‹¨í•˜ë‹¤'ëŠ” ë§¤ìš° ë›°ì–´ë‚˜ê±°ë‚˜ ë†€ëë‹¤ëŠ” ëœ»ì…ë‹ˆë‹¤."
            },
            {
                word: "ë³¼ ë§Œí•˜ë‹¤",
                question: "'ë³¼ ë§Œí•˜ë‹¤'ì˜ ëœ»ì€ ë¬´ì—‡ì¸ê°€ìš”?",
                options: ["ë³´ê¸°ì— ê´œì°®ê³  ì¶”ì²œí•  ìˆ˜ ìˆë‹¤", "ê¼­ ë´ì•¼ í•œë‹¤", "ë³´ê¸°ì— ì¢‹ì§€ ì•Šë‹¤", "ë„ˆë¬´ ìŠ¬í”„ë‹¤"],
                answer: "ë³´ê¸°ì— ê´œì°®ê³  ì¶”ì²œí•  ìˆ˜ ìˆë‹¤",
                feedback: "'ë³¼ ë§Œí•˜ë‹¤'ëŠ” ì‹œê°„ì„ ë“¤ì—¬ ë³¼ ê°€ì¹˜ê°€ ìˆë‹¤ëŠ” ëœ»ì…ë‹ˆë‹¤."
            },
            {
                word: "ì‹œì‹œí•˜ë‹¤",
                question: "'ì‹œì‹œí•˜ë‹¤'ì˜ ëœ»ì€ ë¬´ì—‡ì¸ê°€ìš”?",
                options: ["ì•„ì£¼ ì¬ë¯¸ìˆë‹¤", "ì¬ë¯¸ì—†ê³  ë³„ë¡œë‹¤", "ì¡°ê¸ˆ ë¬´ì„­ë‹¤", "ì •ë§ ìŠ¬í”„ë‹¤"],
                answer: "ì¬ë¯¸ì—†ê³  ë³„ë¡œë‹¤",
                feedback: "'ì‹œì‹œí•˜ë‹¤'ëŠ” ê¸°ëŒ€ë³´ë‹¤ ì¬ë¯¸ì—†ê³  ìˆ˜ì¤€ì´ ë‚®ë‹¤ëŠ” ëœ»ì…ë‹ˆë‹¤."
            },
            {
                word: "ê·¸ì € ê·¸ë ‡ë‹¤",
                question: "'ê·¸ì € ê·¸ë ‡ë‹¤'ì˜ ëœ»ì€ ë¬´ì—‡ì¸ê°€ìš”?",
                options: ["ì•„ì£¼ ì¢‹ë‹¤", "ì•„ì£¼ ë‚˜ì˜ë‹¤", "íŠ¹ë³„íˆ ì¢‹ì§€ë„ ë‚˜ì˜ì§€ë„ ì•Šë‹¤", "ì •ë§ ê°ë™ì ì´ë‹¤"],
                answer: "íŠ¹ë³„íˆ ì¢‹ì§€ë„ ë‚˜ì˜ì§€ë„ ì•Šë‹¤",
                feedback: "'ê·¸ì € ê·¸ë ‡ë‹¤'ëŠ” ë³´í†µ ìˆ˜ì¤€ì´ê³  íŠ¹ë³„í•œ ì ì´ ì—†ë‹¤ëŠ” ëœ»ì…ë‹ˆë‹¤."
            },
            {
                word: "ê¸°ì–µì— ë‚¨ë‹¤",
                question: "'ê¸°ì–µì— ë‚¨ë‹¤'ì˜ ëœ»ì€ ë¬´ì—‡ì¸ê°€ìš”?",
                options: ["ê¸ˆë°© ìŠì–´ë²„ë¦°ë‹¤", "ë¬´ìŠ¨ ë§ì¸ì§€ ëª¨ë¥´ê² ë‹¤", "ìŠì„ ìˆ˜ ì—†ê³  ê³„ì† ìƒê°ë‚œë‹¤", "ì¬ë¯¸ì—†ë‹¤"],
                answer: "ìŠì„ ìˆ˜ ì—†ê³  ê³„ì† ìƒê°ë‚œë‹¤",
                feedback: "'ê¸°ì–µì— ë‚¨ë‹¤'ëŠ” ì¸ìƒì´ ê¹Šì–´ì„œ ìŠíˆì§€ ì•ŠëŠ”ë‹¤ëŠ” ëœ»ì…ë‹ˆë‹¤."
            },
            {
                word: "ê°€ìŠ´ì´ ì°¡í•˜ë‹¤",
                question: "'ê°€ìŠ´ì´ ì°¡í•˜ë‹¤'ì˜ ëœ»ì€ ë¬´ì—‡ì¸ê°€ìš”?",
                options: ["ê°€ìŠ´ì´ ì•„í”„ë‹¤", "ë§ˆìŒì— í° ê°ë™ì„ ì£¼ë‹¤", "ë„ˆë¬´ ì›ƒê¸°ë‹¤", "ì§€ë£¨í•˜ë‹¤"],
                answer: "ë§ˆìŒì— í° ê°ë™ì„ ì£¼ë‹¤",
                feedback: "'ê°€ìŠ´ì´ ì°¡í•˜ë‹¤'ëŠ” ìŠ¬í””ì´ë‚˜ ê°ë™ìœ¼ë¡œ ë§ˆìŒì´ ë­‰í´í•´ì§€ëŠ” ê²ƒì„ ë§í•©ë‹ˆë‹¤."
            },
            // --- -ê±°ë¦¬ ì–´íœ˜ ---
            {
                word: "ë³¼ê±°ë¦¬",
                question: "'ë³¼ ë§Œí•œ ê²ƒ'ì´ë¼ëŠ” ëœ»ì„ ê°€ì§„ ë‹¨ì–´ëŠ” ë¬´ì—‡ì¸ê°€ìš”?",
                options: ["ì´ì•¼ê¹ƒê±°ë¦¬", "ë³¼ê±°ë¦¬", "ì›ƒìŒê±°ë¦¬", "ê´€ì‹¬ê±°ë¦¬"],
                answer: "ë³¼ê±°ë¦¬",
                feedback: "'ë³¼ê±°ë¦¬'ëŠ” êµ¬ê²½í•  ë§Œí•œ ê²ƒì„ ì˜ë¯¸í•©ë‹ˆë‹¤. (ì˜ˆ: ì´ ë„ì‹œì—ëŠ” ë³¼ê±°ë¦¬ê°€ ë§ë‹¤.)"
            },
            {
                word: "ì´ì•¼ê¹ƒê±°ë¦¬",
                question: "'ì´ì•¼ê¸°í•  ë§Œí•œ ì¬ë£Œ'ë¼ëŠ” ëœ»ì„ ê°€ì§„ ë‹¨ì–´ëŠ” ë¬´ì—‡ì¸ê°€ìš”?",
                options: ["ë³¼ê±°ë¦¬", "ê±±ì •ê±°ë¦¬", "ì´ì•¼ê¹ƒê±°ë¦¬", "ì›ƒìŒê±°ë¦¬"],
                answer: "ì´ì•¼ê¹ƒê±°ë¦¬",
                feedback: "'ì´ì•¼ê¹ƒê±°ë¦¬'ëŠ” ëŒ€í™”ì˜ ì£¼ì œê°€ ë  ë§Œí•œ ê²ƒì„ ì˜ë¯¸í•©ë‹ˆë‹¤. (ì˜ˆ: ìƒˆë¡œìš´ ì†Œì‹ì€ ì¢‹ì€ ì´ì•¼ê¹ƒê±°ë¦¬ê°€ ëœë‹¤.)"
            },
            {
                word: "ì›ƒìŒê±°ë¦¬",
                question: "'ë‹¤ë¥¸ ì‚¬ëŒë“¤ì´ ë¹„ì›ƒëŠ” ëŒ€ìƒ'ì´ë¼ëŠ” ëœ»ì„ ê°€ì§„ ë‹¨ì–´ëŠ” ë¬´ì—‡ì¸ê°€ìš”?",
                options: ["ê´€ì‹¬ê±°ë¦¬", "ì´ì•¼ê¹ƒê±°ë¦¬", "ë³¼ê±°ë¦¬", "ì›ƒìŒê±°ë¦¬"],
                answer: "ì›ƒìŒê±°ë¦¬",
                feedback: "'ì›ƒìŒê±°ë¦¬'ëŠ” ë†€ë¦¼ì´ë‚˜ ë¹„ì›ƒìŒì„ ë‹¹í•˜ëŠ” ëŒ€ìƒì„ ì˜ë¯¸í•©ë‹ˆë‹¤. (ì˜ˆ: ì‹¤ìˆ˜í•´ì„œ ì›ƒìŒê±°ë¦¬ê°€ ë˜ì—ˆë‹¤.)"
            },
            {
                word: "ê±±ì •ê±°ë¦¬",
                question: "'ê±±ì •í•˜ê²Œ ë§Œë“œëŠ” ì¼'ì´ë¼ëŠ” ëœ»ì„ ê°€ì§„ ë‹¨ì–´ëŠ” ë¬´ì—‡ì¸ê°€ìš”?",
                options: ["ê±±ì •ê±°ë¦¬", "ë³¼ê±°ë¦¬", "ì›ƒìŒê±°ë¦¬", "ì´ì•¼ê¹ƒê±°ë¦¬"],
                answer: "ê±±ì •ê±°ë¦¬",
                feedback: "'ê±±ì •ê±°ë¦¬'ëŠ” ë§ˆìŒì„ í¸í•˜ì§€ ì•Šê²Œ í•˜ëŠ” ì¼ì„ ì˜ë¯¸í•©ë‹ˆë‹¤. (ì˜ˆ: ì‹œí—˜ ë•Œë¬¸ì— ê±±ì •ê±°ë¦¬ê°€ ìƒê²¼ë‹¤.)"
            },
            {
                word: "ê´€ì‹¬ê±°ë¦¬",
                question: "'ì‚¬ëŒë“¤ì´ ê¶ê¸ˆí•´í•˜ê³  ë§ˆìŒì„ ë„ëŠ” ê²ƒ'ì´ë¼ëŠ” ëœ»ì„ ê°€ì§„ ë‹¨ì–´ëŠ” ë¬´ì—‡ì¸ê°€ìš”?",
                options: ["ì›ƒìŒê±°ë¦¬", "ê±±ì •ê±°ë¦¬", "ê´€ì‹¬ê±°ë¦¬", "ë³¼ê±°ë¦¬"],
                answer: "ê´€ì‹¬ê±°ë¦¬",
                feedback: "'ê´€ì‹¬ê±°ë¦¬'ëŠ” ë§ì€ ì‚¬ëŒë“¤ì´ ì£¼ëª©í•˜ê³  í¥ë¯¸ë¥¼ ê°€ì§€ëŠ” ê²ƒì„ ì˜ë¯¸í•©ë‹ˆë‹¤. (ì˜ˆ: ìš”ì¦˜ í™˜ê²½ ë¬¸ì œê°€ ëª¨ë‘ì˜ ê´€ì‹¬ê±°ë¦¬ì´ë‹¤.)"
            }
        ];

        // í€´ì¦ˆ ìƒíƒœ ë³€ìˆ˜
        let currentQuestionIndex = 0;
        let userAnswers = new Array(quizData.length).fill(null);
        let quizSubmitted = false;

        // HTML ìš”ì†Œ ê°€ì ¸ì˜¤ê¸°
        const loadingEl = document.getElementById('loading');
        const quizAppEl = document.getElementById('quiz-app');
        const quizContainer = document.getElementById('quiz-container');
        const resultContainer = document.getElementById('result-container');
        
        const questionNumberEl = document.getElementById('question-number');
        const totalQuestionsEl = document.getElementById('total-questions');
        const questionWordEl = document.getElementById('question-word');
        const questionTextEl = document.getElementById('question-text');
        const optionsContainer = document.getElementById('options-container');
        
        const prevBtn = document.getElementById('prev-btn');
        const nextBtn = document.getElementById('next-btn');
        const submitBtn = document.getElementById('submit-btn');
        
        const scoreEl = document.getElementById('score');
        const totalScoreEl = document.getElementById('total-score');
        const scoreMessageEl = document.getElementById('score-message');
        const feedbackContainer = document.getElementById('feedback-container');
        const feedbackListEl = document.getElementById('feedback-list');
        const restartBtn = document.getElementById('restart-btn');

        const prevResultsContainer = document.getElementById('previous-results-container');
        const resultsListEl = document.getElementById('results-list');
        const noResultsEl = document.getElementById('no-results');


        // Firebase ì´ˆê¸°í™” ë° ì¸ì¦ í•¨ìˆ˜
        async function initializeFirebase() {
            try {
                
                // --- ìˆ˜ì •ëœ ë¶€ë¶„ (ì‹œì‘) ---
                // Firebase ì„¤ì • íŒŒì‹±
                if (rawFirebaseConfig && rawFirebaseConfig.trim() !== "") {
                    try {
                        firebaseConfig = JSON.parse(rawFirebaseConfig);
                    } catch (e) {
                        console.error("Firebase ì„¤ì • JSON íŒŒì‹± ì˜¤ë¥˜:", e, rawFirebaseConfig);
                        loadingEl.textContent = "ì˜¤ë¥˜: Firebase ì„¤ì • í˜•ì‹ì´ ì˜ëª»ë˜ì—ˆìŠµë‹ˆë‹¤.";
                        return;
                    }
                } else {
                    console.error("Firebase ì„¤ì •ì´ ì œê³µë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. (__firebase_config is missing or empty)");
                    loadingEl.textContent = "ì˜¤ë¥˜: Firebase ì„¤ì •ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.";
                    return;
                }

                // ì•± ì´ˆê¸°í™” í™•ì¸ (ì´ì œ firebaseConfigê°€ ì±„ì›Œì¡ŒëŠ”ì§€ í™•ì¸)
                if (Object.keys(firebaseConfig).length === 0) {
                    console.error("Firebase ì„¤ì •ì´ ë¹„ì–´ìˆìŠµë‹ˆë‹¤. (After parsing)");
                    loadingEl.textContent = "ì˜¤ë¥˜: Firebase ì„¤ì •ì„ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.";
                    return;
                }
                // --- ìˆ˜ì •ëœ ë¶€ë¶„ (ë) ---

                
                app = initializeApp(firebaseConfig);
                auth = getAuth(app);
                db = getFirestore(app);

                // ì„¸ì…˜ ì§€ì†ì„± ì„¤ì •
                await setPersistence(auth, browserSessionPersistence);

                // ì¸ì¦ ìƒíƒœ ë¦¬ìŠ¤ë„ˆ
                onAuthStateChanged(auth, async (user) => {
                    if (user) {
                        console.log("ë¡œê·¸ì¸ ì„±ê³µ:", user.uid);
                        userId = user.uid;
                        setupApp();
                    } else {
                        console.log("ë¡œê·¸ì¸ í•„ìš”. í† í° í™•ì¸ ì¤‘...");
                        // ë¡œê·¸ì¸ ì‹œë„
                        try {
                            if (initialAuthToken) {
                                console.log("ì»¤ìŠ¤í…€ í† í°ìœ¼ë¡œ ë¡œê·¸ì¸ ì‹œë„...");
                                await signInWithCustomToken(auth, initialAuthToken);
                            } else {
                                console.log("ìµëª…ìœ¼ë¡œ ë¡œê·¸ì¸ ì‹œë„...");
                                await signInAnonymously(auth);
                            }
                        } catch (authError) {
                            console.error("ë¡œê·¸ì¸ ì‹¤íŒ¨:", authError);
                            loadingEl.textContent = "ì˜¤ë¥˜: ë¡œê·¸ì¸ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.";
                        }
                    }
                });

            } catch (error) {
                console.error("Firebase ì´ˆê¸°í™” ì˜¤ë¥˜:", error);
                loadingEl.textContent = "ì•±ì„ ì‹œì‘í•˜ëŠ” ë° ë¬¸ì œê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.";
            }
        }
        
        // ì•± ì„¤ì • (ë¡œê·¸ì¸ ì„±ê³µ í›„)
        function setupApp() {
            if (!userId) {
                console.error("ì‚¬ìš©ì IDê°€ ì—†ìŠµë‹ˆë‹¤.");
                return;
            }
            // Firestore ê²½ë¡œ ì„¤ì •
            resultsCollectionPath = `/artifacts/${appId}/users/${userId}/koreanQuizResults`;
            
            // í€´ì¦ˆ ì‹œì‘
            startQuiz();
            
            // ì´ì „ ê¸°ë¡ ë¶ˆëŸ¬ì˜¤ê¸°
            loadPreviousResults();
            
            // ë¡œë”© ìˆ¨ê¸°ê³  ì•± í‘œì‹œ
            loadingEl.classList.add('hidden');
            quizAppEl.classList.remove('hidden');
            prevResultsContainer.classList.remove('hidden');
        }

        // í€´ì¦ˆ ì‹œì‘ í•¨ìˆ˜
        function startQuiz() {
            currentQuestionIndex = 0;
            userAnswers.fill(null);
            quizSubmitted = false;
            
            totalQuestionsEl.textContent = quizData.length;
            totalScoreEl.textContent = quizData.length;
            
            renderQuestion();
            
            quizContainer.classList.remove('hidden');
            resultContainer.classList.add('hidden');
            feedbackListEl.innerHTML = '';
        }

        // ì§ˆë¬¸ ë Œë”ë§ í•¨ìˆ˜
        function renderQuestion() {
            if (currentQuestionIndex < 0 || currentQuestionIndex >= quizData.length) {
                return;
            }
            
            const question = quizData[currentQuestionIndex];
            
            questionNumberEl.textContent = currentQuestionIndex + 1;
            questionTextEl.textContent = question.question;
            // 'question-word'ë¥¼ ì—…ë°ì´íŠ¸í•˜ëŠ” ì½”ë“œ ì œê±°
            // questionWordEl.textContent = question.word; 
            
            optionsContainer.innerHTML = '';
            
            question.options.forEach(option => {
                const button = document.createElement('button');
                button.textContent = option;
                button.classList.add('option-btn', 'w-full', 'text-left', 'p-4', 'border-2', 'border-gray-300', 'rounded-lg', 'transition', 'duration-200', 'hover:bg-gray-100', 'hover:border-blue-400');
                
                if (userAnswers[currentQuestionIndex] === option) {
                    button.classList.add('selected');
                }
                
                // í€´ì¦ˆ ì œì¶œ í›„ ìŠ¤íƒ€ì¼
                if (quizSubmitted) {
                    button.disabled = true;
                    if (option === question.answer) {
                        button.classList.add('correct');
                    } else if (userAnswers[currentQuestionIndex] === option) {
                        button.classList.add('incorrect');
                    }
                } else {
                    button.onclick = () => selectAnswer(option);
                }
                
                optionsContainer.appendChild(button);
            });
            
            updateNavigationButtons();
        }
        
        // ë‹µ ì„ íƒ í•¨ìˆ˜
        function selectAnswer(selectedOption) {
            if (quizSubmitted) return;
            
            userAnswers[currentQuestionIndex] = selectedOption;
            
            // ì„ íƒëœ ë²„íŠ¼ ìŠ¤íƒ€ì¼ ì—…ë°ì´íŠ¸
            document.querySelectorAll('.option-btn').forEach(btn => {
                btn.classList.remove('selected');
                if (btn.textContent === selectedOption) {
                    btn.classList.add('selected');
                }
            });
            
            // 0.5ì´ˆ í›„ ìë™ìœ¼ë¡œ ë‹¤ìŒ ë¬¸ì œë¡œ ì´ë™ (ì„ íƒ ì‚¬í•­)
            // setTimeout(() => {
            //     if (currentQuestionIndex < quizData.length - 1) {
            //         nextQuestion();
            //     }
            // }, 500);
        }

        // ë„¤ë¹„ê²Œì´ì…˜ ë²„íŠ¼ ì—…ë°ì´íŠ¸
        function updateNavigationButtons() {
            prevBtn.disabled = currentQuestionIndex === 0;
            
            if (currentQuestionIndex === quizData.length - 1) {
                nextBtn.classList.add('hidden');
                submitBtn.classList.remove('hidden');
            } else {
                nextBtn.classList.remove('hidden');
                submitBtn.classList.add('hidden');
            }
            
            // í€´ì¦ˆ ì œì¶œ í›„ ë²„íŠ¼ ìˆ¨ê¸°ê¸°
            if (quizSubmitted) {
                prevBtn.classList.add('hidden');
                nextBtn.classList.add('hidden');
                submitBtn.classList.add('hidden');
            } else {
                 prevBtn.classList.remove('hidden');
                 // nextBtn/submitBtn ì€ ìœ„ ë¡œì§ ë”°ë¦„
            }
        }

        // ë‹¤ìŒ ë¬¸ì œ
        function nextQuestion() {
            if (currentQuestionIndex < quizData.length - 1) {
                currentQuestionIndex++;
                renderQuestion();
            }
        }
        
        // ì´ì „ ë¬¸ì œ
        function prevQuestion() {
            if (currentQuestionIndex > 0) {
                currentQuestionIndex--;
                renderQuestion();
            }
        }

        // í€´ì¦ˆ ì±„ì 
        async function submitQuiz() {
            quizSubmitted = true;
            let score = 0;
            const incorrectAnswers = [];

            quizData.forEach((question, index) => {
                if (userAnswers[index] === question.answer) {
                    score++;
                } else {
                    incorrectAnswers.push({
                        question: question.question,
                        word: question.word,
                        yourAnswer: userAnswers[index] || "ì„ íƒ ì•ˆ í•¨",
                        correctAnswer: question.answer,
                        feedback: question.feedback
                    });
                }
            });

            // ê²°ê³¼ í‘œì‹œ
            scoreEl.textContent = score;
            if (score === quizData.length) {
                scoreMessageEl.textContent = "ì™„ë²½í•´ìš”! ëª¨ë“  ë¬¸ì œë¥¼ ë§í˜”ìŠµë‹ˆë‹¤! ğŸ¥³";
            } else if (score >= quizData.length * 0.7) {
                scoreMessageEl.textContent = "ì˜í–ˆì–´ìš”! ì¡°ê¸ˆë§Œ ë” ë…¸ë ¥í•´ ë³´ì„¸ìš”! ğŸ‘";
            } else {
                scoreMessageEl.textContent = "ì•„ì‰¬ì›Œìš”. ë‹¤ì‹œ í•œë²ˆ ë³µìŠµí•´ ë³´ì„¸ìš”! ğŸ¤“";
            }
            
            // í”¼ë“œë°± ìƒì„±
            if (incorrectAnswers.length > 0) {
                feedbackListEl.innerHTML = incorrectAnswers.map(item => `
                    <div class="p-4 bg-white rounded-lg shadow-sm border border-red-200">
                        <p class="font-semibold text-gray-800">${item.word}: ${item.question}</p>
                        <p class="text-sm text-red-600">ë‚´ ë‹µ: ${item.yourAnswer}</p>
                        <p class="text-sm text-green-600">ì •ë‹µ: ${item.correctAnswer}</p>
                        <p class="text-sm text-gray-600 mt-2">ğŸ’¡ ${item.feedback}</p>
                    </div>
                `).join('');
                feedbackContainer.classList.remove('hidden');
            } else {
                feedbackListEl.innerHTML = '<p class="text-green-600">í‹€ë¦° ë¬¸ì œê°€ ì—†ìŠµë‹ˆë‹¤. ì¶•í•˜í•©ë‹ˆë‹¤!</p>';
            }

            // í™”ë©´ ì „í™˜
            quizContainer.classList.add('hidden');
            resultContainer.classList.remove('hidden');
            
            // í€´ì¦ˆ ì œì¶œ í›„ í˜„ì¬ ìƒíƒœ(ì˜¤ë‹µ/ì •ë‹µ í‘œì‹œ)ë¥¼ ë‹¤ì‹œ ë Œë”ë§
            // ì‚¬ìš©ìê°€ ë§ˆì§€ë§‰ ë¬¸ì œë¥¼ ë³´ê³  ì±„ì í•  ë•Œ ìœ ìš©
            currentQuestionIndex = quizData.length - 1; 
            renderQuestion();
            
            // ê²°ê³¼ í™”ë©´ì´ ë³´ì´ë„ë¡ ë²„íŠ¼ ìˆ¨ê¸°ê¸°
            prevBtn.classList.add('hidden');
            nextBtn.classList.add('hidden');
            submitBtn.classList.add('hidden');

            // Firestoreì— ê²°ê³¼ ì €ì¥
            try {
                await saveResultToFirestore(score, quizData.length, incorrectAnswers.map(item => item.word));
            } catch (error) {
                console.error("ê²°ê³¼ ì €ì¥ ì‹¤íŒ¨:", error);
                // ì‚¬ìš©ìì—ê²Œ í”¼ë“œë°±ì„ ì¤„ ìˆ˜ ìˆìŒ (ì˜ˆ: alert)
            }
        }
        
        // Firestoreì— ê²°ê³¼ ì €ì¥
        async function saveResultToFirestore(score, total, incorrectWords) {
            if (!db || !userId) {
                console.error("Firestore DB ë˜ëŠ” ì‚¬ìš©ì IDê°€ ì—†ìŠµë‹ˆë‹¤.");
                return;
            }
            
            try {
                const docRef = await addDoc(collection(db, resultsCollectionPath), {
                    score: score,
                    total: total,
                    incorrectWords: incorrectWords,
                    timestamp: serverTimestamp() // ì„œë²„ ì‹œê°„ ê¸°ì¤€
                });
                console.log("ê²°ê³¼ ì €ì¥ ì„±ê³µ, ID: ", docRef.id);
            } catch (error) {
                console.error("Firestore ì €ì¥ ì˜¤ë¥˜: ", error);
                // ì¬ì‹œë„ ë¡œì§ì´ë‚˜ ì‚¬ìš©ì ì•Œë¦¼ ì¶”ê°€ ê°€ëŠ¥
            }
        }

        // ì´ì „ ê¸°ë¡ ë¶ˆëŸ¬ì˜¤ê¸° (ì‹¤ì‹œê°„)
        function loadPreviousResults() {
            if (!db || !userId) return;
            
            // ì´ì „ êµ¬ë…ì´ ìˆë‹¤ë©´ ì·¨ì†Œ
            if (unsubscribeResults) {
                unsubscribeResults();
            }

            const q = query(collection(db, resultsCollectionPath));
            
            unsubscribeResults = onSnapshot(q, (querySnapshot) => {
                if (querySnapshot.empty) {
                    noResultsEl.classList.remove('hidden');
                    resultsListEl.innerHTML = '';
                    return;
                }
                
                noResultsEl.classList.add('hidden');
                resultsListEl.innerHTML = ''; // ëª©ë¡ ì´ˆê¸°í™”
                
                const results = [];
                querySnapshot.forEach((doc) => {
                    results.push({ id: doc.id, ...doc.data() });
                });
                
                // ìµœì‹ ìˆœìœ¼ë¡œ ì •ë ¬ (timestampê°€ ìˆëŠ” ê²½ìš°)
                results.sort((a, b) => (b.timestamp?.seconds || 0) - (a.timestamp?.seconds || 0));

                results.forEach(result => {
                    const li = document.createElement('div');
                    li.classList.add('p-3', 'bg-gray-100', 'rounded-lg', 'flex', 'justify-between', 'items-center');
                    
                    const date = result.timestamp ? new Date(result.timestamp.seconds * 1000).toLocaleString('ko-KR') : 'ë‚ ì§œ ì—†ìŒ';
                    
                    li.innerHTML = `
                        <span class="text-gray-700">${date}</span>
                        <span class="font-bold text-blue-600">${result.score} / ${result.total} ì </span>
                    `;
                    resultsListEl.appendChild(li);
                });

            }, (error) => {
                console.error("ì´ì „ ê¸°ë¡ ë¶ˆëŸ¬ì˜¤ê¸° ì˜¤ë¥˜:", error);
                noResultsEl.textContent = "ê¸°ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.";
                noResultsEl.classList.remove('hidden');
            });
        }


        // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì—°ê²°
        prevBtn.addEventListener('click', prevQuestion);
        nextBtn.addEventListener('click', nextQuestion);
        submitBtn.addEventListener('click', submitQuiz);
        restartBtn.addEventListener('click', startQuiz);
        
        // ì•± ì‹¤í–‰
        initializeFirebase();

    </script>
</body>
</html>

