<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>íŒ¬ì—ê²Œ ì“°ëŠ” í¸ì§€: í•œêµ­ì–´ í•™ìŠµ (ì‹¬í™”)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700&family=Noto+Sans+JP:wght@400;500;700&family=Be+Vietnam+Pro:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Noto Sans KR', sans-serif; }
        .lang-ja body { font-family: 'Noto Sans JP', sans-serif; }
        .lang-vi body { font-family: 'Be Vietnam Pro', sans-serif; }
        .card {
            transform-style: preserve-3d;
            transition: transform 0.6s;
        }
        .card.is-flipped {
            transform: rotateY(180deg);
        }
        .card-face {
            backface-visibility: hidden;
            -webkit-backface-visibility: hidden;
        }
        .card-face-back {
            transform: rotateY(180deg);
        }
        .main-button, .lang-button, .view-toggle-button {
            transition: all 0.3s ease;
        }
        .main-button:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }
        .quiz-option:hover {
            background-color: #e0f2fe;
        }
        .lang-button.active {
            background-color: #1e40af;
            color: white;
        }
    </style>
</head>
<body class="bg-gray-100 flex items-center justify-center min-h-screen">
    <div id="app-container" class="w-full max-w-lg mx-auto bg-white rounded-2xl shadow-xl p-6 sm:p-8">
        
        <div class="flex justify-end mb-4 space-x-1">
            <button onclick="setLanguage('ko')" class="lang-button active font-semibold py-1 px-3 border border-blue-800 text-blue-800 rounded-full text-sm">KO</button>
            <button onclick="setLanguage('vi')" class="lang-button font-semibold py-1 px-3 border border-blue-800 text-blue-800 rounded-full text-sm">VI</button>
            <button onclick="setLanguage('ja')" class="lang-button font-semibold py-1 px-3 border border-blue-800 text-blue-800 rounded-full text-sm">JA</button>
        </div>

        <!-- Main Menu Screen -->
        <div id="main-menu">
            <div class="text-center">
                <h1 class="text-3xl font-bold text-gray-800 mb-2" data-translate-key="mainTitle">íŒ¬ì—ê²Œ ì“°ëŠ” í¸ì§€</h1>
                <p class="text-lg text-gray-500 mb-8" data-translate-key="mainSubtitle">ì‹¬í™” í•™ìŠµ</p>
            </div>
            <div class="space-y-4">
                <button onclick="showScreen('vocab-app')" class="main-button w-full bg-sky-500 text-white font-bold py-4 px-6 rounded-xl text-xl">
                    <span data-translate-key="vocabTitle">ì–´íœ˜ í•™ìŠµ</span> ğŸ“š
                </button>
                <button onclick="showScreen('expression-app')" class="main-button w-full bg-indigo-500 text-white font-bold py-4 px-6 rounded-xl text-xl">
                    <span data-translate-key="expressionTitle">í‘œí˜„ í•™ìŠµ</span> ğŸ’¬
                </button>
                <button onclick="showScreen('grammar-app')" class="main-button w-full bg-emerald-500 text-white font-bold py-4 px-6 rounded-xl text-xl">
                    <span data-translate-key="grammarTitle">ë¬¸ë²• í•™ìŠµ</span> âœï¸
                </button>
            </div>
        </div>

        <!-- Vocabulary App Screen -->
        <div id="vocab-app" class="hidden">
            <div class="flex justify-between items-center mb-4">
                <button onclick="showScreen('main-menu')" class="text-sky-600 hover:text-sky-800 font-semibold" data-translate-key="goBack">&larr; ì²˜ìŒìœ¼ë¡œ</button>
                <h2 class="text-2xl font-bold text-sky-800" data-translate-key="vocabTitle">ì–´íœ˜ í•™ìŠµ</h2>
                <div id="vocab-counter" class="text-sm text-gray-500 font-medium"></div>
            </div>

            <div class="flex justify-center my-4 bg-gray-200 p-1 rounded-lg">
                <button id="card-view-btn" onclick="setVocabView('card')" class="view-toggle-button w-1/2 py-2 text-sm font-bold bg-white text-sky-800 rounded-md shadow-sm" data-translate-key="cardView">ì¹´ë“œ ë³´ê¸°</button>
                <button id="grid-view-btn" onclick="setVocabView('grid')" class="view-toggle-button w-1/2 py-2 text-sm font-bold text-gray-600 rounded-md" data-translate-key="gridView">ì „ì²´ ë³´ê¸°</button>
            </div>
            
            <div id="vocab-card-view">
                <div id="flashcard-container" class="perspective-1000">
                    <div id="flashcard" class="card relative w-full h-64 rounded-xl shadow-lg cursor-pointer">
                        <div class="card-face absolute w-full h-full bg-sky-100 rounded-xl flex flex-col items-center justify-center p-4">
                            <span id="vocab-category" class="text-sm bg-sky-500 text-white font-semibold px-3 py-1 rounded-full mb-4"></span>
                            <p id="vocab-korean" class="text-5xl font-bold text-sky-900"></p>
                        </div>
                        <div class="card-face card-face-back absolute w-full h-full bg-sky-200 rounded-xl flex flex-col items-center justify-center p-4 text-center">
                            <p id="vocab-translation" class="text-3xl font-bold text-sky-900 mb-4"></p>
                            <p class="text-lg text-gray-700" data-translate-key="examplePrefix">ì˜ˆë¬¸)</p>
                            <p id="vocab-example" class="text-lg text-gray-700"></p>
                        </div>
                    </div>
                </div>
                <div class="flex justify-between mt-6">
                    <button id="prev-vocab" class="bg-gray-300 hover:bg-gray-400 text-gray-800 font-bold py-2 px-6 rounded-lg" data-translate-key="prevBtn">&larr; ì´ì „</button>
                    <button id="next-vocab" class="bg-sky-500 hover:bg-sky-600 text-white font-bold py-2 px-6 rounded-lg" data-translate-key="nextBtn">ë‹¤ìŒ &rarr;</button>
                </div>
            </div>

            <div id="vocab-grid-view" class="hidden h-96 overflow-y-auto grid grid-cols-2 sm:grid-cols-3 gap-2 p-1">
                <!-- Grid items will be injected here -->
            </div>
        </div>

        <!-- Expression App Screen -->
        <div id="expression-app" class="hidden">
             <div class="flex justify-between items-center mb-6">
                 <button onclick="showScreen('main-menu')" class="text-indigo-600 hover:text-indigo-800 font-semibold" data-translate-key="goBack">&larr; ì²˜ìŒìœ¼ë¡œ</button>
                <h2 class="text-2xl font-bold text-indigo-800" data-translate-key="expressionTitle">í‘œí˜„ í•™ìŠµ</h2>
                <div id="exp-counter" class="text-sm text-gray-500 font-medium"></div>
            </div>
            <div class="bg-indigo-50 p-6 rounded-xl mb-4">
                <p id="exp-question" class="text-xl text-center text-indigo-900 font-medium"></p>
            </div>
            <div id="exp-options" class="space-y-3"></div>
            <div id="exp-feedback" class="mt-4 text-center"></div>
             <div class="flex justify-end mt-6">
                <button id="next-exp" class="bg-indigo-500 hover:bg-indigo-600 text-white font-bold py-2 px-6 rounded-lg hidden" data-translate-key="nextQuestionBtn">ë‹¤ìŒ ë¬¸ì œ &rarr;</button>
            </div>
        </div>

        <!-- Grammar App Screen -->
        <div id="grammar-app" class="hidden">
             <div class="flex justify-between items-center mb-4">
                 <button onclick="showScreen('main-menu')" class="text-emerald-600 hover:text-emerald-800 font-semibold" data-translate-key="goBack">&larr; ì²˜ìŒìœ¼ë¡œ</button>
                <h2 class="text-2xl font-bold text-emerald-800" data-translate-key="grammarTitle">ë¬¸ë²• í•™ìŠµ</h2>
                <div id="grammar-counter" class="text-sm text-gray-500 font-medium"></div>
            </div>
            <div class="bg-emerald-50 p-5 rounded-xl border border-emerald-200">
                <h3 id="grammar-rule" class="text-xl font-bold text-emerald-900 mb-2"></h3>
                <p id="grammar-explanation" class="text-gray-700 mb-3"></p>
                <div id="grammar-examples" class="text-gray-600 italic"></div>
            </div>
            <div class="mt-6">
                <p class="font-semibold mb-2 text-center" data-translate-key="quiz">ì—°ìŠµ ë¬¸ì œ</p>
                <div class="bg-gray-100 p-4 rounded-lg mb-3">
                    <p id="grammar-question" class="text-lg text-center text-gray-800"></p>
                </div>
                <div id="grammar-options" class="space-y-2"></div>
                <div id="grammar-feedback" class="mt-3 text-center"></div>
            </div>
             <div class="flex justify-between mt-6">
                <button id="prev-grammar" class="bg-gray-300 hover:bg-gray-400 text-gray-800 font-bold py-2 px-6 rounded-lg" data-translate-key="prevBtn">&larr; ì´ì „</button>
                <button id="next-grammar" class="bg-emerald-500 hover:bg-emerald-600 text-white font-bold py-2 px-6 rounded-lg" data-translate-key="nextBtn">ë‹¤ìŒ &rarr;</button>
            </div>
        </div>
    </div>

    <script>
        // --- TRANSLATION DATA ---
        const uiStrings = {
            mainTitle: { ko: 'íŒ¬ì—ê²Œ ì“°ëŠ” í¸ì§€', vi: 'ThÆ° gá»­i ngÆ°á»i hÃ¢m má»™', ja: 'ãƒ•ã‚¡ãƒ³ã¸ã®æ‰‹ç´™' },
            mainSubtitle: { ko: 'ì‹¬í™” í•™ìŠµ', vi: 'Há»c nÃ¢ng cao', ja: 'æ·±åŒ–å­¦ç¿’' },
            vocabTitle: { ko: 'ì–´íœ˜ í•™ìŠµ', vi: 'Há»c tá»« vá»±ng', ja: 'èªå½™å­¦ç¿’' },
            expressionTitle: { ko: 'í‘œí˜„ í•™ìŠµ', vi: 'Há»c biá»ƒu hiá»‡n', ja: 'è¡¨ç¾å­¦ç¿’' },
            grammarTitle: { ko: 'ë¬¸ë²• í•™ìŠµ', vi: 'Há»c ngá»¯ phÃ¡p', ja: 'æ–‡æ³•å­¦ç¿’' },
            goBack: { ko: 'ì²˜ìŒìœ¼ë¡œ', vi: 'Trá»Ÿ vá»', ja: 'æœ€åˆã¸' },
            examplePrefix: { ko: 'ì˜ˆë¬¸)', vi: 'VÃ­ dá»¥)', ja: 'ä¾‹æ–‡)' },
            prevBtn: { ko: 'ì´ì „', vi: 'TrÆ°á»›c', ja: 'å‰ã¸' },
            nextBtn: { ko: 'ë‹¤ìŒ', vi: 'Sau', ja: 'æ¬¡ã¸' },
            cardView: { ko: 'ì¹´ë“œ ë³´ê¸°', vi: 'Xem tháº»', ja: 'ã‚«ãƒ¼ãƒ‰è¡¨ç¤º' },
            gridView: { ko: 'ì „ì²´ ë³´ê¸°', vi: 'Xem táº¥t cáº£', ja: 'ä¸€è¦§è¡¨ç¤º' },
            nextQuestionBtn: { ko: 'ë‹¤ìŒ ë¬¸ì œ', vi: 'CÃ¢u tiáº¿p theo', ja: 'æ¬¡ã®å•é¡Œ' },
            quiz: { ko: 'ì—°ìŠµ ë¬¸ì œ', vi: 'BÃ i táº­p', ja: 'ç·´ç¿’å•é¡Œ' },
            correct: { ko: 'ì •ë‹µì…ë‹ˆë‹¤!', vi: 'ÄÃºng rá»“i!', ja: 'æ­£è§£ã§ã™ï¼' },
            incorrect: { ko: 'í‹€ë ¸ìŠµë‹ˆë‹¤.', vi: 'Sai rá»“i.', ja: 'é–“é•ã„ã§ã™ã€‚' },
            incorrect_answer: { ko: 'í‹€ë ¸ìŠµë‹ˆë‹¤. ì •ë‹µì€', vi: 'Sai rá»“i. ÄÃ¡p Ã¡n Ä‘Ãºng lÃ ', ja: 'é–“é•ã„ã§ã™ã€‚æ­£è§£ã¯' },
            is: { ko: 'ì…ë‹ˆë‹¤.', vi: 'lÃ .', ja: 'ã§ã™ã€‚' }
        };

        const vocabularyData = [
            { korean: 'ë“ ë“ í•˜ë‹¤', vi: 'Vá»¯ng chÃ£i, Ä‘Ã¡ng tin cáº­y', ja: 'å¿ƒå¼·ã„', category: { ko: 'íŒ¬/ì‘ì› ê´€ë ¨', vi: 'LiÃªn quan Ä‘áº¿n fan/cá»• vÅ©', ja: 'ãƒ•ã‚¡ãƒ³ãƒ»å¿œæ´é–¢é€£' }, example: { ko: 'íŒ¬ ì—¬ëŸ¬ë¶„ì´ ìˆì–´ì„œ ì •ë§ ë“ ë“ í•´ìš”.', vi: 'CÃ³ cÃ¡c báº¡n fan á»Ÿ Ä‘Ã¢y, tÃ´i tháº­t sá»± cáº£m tháº¥y ráº¥t vá»¯ng tÃ¢m.', ja: 'ãƒ•ã‚¡ãƒ³ã®çš†ã•ã‚“ãŒã„ã¦æœ¬å½“ã«å¿ƒå¼·ã„ã§ã™ã€‚' } },
            { korean: 'ì˜ê´‘ìŠ¤ëŸ½ë‹¤', vi: 'Vinh dá»±', ja: 'å…‰æ „ã ', category: { ko: 'ê¸ì •ì  ê°ì •', vi: 'Cáº£m xÃºc tÃ­ch cá»±c', ja: 'è‚¯å®šçš„æ„Ÿæƒ…' }, example: { ko: 'ì´ ìƒì„ ë°›ê²Œ ë˜ì–´ ì •ë§ ì˜ê´‘ìŠ¤ëŸ½ìŠµë‹ˆë‹¤.', vi: 'TÃ´i tháº­t sá»± ráº¥t vinh dá»± khi nháº­n Ä‘Æ°á»£c giáº£i thÆ°á»Ÿng nÃ y.', ja: 'ã“ã®è³ã‚’ã„ãŸã ã‘ã¦æœ¬å½“ã«å…‰æ „ã§ã™ã€‚' } },
            { korean: 'ì†¡êµ¬ìŠ¤ëŸ½ë‹¤', vi: 'Cáº£m tháº¥y cÃ³ lá»—i, Ã¡y nÃ¡y', ja: 'æç¸®ã ', category: { ko: 'ë¶€ì •ì  ê°ì •', vi: 'Cáº£m xÃºc tiÃªu cá»±c', ja: 'å¦å®šçš„æ„Ÿæƒ…' }, example: { ko: 'ë‚˜ìœ ì†Œì‹ì„ ì „í•˜ê²Œ ë˜ì–´ ì†¡êµ¬ìŠ¤ëŸ½ìŠµë‹ˆë‹¤.', vi: 'TÃ´i ráº¥t Ã¡y nÃ¡y khi pháº£i bÃ¡o tin khÃ´ng tá»‘t nÃ y.', ja: 'æ‚ªã„çŸ¥ã‚‰ã›ã‚’ãŠä¼ãˆã™ã‚‹ã“ã¨ã«ãªã‚Šã€æç¸®ã§ã™ã€‚' } },
            { korean: 'ëŒì´ì¼œë³´ë‹¤', vi: 'NhÃ¬n láº¡i', ja: 'æŒ¯ã‚Šè¿”ã‚‹', category: { ko: 'ê³¼ê±° íšŒìƒ', vi: 'Há»“i tÆ°á»Ÿng quÃ¡ khá»©', ja: 'éå»å›æƒ³' }, example: { ko: 'ì§€ë‚œ 10ë…„ì„ ëŒì´ì¼œë³´ë©´ ëª¨ë“  ìˆœê°„ì´ ì†Œì¤‘í–ˆì–´ìš”.', vi: 'NhÃ¬n láº¡i 10 nÄƒm qua, má»i khoáº£nh kháº¯c Ä‘á»u tháº­t quÃ½ giÃ¡.', ja: 'éããŸ10å¹´ã‚’æŒ¯ã‚Šè¿”ã‚‹ã¨ã€ã™ã¹ã¦ã®ç¬é–“ãŒå¤§åˆ‡ã§ã—ãŸã€‚' } },
            { korean: 'ì¸ì—°', vi: 'NhÃ¢n duyÃªn', ja: 'ç¸', category: { ko: 'ìƒí™©ë³„ (ê²°í˜¼)', vi: 'Theo tÃ¬nh huá»‘ng (Káº¿t hÃ´n)', ja: 'çŠ¶æ³åˆ¥ï¼ˆçµå©šï¼‰' }, example: { ko: 'ìš°ë¦¬ì˜ ì¸ì—°ì€ ì •ë§ íŠ¹ë³„í•˜ë‹¤ê³  ìƒê°í•´ìš”.', vi: 'TÃ´i nghÄ© ráº±ng nhÃ¢n duyÃªn cá»§a chÃºng ta tháº­t Ä‘áº·c biá»‡t.', ja: 'ç§ãŸã¡ã®ç¸ã¯æœ¬å½“ã«ç‰¹åˆ¥ã ã¨æ€ã„ã¾ã™ã€‚' } },
            { korean: 'ìœ ì¢…ì˜ ë¯¸', vi: 'Váº» Ä‘áº¹p cá»§a sá»± káº¿t thÃºc cÃ³ háº­u', ja: 'æœ‰çµ‚ã®ç¾', category: { ko: 'ìƒí™©ë³„ (í•´ì²´)', vi: 'Theo tÃ¬nh huá»‘ng (Tan rÃ£)', ja: 'çŠ¶æ³åˆ¥ï¼ˆè§£æ•£ï¼‰' }, example: { ko: 'ë§ˆì§€ë§‰ê¹Œì§€ ìµœì„ ì„ ë‹¤í•´ ìœ ì¢…ì˜ ë¯¸ë¥¼ ê±°ë‘ê³  ì‹¶ì–´ìš”.', vi: 'TÃ´i muá»‘n cá»‘ gáº¯ng háº¿t sá»©c Ä‘áº¿n cuá»‘i cÃ¹ng Ä‘á»ƒ cÃ³ má»™t káº¿t thÃºc tá»‘t Ä‘áº¹p.', ja: 'æœ€å¾Œã¾ã§æœ€å–„ã‚’å°½ãã—ã¦æœ‰çµ‚ã®ç¾ã‚’é£¾ã‚ŠãŸã„ã§ã™ã€‚' } },
            { korean: 'ê¸°ë‹¤ë ¤ ì£¼ë‹¤', vi: 'Chá» Ä‘á»£i', ja: 'å¾…ã£ã¦ãã‚Œã‚‹', category: { ko: 'ìƒí™©ë³„ (ì…ëŒ€)', vi: 'Theo tÃ¬nh huá»‘ng (Nháº­p ngÅ©)', ja: 'çŠ¶æ³åˆ¥ï¼ˆå…¥éšŠï¼‰' }, example: { ko: 'ì œê°€ ëŒì•„ì˜¬ ë•Œê¹Œì§€ ê±´ê°•í•˜ê²Œ ê¸°ë‹¤ë ¤ ì£¼ì„¸ìš”.', vi: 'HÃ£y chá» Ä‘á»£i tÃ´i má»™t cÃ¡ch khá»e máº¡nh cho Ä‘áº¿n ngÃ y tÃ´i trá»Ÿ vá» nhÃ©.', ja: 'ç§ãŒæˆ»ã‚‹ã¾ã§å…ƒæ°—ã«å¾…ã£ã¦ã„ã¦ãã ã•ã„ã€‚' } }
        ];
        
        const expressionData = [
            {
                question: { ko: 'íŒ¬ ì—¬ëŸ¬ë¶„ì€ ì €ì—ê²Œ ê°€ì¥ ___ ì¡´ì¬ì…ë‹ˆë‹¤.', vi: 'CÃ¡c báº¡n fan lÃ  sá»± tá»“n táº¡i ___ nháº¥t Ä‘á»‘i vá»›i tÃ´i.', ja: 'ãƒ•ã‚¡ãƒ³ã®çš†ã•ã‚“ã¯ç§ã«ã¨ã£ã¦æœ€ã‚‚___å­˜åœ¨ã§ã™ã€‚' },
                options: { ko: ['ë“ ë“ í•œ', 'ë¬´ê±°ìš´', 'ì•„ì‰¬ìš´'], vi: ['vá»¯ng chÃ£i', 'náº·ng ná»', 'tiáº¿c nuá»‘i'], ja: ['å¿ƒå¼·ã„', 'é‡ã„', 'æ®‹å¿µãª'] },
                answer: 'ë“ ë“ í•œ',
                explanation: { ko: "'ë“ ë“ í•˜ë‹¤'ëŠ” ì˜ì§€í•  ìˆ˜ ìˆì–´ ë§ˆìŒì´ ë†“ì¸ë‹¤ëŠ” ê¸ì •ì ì¸ ì˜ë¯¸ì…ë‹ˆë‹¤.", vi: "'ë“ ë“ í•˜ë‹¤' cÃ³ nghÄ©a tÃ­ch cá»±c lÃ  cÃ³ thá»ƒ dá»±a dáº«m vÃ o nÃªn cáº£m tháº¥y yÃªn tÃ¢m.", ja: "ã€Œë“ ë“ í•˜ë‹¤ã€ã¯é ¼ã‚Šã«ãªã£ã¦å¿ƒãŒå®‰ã‚‰ãã¨ã„ã†è‚¯å®šçš„ãªæ„å‘³ã§ã™ã€‚" }
            },
            {
                question: { ko: 'ì§€ë‚œ í™œë™ì„ ___ ë³´ë‹ˆ, íŒ¬ë“¤ì˜ ì‚¬ë‘ì´ ê°€ì¥ ê¸°ì–µì— ë‚¨ìŠµë‹ˆë‹¤.', vi: '___ cÃ¡c hoáº¡t Ä‘á»™ng Ä‘Ã£ qua, tÃ´i nhá»› nháº¥t lÃ  tÃ¬nh yÃªu cá»§a cÃ¡c báº¡n fan.', ja: 'ã“ã‚Œã¾ã§ã®æ´»å‹•ã‚’___ã€ãƒ•ã‚¡ãƒ³ã®çš†ã•ã‚“ã®æ„›ãŒæœ€ã‚‚è¨˜æ†¶ã«æ®‹ã£ã¦ã„ã¾ã™ã€‚' },
                options: { ko: ['ëŒì´ì¼œ', 'ë°”ë¼', 'ë‚´ë‹¤'], vi: ['NhÃ¬n láº¡i', 'NhÃ¬n', 'NhÃ¬n ra'], ja: ['æŒ¯ã‚Šè¿”ã£ã¦', 'çœºã‚ã¦', 'è¦‹å‡ºã—ã¦'] },
                answer: 'ëŒì´ì¼œ',
                explanation: { ko: "'ëŒì´ì¼œë³´ë‹¤'ëŠ” ê³¼ê±°ì˜ ì¼ì„ ë‹¤ì‹œ ìƒê°í•´ ë³¸ë‹¤ëŠ” ì˜ë¯¸ì…ë‹ˆë‹¤.", vi: "'ëŒì´ì¼œë³´ë‹¤' cÃ³ nghÄ©a lÃ  suy nghÄ© láº¡i vá» chuyá»‡n trong quÃ¡ khá»©.", ja: "ã€ŒëŒì´ì¼œë³´ë‹¤ã€ã¯éå»ã®ã“ã¨ã‚’ã‚‚ã†ä¸€åº¦è€ƒãˆã¦ã¿ã‚‹ã¨ã„ã†æ„å‘³ã§ã™ã€‚" }
            },
            {
                question: { ko: 'ê·¸ë£¹ í™œë™ì€ ëë‚˜ì§€ë§Œ, ì´ê²ƒì´ ___ ìƒˆë¡œìš´ ë„ì „ì˜ ì‹œì‘ì…ë‹ˆë‹¤.', vi: 'Hoáº¡t Ä‘á»™ng nhÃ³m káº¿t thÃºc, nhÆ°ng Ä‘Ã¢y lÃ  sá»± khá»Ÿi Ä‘áº§u cá»§a má»™t thá»­ thÃ¡ch má»›i ___.', ja: 'ã‚°ãƒ«ãƒ¼ãƒ—æ´»å‹•ã¯çµ‚ã‚ã‚Šã¾ã™ãŒã€ã“ã‚Œã¯___æ–°ã—ã„æŒ‘æˆ¦ã®å§‹ã¾ã‚Šã§ã™ã€‚' },
                options: { ko: ['ê°ìì˜ ê¸¸ì—ì„œ', 'í•¨ê»˜í•˜ëŠ” ê¸¸ì—ì„œ', 'í•˜ë‚˜ì˜ ê¸¸ì—ì„œ'], vi: ['trÃªn con Ä‘Æ°á»ng riÃªng cá»§a má»—i ngÆ°á»i', 'trÃªn con Ä‘Æ°á»ng cÃ¹ng nhau', 'trÃªn má»™t con Ä‘Æ°á»ng'], ja: ['ãã‚Œãã‚Œã®é“ã§', 'å…±ã«ã™ã‚‹é“ã§', 'ä¸€ã¤ã®é“ã§'] },
                answer: 'ê°ìì˜ ê¸¸ì—ì„œ',
                explanation: { ko: "ê·¸ë£¹ í•´ì²´ í›„ ë©¤ë²„ë“¤ì´ ê°ì í™œë™ì„ ì‹œì‘í•  ë•Œ ì‚¬ìš©í•˜ëŠ” í‘œí˜„ì…ë‹ˆë‹¤.", vi: "ÄÃ¢y lÃ  biá»ƒu hiá»‡n Ä‘Æ°á»£c sá»­ dá»¥ng khi cÃ¡c thÃ nh viÃªn báº¯t Ä‘áº§u hoáº¡t Ä‘á»™ng riÃªng sau khi nhÃ³m tan rÃ£.", ja: "ã‚°ãƒ«ãƒ¼ãƒ—è§£æ•£å¾Œã€ãƒ¡ãƒ³ãƒãƒ¼ãŒå„è‡ªã§æ´»å‹•ã‚’å§‹ã‚ã‚‹ã¨ãã«ä½¿ã†è¡¨ç¾ã§ã™ã€‚" }
            }
        ];
        const grammarData = [
            {
                rule: '-(ìœ¼)ë ¤ê³ /ê³ ì í•©ë‹ˆë‹¤',
                explanation: { ko: 'ì–´ë–¤ í–‰ë™ì„ í•  ì˜ë„ë‚˜ ê³„íšì´ ìˆìŒì„ ê²©ì‹ì ìœ¼ë¡œ ì•Œë¦´ ë•Œ ì‚¬ìš©í•©ë‹ˆë‹¤. â€˜-ê³ ì í•©ë‹ˆë‹¤â€™ê°€ ë” ê²©ì‹ì ì…ë‹ˆë‹¤.', vi: 'Sá»­ dá»¥ng khi thÃ´ng bÃ¡o má»™t cÃ¡ch trang trá»ng vá» Ã½ Ä‘á»‹nh hoáº·c káº¿ hoáº¡ch sáº½ lÃ m má»™t hÃ nh Ä‘á»™ng nÃ o Ä‘Ã³. â€˜-ê³ ì í•©ë‹ˆë‹¤â€™ mang tÃ­nh trang trá»ng hÆ¡n.', ja: 'ã‚ã‚‹è¡Œå‹•ã‚’ã™ã‚‹æ„å›³ã‚„è¨ˆç”»ãŒã‚ã‚‹ã“ã¨ã‚’æ ¼å¼å¼µã£ã¦çŸ¥ã‚‰ã›ã‚‹éš›ã«ä½¿ã„ã¾ã™ã€‚ã€Œ-ê³ ì í•©ë‹ˆë‹¤ã€ãŒã‚ˆã‚Šæ ¼å¼çš„ã§ã™ã€‚' },
                examples: {
                    ko: ['ì—¬ëŸ¬ë¶„ê»˜ ì¤‘ìš”í•œ ì†Œì‹ì„ ì „í•˜ê³ ì í•©ë‹ˆë‹¤.', 'ì´ì œ ì ì‹œ ì—¬ëŸ¬ë¶„ ê³ì„ ë– ë‚˜ë ¤ê³  í•©ë‹ˆë‹¤.'],
                    vi: ['TÃ´i muá»‘n thÃ´ng bÃ¡o má»™t tin quan trá»ng Ä‘áº¿n cÃ¡c báº¡n.', 'BÃ¢y giá» tÃ´i Ä‘á»‹nh táº¡m thá»i rá»i xa cÃ¡c báº¡n.'],
                    ja: ['çš†æ§˜ã«é‡è¦ãªãŠçŸ¥ã‚‰ã›ã‚’ãŠä¼ãˆã—ãŸã„ã¨æ€ã„ã¾ã™ã€‚', 'ã“ã‚Œã‹ã‚‰ã—ã°ã‚‰ãçš†æ§˜ã®ãã°ã‚’é›¢ã‚Œã‚ˆã†ã¨æ€ã„ã¾ã™ã€‚']
                },
                quiz: {
                    question: { ko: 'ì˜¤ëŠ˜ ì´ ìë¦¬ì—ì„œ ì œ ê²°í˜¼ ì†Œì‹ì„ ___ í•©ë‹ˆë‹¤.', vi: 'HÃ´m nay táº¡i Ä‘Ã¢y, tÃ´i ___ thÃ´ng bÃ¡o tin káº¿t hÃ´n cá»§a mÃ¬nh.', ja: 'æœ¬æ—¥ã“ã®å ´ã§ã€ç§ã®çµå©šã®çŸ¥ã‚‰ã›ã‚’___ã¨æ€ã„ã¾ã™ã€‚' },
                    options: { ko: ['ì•Œë¦¬ê³ ì', 'ì•Œë ¤ì„œ', 'ì•Œë¦¬ì§€ë§Œ'], vi: ['muá»‘n thÃ´ng bÃ¡o', 'vÃ¬ thÃ´ng bÃ¡o', 'tuy thÃ´ng bÃ¡o'], ja: ['ãŠçŸ¥ã‚‰ã›ã—ã‚ˆã†ã¨', 'ãŠçŸ¥ã‚‰ã›ã—ã¦', 'ãŠçŸ¥ã‚‰ã›ã—ã¾ã™ãŒ'] },
                    answer: 'ì•Œë¦¬ê³ ì'
                }
            },
            {
                rule: '-ë„ë¡ ë…¸ë ¥í•˜ê² ìŠµë‹ˆë‹¤',
                explanation: { ko: 'ì–´ë–¤ ëª©í‘œë¥¼ ì´ë£¨ê¸° ìœ„í•´ í˜ì“°ê² ë‹¤ëŠ” ë‹¤ì§ì´ë‚˜ ì•½ì†ì„ ë‚˜íƒ€ëƒ…ë‹ˆë‹¤.', vi: 'Thá»ƒ hiá»‡n sá»± quyáº¿t tÃ¢m hoáº·c lá»i há»©a sáº½ ná»— lá»±c Ä‘á»ƒ Ä‘áº¡t Ä‘Æ°á»£c má»™t má»¥c tiÃªu nÃ o Ä‘Ã³.', ja: 'ã‚ã‚‹ç›®æ¨™ã‚’é”æˆã™ã‚‹ãŸã‚ã«åŠ›ã‚’å°½ãã™ã¨ã„ã†èª“ã„ã‚„ç´„æŸã‚’è¡¨ã—ã¾ã™ã€‚' },
                examples: {
                    ko: ['ë” ì¢‹ì€ ëª¨ìŠµì„ ë³´ì—¬ ë“œë¦¬ë„ë¡ ë…¸ë ¥í•˜ê² ìŠµë‹ˆë‹¤.', 'íŒ¬ë“¤ì—ê²Œ ì‹¤ë§ì„ ì£¼ì§€ ì•Šë„ë¡ ë…¸ë ¥í•˜ê² ìŠµë‹ˆë‹¤.'],
                    vi: ['TÃ´i sáº½ ná»— lá»±c Ä‘á»ƒ cho cÃ¡c báº¡n tháº¥y má»™t hÃ¬nh áº£nh tá»‘t hÆ¡n.', 'TÃ´i sáº½ ná»— lá»±c Ä‘á»ƒ khÃ´ng lÃ m cÃ¡c fan tháº¥t vá»ng.'],
                    ja: ['ã‚ˆã‚Šè‰¯ã„å§¿ã‚’ãŠè¦‹ã›ã§ãã‚‹ã‚ˆã†åŠªåŠ›ã—ã¾ã™ã€‚', 'ãƒ•ã‚¡ãƒ³ã®çš†ã•ã‚“ã‚’ãŒã£ã‹ã‚Šã•ã›ãªã„ã‚ˆã†åŠªåŠ›ã—ã¾ã™ã€‚']
                },
                quiz: {
                    question: { ko: 'í•­ìƒ ì´ˆì‹¬ì„ ìƒì§€ ì•Š___ ë…¸ë ¥í•˜ê² ìŠµë‹ˆë‹¤.', vi: 'TÃ´i sáº½ ná»— lá»±c Ä‘á»ƒ luÃ´n khÃ´ng Ä‘Ã¡nh máº¥t tÃ¢m nguyá»‡n ban Ä‘áº§u ___.', ja: 'å¸¸ã«åˆå¿ƒã‚’å¿˜ã‚Œãªã„___åŠªåŠ›ã—ã¾ã™ã€‚' },
                    options: { ko: ['ë„ë¡', 'ì²˜ëŸ¼', 'ë³´ë‹¤'], vi: ['Ä‘á»ƒ', 'nhÆ°', 'hÆ¡n'], ja: ['ã‚ˆã†', 'ã‚ˆã†ã«', 'ã‚ˆã‚Š'] },
                    answer: 'ë„ë¡'
                }
            },
            {
                rule: '-(ìœ¼)ã„¹ ê²ƒì„ ì•½ì†ë“œë¦½ë‹ˆë‹¤',
                explanation: { ko: 'ë¯¸ë˜ì˜ í–‰ë™ì— ëŒ€í•´ ê°•í•œ ì˜ì§€ë¥¼ ë‹´ì•„ ê³µì‹ì ìœ¼ë¡œ ì•½ì†í•  ë•Œ ì‚¬ìš©í•©ë‹ˆë‹¤.', vi: 'Sá»­ dá»¥ng khi há»©a má»™t cÃ¡ch chÃ­nh thá»©c vá» hÃ nh Ä‘á»™ng trong tÆ°Æ¡ng lai vá»›i Ã½ chÃ­ máº¡nh máº½.', ja: 'æœªæ¥ã®è¡Œå‹•ã«ã¤ã„ã¦å¼·ã„æ„å¿—ã‚’è¾¼ã‚ã¦å…¬å¼ã«ç´„æŸã™ã‚‹éš›ã«ä½¿ã„ã¾ã™ã€‚' },
                examples: {
                    ko: ['ë” ë©‹ì§„ ì‚¬ëŒìœ¼ë¡œ ëŒì•„ì˜¬ ê²ƒì„ ì•½ì†ë“œë¦½ë‹ˆë‹¤.', 'ì—¬ëŸ¬ë¶„ì˜ ì‚¬ë‘ì— ë³´ë‹µí•  ê²ƒì„ ì•½ì†ë“œë¦½ë‹ˆë‹¤.'],
                    vi: ['TÃ´i há»©a sáº½ trá»Ÿ láº¡i vá»›i tÆ° cÃ¡ch lÃ  má»™t ngÆ°á»i tuyá»‡t vá»i hÆ¡n.', 'TÃ´i há»©a sáº½ Ä‘á»n Ä‘Ã¡p tÃ¬nh yÃªu cá»§a cÃ¡c báº¡n.'],
                    ja: ['ã‚ˆã‚Šç´ æ•µãªäººã«ãªã£ã¦æˆ»ã£ã¦ãã‚‹ã“ã¨ã‚’ç´„æŸã—ã¾ã™ã€‚', 'çš†æ§˜ã®æ„›ã«å¿œãˆã‚‹ã“ã¨ã‚’ç´„æŸã—ã¾ã™ã€‚']
                },
                quiz: {
                    question: { ko: 'ë‹¤ì‹œ ë§Œë‚  ë‚ ê¹Œì§€ ê±´ê°•í•  ___ ì•½ì†ë“œë¦½ë‹ˆë‹¤.', vi: 'TÃ´i há»©a sáº½ khá»e máº¡nh ___ cho Ä‘áº¿n ngÃ y chÃºng ta gáº·p láº¡i.', ja: 'ã¾ãŸä¼šã†æ—¥ã¾ã§å…ƒæ°—ã§ã„ã‚‹___ç´„æŸã—ã¾ã™ã€‚' },
                    options: { ko: ['ê²ƒì„', 'ê²ƒì´', 'ê²ƒë„'], vi: ['ráº±ng sáº½', 'viá»‡c', 'cáº£ viá»‡c'], ja: ['ã“ã¨ã‚’', 'ã“ã¨ãŒ', 'ã“ã¨ã‚‚'] },
                    answer: 'ê²ƒì„'
                }
            }
        ];

        // --- GLOBAL STATE ---
        let currentLang = 'ko';
        let currentVocabView = 'card';
        let currentScreen = 'main-menu';
        let currentVocabIndex = 0;
        let currentExpIndex = 0;
        let currentGrammarIndex = 0;

        // --- DOM ELEMENTS ---
        const allScreens = document.querySelectorAll('#app-container > div[id]');
        const screens = {
            'main-menu': document.getElementById('main-menu'),
            'vocab-app': document.getElementById('vocab-app'),
            'expression-app': document.getElementById('expression-app'),
            'grammar-app': document.getElementById('grammar-app')
        };
        const vocabCardView = document.getElementById('vocab-card-view');
        const vocabGridView = document.getElementById('vocab-grid-view');
        const cardViewBtn = document.getElementById('card-view-btn');
        const gridViewBtn = document.getElementById('grid-view-btn');
        const flashcard = document.getElementById('flashcard');
        const vocabCategory = document.getElementById('vocab-category');
        const vocabKorean = document.getElementById('vocab-korean');
        const vocabTranslation = document.getElementById('vocab-translation');
        const vocabExample = document.getElementById('vocab-example');
        const prevVocabBtn = document.getElementById('prev-vocab');
        const nextVocabBtn = document.getElementById('next-vocab');
        const vocabCounter = document.getElementById('vocab-counter');
        const expQuestion = document.getElementById('exp-question');
        const expOptionsContainer = document.getElementById('exp-options');
        const expFeedback = document.getElementById('exp-feedback');
        const nextExpBtn = document.getElementById('next-exp');
        const expCounter = document.getElementById('exp-counter');
        const grammarRule = document.getElementById('grammar-rule');
        const grammarExplanation = document.getElementById('grammar-explanation');
        const grammarExamples = document.getElementById('grammar-examples');
        const grammarQuestion = document.getElementById('grammar-question');
        const grammarOptionsContainer = document.getElementById('grammar-options');
        const grammarFeedback = document.getElementById('grammar-feedback');
        const prevGrammarBtn = document.getElementById('prev-grammar');
        const nextGrammarBtn = document.getElementById('next-grammar');
        const grammarCounter = document.getElementById('grammar-counter');

        // --- FUNCTIONS ---
        function setLanguage(lang) {
            currentLang = lang;
            document.documentElement.className = `lang-${lang}`;
            
            document.querySelectorAll('.lang-button').forEach(btn => btn.classList.remove('active'));
            document.querySelector(`.lang-button:nth-child(${['ko', 'vi', 'ja'].indexOf(lang) + 1})`).classList.add('active');

            document.querySelectorAll('[data-translate-key]').forEach(el => {
                const key = el.dataset.translateKey;
                if (uiStrings[key] && uiStrings[key][currentLang]) {
                    el.textContent = uiStrings[key][currentLang];
                }
            });

            switch (currentScreen) {
                case 'vocab-app': renderVocabApp(); break;
                case 'expression-app': loadExpression(currentExpIndex); break;
                case 'grammar-app': loadGrammar(currentGrammarIndex); break;
            }
        }
        
        function showScreen(screenId) {
            allScreens.forEach(screen => screen.classList.add('hidden'));
            screens[screenId].classList.remove('hidden');
            currentScreen = screenId;

            if (screenId === 'vocab-app') initVocabApp();
            if (screenId === 'expression-app') initExpressionApp();
            if (screenId === 'grammar-app') initGrammarApp();
        }

        // --- Vocabulary App Logic ---
        function initVocabApp() {
            currentVocabIndex = 0;
            setVocabView('card');
        }

        function setVocabView(view) {
            currentVocabView = view;
            if (view === 'card') {
                vocabCardView.classList.remove('hidden');
                vocabGridView.classList.add('hidden');
                cardViewBtn.classList.add('bg-white', 'text-sky-800', 'shadow-sm');
                cardViewBtn.classList.remove('text-gray-600');
                gridViewBtn.classList.add('text-gray-600');
                gridViewBtn.classList.remove('bg-white', 'text-sky-800', 'shadow-sm');
                loadCardView(currentVocabIndex);
            } else {
                vocabCardView.classList.add('hidden');
                vocabGridView.classList.remove('hidden');
                gridViewBtn.classList.add('bg-white', 'text-sky-800', 'shadow-sm');
                gridViewBtn.classList.remove('text-gray-600');
                cardViewBtn.classList.add('text-gray-600');
                cardViewBtn.classList.remove('bg-white', 'text-sky-800', 'shadow-sm');
                loadGridView();
            }
        }
        
        function renderVocabApp() {
             if (currentVocabView === 'card') loadCardView(currentVocabIndex);
             else loadGridView();
        }

        function loadCardView(index) {
            flashcard.classList.remove('is-flipped');
            const vocab = vocabularyData[index];
            vocabCategory.textContent = vocab.category[currentLang];
            vocabKorean.textContent = vocab.korean;
            vocabTranslation.textContent = vocab[currentLang];
            vocabExample.textContent = vocab.example[currentLang];
            vocabCounter.textContent = `${index + 1} / ${vocabularyData.length}`;
            prevVocabBtn.disabled = index === 0;
            nextVocabBtn.disabled = index === vocabularyData.length - 1;
        }

        function loadGridView() {
            vocabGridView.innerHTML = '';
            vocabularyData.forEach(vocab => {
                const card = document.createElement('div');
                card.className = "bg-sky-50 border border-sky-200 rounded-lg p-3 text-center";
                card.innerHTML = `<p class="font-bold text-sky-900">${vocab.korean}</p><p class="text-sm text-gray-700">${vocab[currentLang]}</p>`;
                vocabGridView.appendChild(card);
            });
        }
        
        flashcard.addEventListener('click', () => flashcard.classList.toggle('is-flipped'));
        prevVocabBtn.addEventListener('click', () => { if (currentVocabIndex > 0) loadCardView(--currentVocabIndex); });
        nextVocabBtn.addEventListener('click', () => { if (currentVocabIndex < vocabularyData.length - 1) loadCardView(++currentVocabIndex); });

        // --- Expression App Logic ---
        function initExpressionApp() {
            currentExpIndex = 0;
            loadExpression(currentExpIndex);
        }

        function loadExpression(index) {
            const exp = expressionData[index];
            expQuestion.textContent = exp.question[currentLang];
            expOptionsContainer.innerHTML = '';
            
            exp.options.ko.forEach((opt_ko, i) => {
                const button = document.createElement('button');
                button.className = "quiz-option w-full text-left p-4 rounded-lg border-2 border-indigo-200 bg-white text-indigo-800 font-semibold";
                button.textContent = exp.options[currentLang][i];
                button.dataset.answerKey = opt_ko;
                button.onclick = () => checkExpressionAnswer(button, exp.answer, exp.explanation);
                expOptionsContainer.appendChild(button);
});
            expFeedback.innerHTML = '';
            nextExpBtn.classList.add('hidden');
            expCounter.textContent = `${index + 1} / ${expressionData.length}`;
        }
        
        function checkExpressionAnswer(selectedButton, correct, explanation) {
            const selected = selectedButton.dataset.answerKey;
            const options = expOptionsContainer.querySelectorAll('button');
            options.forEach(option => {
                option.disabled = true;
                if (option.dataset.answerKey === correct) {
                    option.classList.add('border-green-500', 'bg-green-100');
                }
            });
            if (selected === correct) {
                expFeedback.innerHTML = `<p class="text-green-600 font-bold">${uiStrings.correct[currentLang]}</p>`;
            } else {
                selectedButton.classList.add('border-red-500', 'bg-red-100');
                expFeedback.innerHTML = `<p class="text-red-600 font-bold">${uiStrings.incorrect[currentLang]}</p><p class="text-sm text-gray-600 mt-1">${explanation[currentLang]}</p>`;
            }
            if (currentExpIndex < expressionData.length - 1) {
                nextExpBtn.classList.remove('hidden');
            }
        }

        nextExpBtn.addEventListener('click', () => loadExpression(++currentExpIndex));

        // --- Grammar App Logic ---
        function initGrammarApp() {
            currentGrammarIndex = 0;
            loadGrammar(currentGrammarIndex);
        }

        function loadGrammar(index) {
            const grammar = grammarData[index];
            grammarRule.textContent = grammar.rule;
            grammarExplanation.textContent = grammar.explanation[currentLang];
            grammarExamples.innerHTML = grammar.examples[currentLang].map(ex => `<p>ì˜ˆ) ${ex}</p>`).join('');
            
            const quiz = grammar.quiz;
            grammarQuestion.textContent = quiz.question[currentLang];
            grammarOptionsContainer.innerHTML = '';
            quiz.options.ko.forEach((opt_ko, i) => {
                const button = document.createElement('button');
                button.className = "quiz-option w-full text-left p-3 rounded-lg border-2 border-emerald-200 bg-white text-emerald-800";
                button.textContent = quiz.options[currentLang][i];
                button.dataset.answerKey = opt_ko;
                button.onclick = () => checkGrammarAnswer(button, quiz.answer);
                grammarOptionsContainer.appendChild(button);
            });
            grammarFeedback.innerHTML = '';
            grammarCounter.textContent = `${index + 1} / ${grammarData.length}`;
            prevGrammarBtn.disabled = index === 0;
            nextGrammarBtn.disabled = index === grammarData.length - 1;
        }
        
        function checkGrammarAnswer(selectedButton, correct) {
            const selected = selectedButton.dataset.answerKey;
            const options = grammarOptionsContainer.querySelectorAll('button');
            options.forEach(option => {
                option.disabled = true;
                if (option.dataset.answerKey === correct) {
                    option.classList.add('border-green-500', 'bg-green-100');
                }
            });
            if (selected === correct) {
                grammarFeedback.innerHTML = `<p class="text-green-600 font-bold">${uiStrings.correct[currentLang]}</p>`;
            } else {
                selectedButton.classList.add('border-red-500', 'bg-red-100');
                const correctOptionText = Array.from(options).find(opt => opt.dataset.answerKey === correct).textContent;
                grammarFeedback.innerHTML = `<p class="text-red-600 font-bold">${uiStrings.incorrect_answer[currentLang]} '${correctOptionText}'${uiStrings.is[currentLang]}</p>`;
            }
        }
        prevGrammarBtn.addEventListener('click', () => { if (currentGrammarIndex > 0) loadGrammar(--currentGrammarIndex); });
        nextGrammarBtn.addEventListener('click', () => { if (currentGrammarIndex < grammarData.length - 1) loadGrammar(++currentGrammarIndex); });
        
        setLanguage('ko');
    </script>
</body>
</html>
