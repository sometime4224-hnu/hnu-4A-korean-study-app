<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>íŒ¬ì—ê²Œ ì“°ëŠ” í¸ì§€: í•œêµ­ì–´ í•™ìŠµ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700&family=Noto+Sans+JP:wght@400;500;700&family=Be+Vietnam+Pro:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Noto Sans KR', sans-serif; }
        .lang-ja body { font-family: 'Noto Sans JP', sans-serif; }
        .lang-vi body { font-family: 'Be Vietnam Pro', sans-serif; }
        .card {
            transform-style: preserve-3d;
            transition: transform 0.6s;
        }
        .card.is-flipped {
            transform: rotateY(180deg);
        }
        .card-face {
            backface-visibility: hidden;
            -webkit-backface-visibility: hidden;
        }
        .card-face-back {
            transform: rotateY(180deg);
        }
        .main-button, .lang-button, .view-toggle-button {
            transition: all 0.3s ease;
        }
        .main-button:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }
        .quiz-option:hover {
            background-color: #e0f2fe; /* light blue hover */
        }
        .lang-button.active {
            background-color: #1e40af;
            color: white;
        }
    </style>
</head>
<body class="bg-gray-100 flex items-center justify-center min-h-screen">
    <div id="app-container" class="w-full max-w-lg mx-auto bg-white rounded-2xl shadow-xl p-6 sm:p-8">
        
        <div class="flex justify-end mb-4 space-x-1">
            <button onclick="setLanguage('ko')" class="lang-button active font-semibold py-1 px-3 border border-blue-800 text-blue-800 rounded-full text-sm">KO</button>
            <button onclick="setLanguage('vi')" class="lang-button font-semibold py-1 px-3 border border-blue-800 text-blue-800 rounded-full text-sm">VI</button>
            <button onclick="setLanguage('ja')" class="lang-button font-semibold py-1 px-3 border border-blue-800 text-blue-800 rounded-full text-sm">JA</button>
        </div>

        <!-- Main Menu Screen -->
        <div id="main-menu">
            <div class="text-center">
                <h1 class="text-3xl font-bold text-gray-800 mb-2" data-translate-key="mainTitle">íŒ¬ì—ê²Œ ì“°ëŠ” í¸ì§€</h1>
                <p class="text-lg text-gray-500 mb-8" data-translate-key="mainSubtitle">í•œêµ­ì–´ í•™ìŠµ</p>
            </div>
            <div class="space-y-4">
                <button onclick="showScreen('vocab-app')" class="main-button w-full bg-sky-500 text-white font-bold py-4 px-6 rounded-xl text-xl">
                    <span data-translate-key="vocabTitle">ì–´íœ˜ í•™ìŠµ</span> ğŸ“š
                </button>
                <button onclick="showScreen('expression-app')" class="main-button w-full bg-indigo-500 text-white font-bold py-4 px-6 rounded-xl text-xl">
                    <span data-translate-key="expressionTitle">í‘œí˜„ í•™ìŠµ</span> ğŸ’¬
                </button>
                <button onclick="showScreen('grammar-app')" class="main-button w-full bg-emerald-500 text-white font-bold py-4 px-6 rounded-xl text-xl">
                    <span data-translate-key="grammarTitle">ë¬¸ë²• í•™ìŠµ</span> âœï¸
                </button>
            </div>
        </div>

        <!-- Vocabulary App Screen -->
        <div id="vocab-app" class="hidden">
            <div class="flex justify-between items-center mb-4">
                <button onclick="showScreen('main-menu')" class="text-sky-600 hover:text-sky-800 font-semibold" data-translate-key="goBack">&larr; ì²˜ìŒìœ¼ë¡œ</button>
                <h2 class="text-2xl font-bold text-sky-800" data-translate-key="vocabTitle">ì–´íœ˜ í•™ìŠµ</h2>
                <div id="vocab-counter" class="text-sm text-gray-500 font-medium"></div>
            </div>

            <div class="flex justify-center my-4 bg-gray-200 p-1 rounded-lg">
                <button id="card-view-btn" onclick="setVocabView('card')" class="view-toggle-button w-1/2 py-2 text-sm font-bold bg-white text-sky-800 rounded-md shadow-sm" data-translate-key="cardView">ì¹´ë“œ ë³´ê¸°</button>
                <button id="grid-view-btn" onclick="setVocabView('grid')" class="view-toggle-button w-1/2 py-2 text-sm font-bold text-gray-600 rounded-md" data-translate-key="gridView">ì „ì²´ ë³´ê¸°</button>
            </div>
            
            <div id="vocab-card-view">
                <div id="flashcard-container" class="perspective-1000">
                    <div id="flashcard" class="card relative w-full h-64 rounded-xl shadow-lg cursor-pointer">
                        <div class="card-face absolute w-full h-full bg-sky-100 rounded-xl flex flex-col items-center justify-center p-4">
                            <span id="vocab-category" class="text-sm bg-sky-500 text-white font-semibold px-3 py-1 rounded-full mb-4"></span>
                            <p id="vocab-korean" class="text-5xl font-bold text-sky-900"></p>
                        </div>
                        <div class="card-face card-face-back absolute w-full h-full bg-sky-200 rounded-xl flex flex-col items-center justify-center p-4 text-center">
                            <p id="vocab-translation" class="text-3xl font-bold text-sky-900 mb-4"></p>
                            <p class="text-lg text-gray-700" data-translate-key="examplePrefix">ì˜ˆë¬¸)</p>
                            <p id="vocab-example" class="text-lg text-gray-700"></p>
                        </div>
                    </div>
                </div>
                <div class="flex justify-between mt-6">
                    <button id="prev-vocab" class="bg-gray-300 hover:bg-gray-400 text-gray-800 font-bold py-2 px-6 rounded-lg" data-translate-key="prevBtn">&larr; ì´ì „</button>
                    <button id="next-vocab" class="bg-sky-500 hover:bg-sky-600 text-white font-bold py-2 px-6 rounded-lg" data-translate-key="nextBtn">ë‹¤ìŒ &rarr;</button>
                </div>
            </div>

            <div id="vocab-grid-view" class="hidden h-96 overflow-y-auto grid grid-cols-2 sm:grid-cols-3 gap-2 p-1">
                <!-- Grid items will be injected here -->
            </div>
        </div>

        <!-- Other apps remain largely unchanged in HTML structure but their content will be translated -->
        <div id="expression-app" class="hidden">
             <div class="flex justify-between items-center mb-6">
                 <button onclick="showScreen('main-menu')" class="text-indigo-600 hover:text-indigo-800 font-semibold" data-translate-key="goBack">&larr; ì²˜ìŒìœ¼ë¡œ</button>
                <h2 class="text-2xl font-bold text-indigo-800" data-translate-key="expressionTitle">í‘œí˜„ í•™ìŠµ</h2>
                <div id="exp-counter" class="text-sm text-gray-500 font-medium"></div>
            </div>
            <div class="bg-indigo-50 p-6 rounded-xl mb-4">
                <p id="exp-question" class="text-xl text-center text-indigo-900 font-medium"></p>
            </div>
            <div id="exp-options" class="space-y-3"></div>
            <div id="exp-feedback" class="mt-4 text-center"></div>
             <div class="flex justify-end mt-6">
                <button id="next-exp" class="bg-indigo-500 hover:bg-indigo-600 text-white font-bold py-2 px-6 rounded-lg hidden" data-translate-key="nextQuestionBtn">ë‹¤ìŒ ë¬¸ì œ &rarr;</button>
            </div>
        </div>

        <div id="grammar-app" class="hidden">
             <div class="flex justify-between items-center mb-4">
                 <button onclick="showScreen('main-menu')" class="text-emerald-600 hover:text-emerald-800 font-semibold" data-translate-key="goBack">&larr; ì²˜ìŒìœ¼ë¡œ</button>
                <h2 class="text-2xl font-bold text-emerald-800" data-translate-key="grammarTitle">ë¬¸ë²• í•™ìŠµ</h2>
                <div id="grammar-counter" class="text-sm text-gray-500 font-medium"></div>
            </div>
            <div class="bg-emerald-50 p-5 rounded-xl border border-emerald-200">
                <h3 id="grammar-rule" class="text-xl font-bold text-emerald-900 mb-2"></h3>
                <p id="grammar-explanation" class="text-gray-700 mb-3"></p>
                <div id="grammar-examples" class="text-gray-600 italic"></div>
            </div>
            <div class="mt-6">
                <p class="font-semibold mb-2 text-center" data-translate-key="quiz">ì—°ìŠµ ë¬¸ì œ</p>
                <div class="bg-gray-100 p-4 rounded-lg mb-3">
                    <p id="grammar-question" class="text-lg text-center text-gray-800"></p>
                </div>
                <div id="grammar-options" class="space-y-2"></div>
                <div id="grammar-feedback" class="mt-3 text-center"></div>
            </div>
             <div class="flex justify-between mt-6">
                <button id="prev-grammar" class="bg-gray-300 hover:bg-gray-400 text-gray-800 font-bold py-2 px-6 rounded-lg" data-translate-key="prevBtn">&larr; ì´ì „</button>
                <button id="next-grammar" class="bg-emerald-500 hover:bg-emerald-600 text-white font-bold py-2 px-6 rounded-lg" data-translate-key="nextBtn">ë‹¤ìŒ &rarr;</button>
            </div>
        </div>

    </div>

    <script>
        // --- TRANSLATION DATA ---
        const uiStrings = {
            mainTitle: { ko: 'íŒ¬ì—ê²Œ ì“°ëŠ” í¸ì§€', vi: 'ThÆ° gá»­i ngÆ°á»i hÃ¢m má»™', ja: 'ãƒ•ã‚¡ãƒ³ã¸ã®æ‰‹ç´™' },
            mainSubtitle: { ko: 'í•œêµ­ì–´ í•™ìŠµ', vi: 'Há»c tiáº¿ng HÃ n', ja: 'éŸ“å›½èªå­¦ç¿’' },
            vocabTitle: { ko: 'ì–´íœ˜ í•™ìŠµ', vi: 'Há»c tá»« vá»±ng', ja: 'èªå½™å­¦ç¿’' },
            expressionTitle: { ko: 'í‘œí˜„ í•™ìŠµ', vi: 'Há»c biá»ƒu hiá»‡n', ja: 'è¡¨ç¾å­¦ç¿’' },
            grammarTitle: { ko: 'ë¬¸ë²• í•™ìŠµ', vi: 'Há»c ngá»¯ phÃ¡p', ja: 'æ–‡æ³•å­¦ç¿’' },
            goBack: { ko: 'ì²˜ìŒìœ¼ë¡œ', vi: 'Trá»Ÿ vá»', ja: 'æœ€åˆã¸' },
            examplePrefix: { ko: 'ì˜ˆë¬¸)', vi: 'VÃ­ dá»¥)', ja: 'ä¾‹æ–‡)' },
            prevBtn: { ko: 'ì´ì „', vi: 'TrÆ°á»›c', ja: 'å‰ã¸' },
            nextBtn: { ko: 'ë‹¤ìŒ', vi: 'Sau', ja: 'æ¬¡ã¸' },
            cardView: { ko: 'ì¹´ë“œ ë³´ê¸°', vi: 'Xem tháº»', ja: 'ã‚«ãƒ¼ãƒ‰è¡¨ç¤º' },
            gridView: { ko: 'ì „ì²´ ë³´ê¸°', vi: 'Xem táº¥t cáº£', ja: 'ä¸€è¦§è¡¨ç¤º' },
            nextQuestionBtn: { ko: 'ë‹¤ìŒ ë¬¸ì œ', vi: 'CÃ¢u tiáº¿p theo', ja: 'æ¬¡ã®å•é¡Œ' },
            quiz: { ko: 'ì—°ìŠµ ë¬¸ì œ', vi: 'BÃ i táº­p', ja: 'ç·´ç¿’å•é¡Œ' },
            correct: { ko: 'ì •ë‹µì…ë‹ˆë‹¤!', vi: 'ÄÃºng rá»“i!', ja: 'æ­£è§£ã§ã™ï¼' },
            incorrect: { ko: 'í‹€ë ¸ìŠµë‹ˆë‹¤.', vi: 'Sai rá»“i.', ja: 'é–“é•ã„ã§ã™ã€‚' },
            incorrect_answer: { ko: 'í‹€ë ¸ìŠµë‹ˆë‹¤. ì •ë‹µì€', vi: 'Sai rá»“i. ÄÃ¡p Ã¡n Ä‘Ãºng lÃ ', ja: 'é–“é•ã„ã§ã™ã€‚æ­£è§£ã¯' },
            is: { ko: 'ì…ë‹ˆë‹¤.', vi: 'lÃ .', ja: 'ã§ã™ã€‚' }
        };

        const vocabularyData = [
            { korean: 'íŒ¬', vi: 'NgÆ°á»i hÃ¢m má»™', ja: 'ãƒ•ã‚¡ãƒ³', category: { ko: 'ì£¼ì œ ê´€ë ¨', vi: 'Chá»§ Ä‘á» liÃªn quan', ja: 'ãƒ†ãƒ¼ãƒé–¢é€£' }, example: { ko: 'ì €ëŠ” ê·¸ ê°€ìˆ˜ì˜ ì˜¤ëœ íŒ¬ì´ì—ìš”.', vi: 'TÃ´i lÃ  fan lÃ¢u nÄƒm cá»§a ca sÄ© Ä‘Ã³.', ja: 'ç§ã¯ãã®æ­Œæ‰‹ã®é•·å¹´ã®ãƒ•ã‚¡ãƒ³ã§ã™ã€‚' } },
            { korean: 'ìŠ¤íƒ€', vi: 'NgÃ´i sao', ja: 'ã‚¹ã‚¿ãƒ¼', category: { ko: 'ì£¼ì œ ê´€ë ¨', vi: 'Chá»§ Ä‘á» liÃªn quan', ja: 'ãƒ†ãƒ¼ãƒé–¢é€£' }, example: { ko: 'ê·¸ëŠ” ì„¸ê³„ì ì¸ ìŠ¤íƒ€ê°€ ë˜ì—ˆë‹¤.', vi: 'Anh áº¥y Ä‘Ã£ trá»Ÿ thÃ nh má»™t ngÃ´i sao tháº¿ giá»›i.', ja: 'å½¼ã¯ä¸–ç•Œçš„ãªã‚¹ã‚¿ãƒ¼ã«ãªã£ãŸã€‚' } },
            { korean: 'ë°ë·”', vi: 'Ra máº¯t', ja: 'ãƒ‡ãƒ“ãƒ¥ãƒ¼', category: { ko: 'ì£¼ì œ ê´€ë ¨', vi: 'Chá»§ Ä‘á» liÃªn quan', ja: 'ãƒ†ãƒ¼ãƒé–¢é€£' }, example: { ko: 'ë°ë·” 10ì£¼ë…„ì„ ì¶•í•˜í•©ë‹ˆë‹¤.', vi: 'ChÃºc má»«ng ká»· niá»‡m 10 nÄƒm ra máº¯t.', ja: 'ãƒ‡ãƒ“ãƒ¥ãƒ¼10å‘¨å¹´ãŠã‚ã§ã¨ã†ã”ã–ã„ã¾ã™ã€‚' } },
            { korean: 'í•´ì²´', vi: 'Tan rÃ£', ja: 'è§£æ•£', category: { ko: 'ì£¼ì œ ê´€ë ¨', vi: 'Chá»§ Ä‘á» liÃªn quan', ja: 'ãƒ†ãƒ¼ãƒé–¢é€£' }, example: { ko: 'ê·¸ë£¹ì´ í•´ì²´ëœë‹¤ëŠ” ì†Œì‹ì— ìŠ¬íë‹¤.', vi: 'TÃ´i Ä‘Ã£ buá»“n khi nghe tin nhÃ³m tan rÃ£.', ja: 'ã‚°ãƒ«ãƒ¼ãƒ—ãŒè§£æ•£ã™ã‚‹ã¨ã„ã†ãƒ‹ãƒ¥ãƒ¼ã‚¹ã«æ‚²ã—ã‹ã£ãŸã€‚' } },
            { korean: 'ì…ëŒ€', vi: 'Nháº­p ngÅ©', ja: 'å…¥éšŠ', category: { ko: 'ì£¼ì œ ê´€ë ¨', vi: 'Chá»§ Ä‘á» liÃªn quan', ja: 'ãƒ†ãƒ¼ãƒé–¢é€£' }, example: { ko: 'ê·¸ëŠ” ë‹¤ìŒ ë‹¬ì— êµ°ëŒ€ì— ì…ëŒ€í•œë‹¤.', vi: 'Anh áº¥y sáº½ nháº­p ngÅ© vÃ o thÃ¡ng tá»›i.', ja: 'å½¼ã¯æ¥æœˆè»éšŠã«å…¥éšŠã™ã‚‹ã€‚' } },
            { korean: 'ì „ì—­', vi: 'Xuáº¥t ngÅ©', ja: 'é™¤éšŠ', category: { ko: 'ì£¼ì œ ê´€ë ¨', vi: 'Chá»§ Ä‘á» liÃªn quan', ja: 'ãƒ†ãƒ¼ãƒé–¢é€£' }, example: { ko: 'ì „ì—­í•  ë•Œê¹Œì§€ ê¸°ë‹¤ë ¤ ì£¼ì„¸ìš”.', vi: 'HÃ£y Ä‘á»£i cho Ä‘áº¿n khi tÃ´i xuáº¥t ngÅ© nhÃ©.', ja: 'é™¤éšŠã™ã‚‹ã¾ã§å¾…ã£ã¦ãã ã•ã„ã€‚' } },
            { korean: 'ì‘ì›í•˜ë‹¤', vi: 'Cá»• vÅ©, á»§ng há»™', ja: 'å¿œæ´ã™ã‚‹', category: { ko: 'ì‘ì› ê´€ë ¨', vi: 'Cá»• vÅ©', ja: 'å¿œæ´é–¢é€£' }, example: { ko: 'íŒ¬ë“¤ì˜ ì‘ì› ë•ë¶„ì— í˜ì´ ë‚¬ì–´ìš”.', vi: 'Nhá» sá»± cá»• vÅ© cá»§a ngÆ°á»i hÃ¢m má»™ mÃ  tÃ´i Ä‘Ã£ cÃ³ thÃªm sá»©c máº¡nh.', ja: 'ãƒ•ã‚¡ãƒ³ã®å¿œæ´ã®ãŠã‹ã’ã§å…ƒæ°—ãŒå‡ºã¾ã—ãŸã€‚' } },
            { korean: 'ì„±ì›', vi: 'Sá»± á»§ng há»™', ja: 'å£°æ´', category: { ko: 'ì‘ì› ê´€ë ¨', vi: 'Cá»• vÅ©', ja: 'å¿œæ´é–¢é€£' }, example: { ko: 'ì—¬ëŸ¬ë¶„ì˜ ì„±ì›ì— ì§„ì‹¬ìœ¼ë¡œ ê°ì‚¬í•©ë‹ˆë‹¤.', vi: 'ChÃ¢n thÃ nh cáº£m Æ¡n sá»± á»§ng há»™ cá»§a cÃ¡c báº¡n.', ja: 'çš†æ§˜ã®å£°æ´ã«å¿ƒã‹ã‚‰æ„Ÿè¬ã—ã¾ã™ã€‚' } },
            { korean: 'ì§€ì§€í•˜ë‹¤', vi: 'á»¦ng há»™', ja: 'æ”¯æŒã™ã‚‹', category: { ko: 'ì‘ì› ê´€ë ¨', vi: 'Cá»• vÅ©', ja: 'å¿œæ´é–¢é€£' }, example: { ko: 'ì–´ë–¤ ê²°ì •ì„ í•˜ë“  í•­ìƒ ì§€ì§€í• ê²Œìš”.', vi: 'DÃ¹ báº¡n quyáº¿t Ä‘á»‹nh tháº¿ nÃ o, tÃ´i cÅ©ng sáº½ luÃ´n á»§ng há»™.', ja: 'ã©ã‚“ãªæ±ºå®šã‚’ã—ã¦ã‚‚å¸¸ã«æ”¯æŒã—ã¾ã™ã€‚' } },
            { korean: 'ê°ë™ì ì´ë‹¤', vi: 'Cáº£m Ä‘á»™ng', ja: 'æ„Ÿå‹•çš„ã ', category: { ko: 'ê°ì • í‘œí˜„', vi: 'Biá»ƒu hiá»‡n cáº£m xÃºc', ja: 'æ„Ÿæƒ…è¡¨ç¾' }, example: { ko: 'íŒ¬ì˜ í¸ì§€ëŠ” ì •ë§ ê°ë™ì ì´ì—ˆì–´ìš”.', vi: 'Bá»©c thÆ° cá»§a fan tháº­t sá»± ráº¥t cáº£m Ä‘á»™ng.', ja: 'ãƒ•ã‚¡ãƒ³ã®æ‰‹ç´™ã¯æœ¬å½“ã«æ„Ÿå‹•çš„ã§ã—ãŸã€‚' } },
            { korean: 'ì•„ì‰½ë‹¤', vi: 'Tiáº¿c nuá»‘i', ja: 'æ®‹å¿µã ', category: { ko: 'ê°ì • í‘œí˜„', vi: 'Biá»ƒu hiá»‡n cáº£m xÃºc', ja: 'æ„Ÿæƒ…è¡¨ç¾' }, example: { ko: 'ì§ì ‘ ë§Œë‚˜ì§€ ëª»í•´ì„œ ì•„ì‰¬ì›Œìš”.', vi: 'TÃ´i ráº¥t tiáº¿c vÃ¬ khÃ´ng thá»ƒ gáº·p trá»±c tiáº¿p.', ja: 'ç›´æ¥ä¼šãˆãªãã¦æ®‹å¿µã§ã™ã€‚' } },
            { korean: 'ì„­ì„­í•˜ë‹¤', vi: 'Buá»“n, tháº¥t vá»ng', ja: 'åæ®‹æƒœã—ã„', category: { ko: 'ê°ì • í‘œí˜„', vi: 'Biá»ƒu hiá»‡n cáº£m xÃºc', ja: 'æ„Ÿæƒ…è¡¨ç¾' }, example: { ko: 'ê°‘ìê¸° ë– ë‚œë‹¤ê³  í•˜ë‹ˆ ì„­ì„­í•´ìš”.', vi: 'Nghe nÃ³i báº¡n Ä‘á»™t ngá»™t rá»i Ä‘i, tÃ´i cáº£m tháº¥y ráº¥t buá»“n.', ja: 'æ€¥ã«å»ã‚‹ã¨èã„ã¦åæ®‹æƒœã—ã„ã§ã™ã€‚' } },
            { korean: 'ëœ»ê¹Šë‹¤', vi: 'CÃ³ Ã½ nghÄ©a', ja: 'æ„ç¾©æ·±ã„', category: { ko: 'ê°ì • í‘œí˜„', vi: 'Biá»ƒu hiá»‡n cáº£m xÃºc', ja: 'æ„Ÿæƒ…è¡¨ç¾' }, example: { ko: 'ì—¬ëŸ¬ë¶„ê³¼ í•¨ê»˜í•œ ì‹œê°„ì€ ì •ë§ ëœ»ê¹Šì—ˆì–´ìš”.', vi: 'Thá»i gian bÃªn cÃ¡c báº¡n tháº­t sá»± ráº¥t Ã½ nghÄ©a.', ja: 'çš†ã•ã‚“ã¨ä¸€ç·’ã«éã”ã—ãŸæ™‚é–“ã¯æœ¬å½“ã«æ„ç¾©æ·±ã‹ã£ãŸã§ã™ã€‚' } },
            { korean: 'ë³´ë‹µí•˜ë‹¤', vi: 'Äá»n Ä‘Ã¡p', ja: 'å¿œãˆã‚‹', category: { ko: 'ê°ì • í‘œí˜„', vi: 'Biá»ƒu hiá»‡n cáº£m xÃºc', ja: 'æ„Ÿæƒ…è¡¨ç¾' }, example: { ko: 'ë°›ì€ ì‚¬ë‘ì— ë³´ë‹µí•˜ê¸° ìœ„í•´ ë…¸ë ¥í• ê²Œìš”.', vi: 'TÃ´i sáº½ ná»— lá»±c Ä‘á»ƒ Ä‘á»n Ä‘Ã¡p tÃ¬nh yÃªu thÆ°Æ¡ng Ä‘Ã£ nháº­n Ä‘Æ°á»£c.', ja: 'å—ã‘ãŸæ„›ã«å¿œãˆã‚‹ãŸã‚ã«åŠªåŠ›ã—ã¾ã™ã€‚' } },
            { korean: 'ì¶”ì–µ', vi: 'Ká»· niá»‡m', ja: 'æ€ã„å‡º', category: { ko: 'ê³¼ê±° íšŒìƒ', vi: 'Há»“i tÆ°á»Ÿng', ja: 'éå»å›æƒ³' }, example: { ko: 'ìš°ë¦¬ì˜ ì†Œì¤‘í•œ ì¶”ì–µì„ ìŠì§€ ë§ˆì„¸ìš”.', vi: 'Xin Ä‘á»«ng quÃªn nhá»¯ng ká»· niá»‡m quÃ½ giÃ¡ cá»§a chÃºng ta.', ja: 'ç§ãŸã¡ã®å¤§åˆ‡ãªæ€ã„å‡ºã‚’å¿˜ã‚Œãªã„ã§ãã ã•ã„ã€‚' } },
            { korean: 'ì´ˆì‹¬', vi: 'TÃ¢m nguyá»‡n ban Ä‘áº§u', ja: 'åˆå¿ƒ', category: { ko: 'ê³¼ê±° íšŒìƒ', vi: 'Há»“i tÆ°á»Ÿng', ja: 'éå»å›æƒ³' }, example: { ko: 'ì´ˆì‹¬ì„ ìƒì§€ ì•ŠëŠ” ê°€ìˆ˜ê°€ ë˜ê² ìŠµë‹ˆë‹¤.', vi: 'TÃ´i sáº½ trá»Ÿ thÃ nh má»™t ca sÄ© khÃ´ng bao giá» Ä‘Ã¡nh máº¥t tÃ¢m nguyá»‡n ban Ä‘áº§u.', ja: 'åˆå¿ƒã‚’å¿˜ã‚Œãªã„æ­Œæ‰‹ã«ãªã‚Šã¾ã™ã€‚' } },
            { korean: 'ë™ë°˜ì', vi: 'Báº¡n Ä‘á»“ng hÃ nh', ja: 'ä¼´ä¾¶', category: { ko: 'ìƒí™©ë³„ ì–´íœ˜', vi: 'Tá»« vá»±ng theo tÃ¬nh huá»‘ng', ja: 'çŠ¶æ³åˆ¥èªå½™' }, example: { ko: 'í‰ìƒì˜ ë™ë°˜ìë¥¼ ë§Œë‚˜ ê²°í˜¼í•˜ê²Œ ëì–´ìš”.', vi: 'TÃ´i Ä‘Ã£ gáº·p Ä‘Æ°á»£c báº¡n Ä‘á»“ng hÃ nh cá»§a Ä‘á»i mÃ¬nh vÃ  káº¿t hÃ´n.', ja: 'ç”Ÿæ¶¯ã®ä¼´ä¾¶ã«å‡ºä¼šã„ã€çµå©šã™ã‚‹ã“ã¨ã«ãªã‚Šã¾ã—ãŸã€‚' } },
            { korean: 'êµ­ë°©ì˜ ì˜ë¬´', vi: 'NghÄ©a vá»¥ quÃ¢n sá»±', ja: 'å›½é˜²ã®ç¾©å‹™', category: { ko: 'ìƒí™©ë³„ ì–´íœ˜', vi: 'Tá»« vá»±ng theo tÃ¬nh huá»‘ng', ja: 'çŠ¶æ³åˆ¥èªå½™' }, example: { ko: 'êµ­ë°©ì˜ ì˜ë¬´ë¥¼ ë‹¤í•˜ê³  ëŒì•„ì˜¤ê² ìŠµë‹ˆë‹¤.', vi: 'TÃ´i sáº½ trá»Ÿ vá» sau khi hoÃ n thÃ nh nghÄ©a vá»¥ quÃ¢n sá»±.', ja: 'å›½é˜²ã®ç¾©å‹™ã‚’æœãŸã—ã¦æˆ»ã£ã¦ãã¾ã™ã€‚' } },
        ];
        // More data...
        const expressionData = [
            {
                question: { ko: 'ê°‘ì‘ìŠ¤ëŸ¬ìš´ ì†Œì‹ì„ ___ ë§ˆìŒì´ ë¬´ê²ìŠµë‹ˆë‹¤.', vi: '___ tin tá»©c Ä‘á»™t ngá»™t nÃ y, lÃ²ng tÃ´i náº·ng trÄ©u.', ja: 'çªç„¶ã®çŸ¥ã‚‰ã›ã‚’___ã€å¿ƒãŒé‡ã„ã§ã™ã€‚' },
                options: { ko: ['ì „í•˜ê²Œ ë˜ì–´', 'ë³´ê²Œ ë˜ì–´', 'ë“£ê²Œ ë˜ì–´'], vi: ['VÃ¬ pháº£i thÃ´ng bÃ¡o', 'VÃ¬ pháº£i tháº¥y', 'VÃ¬ pháº£i nghe'], ja: ['ãŠä¼ãˆã™ã‚‹ã“ã¨ã«ãªã‚Š', 'è¦‹ã‚‹ã“ã¨ã«ãªã‚Š', 'èãã“ã¨ã«ãªã‚Š'] },
                answer: 'ì „í•˜ê²Œ ë˜ì–´',
                explanation: { ko: "'ì†Œì‹ì„ ì „í•˜ë‹¤'ëŠ” 'to deliver news'ë¼ëŠ” ëœ»ì…ë‹ˆë‹¤. '-(ìœ¼)ã„´/ê²Œ ë˜ë‹¤'ëŠ” ì–´ë–¤ ìƒí™©ì´ ë˜ì—ˆìŒì„ ë‚˜íƒ€ëƒ…ë‹ˆë‹¤.", vi: "'ì†Œì‹ì„ ì „í•˜ë‹¤' cÃ³ nghÄ©a lÃ  'truyá»n tin'. '-(ìœ¼)ã„´/ê²Œ ë˜ë‹¤' thá»ƒ hiá»‡n má»™t tÃ¬nh huá»‘ng nÃ o Ä‘Ã³ Ä‘Ã£ xáº£y ra.", ja: "ã€Œì†Œì‹ì„ ì „í•˜ë‹¤ã€ã¯ã€ŒçŸ¥ã‚‰ã›ã‚’ä¼ãˆã‚‹ã€ã¨ã„ã†æ„å‘³ã§ã™ã€‚ã€Œ-(ìœ¼)ã„´/ê²Œ ë˜ë‹¤ã€ã¯ã‚ã‚‹çŠ¶æ³ã«ãªã£ãŸã“ã¨ã‚’è¡¨ã—ã¾ã™ã€‚" }
            },
            {
                question: { ko: 'ì—¬ëŸ¬ë¶„ì˜ ì•„ë‚Œì—†ëŠ” ì‚¬ë‘ ___ í˜ë“  ì‹œê°„ì„ ì´ê²¨ ë‚¼ ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤.', vi: '___ tÃ¬nh yÃªu thÆ°Æ¡ng vÃ´ bá» báº¿n cá»§a cÃ¡c báº¡n, tÃ´i Ä‘Ã£ cÃ³ thá»ƒ vÆ°á»£t qua khoáº£ng thá»i gian khÃ³ khÄƒn.', ja: 'çš†æ§˜ã®æƒœã—ã¿ãªã„æ„›ã®___ã€å¤§å¤‰ãªæ™‚æœŸã‚’ä¹—ã‚Šè¶Šãˆã‚‹ã“ã¨ãŒã§ãã¾ã—ãŸã€‚' },
                options: { ko: ['ë•Œë¬¸ì—', 'ë•ë¶„ì—', 'ëŒ€ì‹ ì—'], vi: ['VÃ¬ (tiÃªu cá»±c)', 'Nhá» cÃ³', 'Thay vÃ¬'], ja: ['ã›ã„ã§', 'ãŠã‹ã’ã§', 'ä»£ã‚ã‚Šã«'] },
                answer: 'ë•ë¶„ì—',
                explanation: { ko: "'ë•ë¶„ì—'ëŠ” ê¸ì •ì ì¸ ì›ì¸ì´ë‚˜ ì´ìœ ë¥¼ ë‚˜íƒ€ë‚¼ ë•Œ ì‚¬ìš©í•©ë‹ˆë‹¤. 'Thanks to...'", vi: "'ë•ë¶„ì—' Ä‘Æ°á»£c sá»­ dá»¥ng Ä‘á»ƒ chá»‰ nguyÃªn nhÃ¢n hoáº·c lÃ½ do tÃ­ch cá»±c. 'Nhá» cÃ³...'", ja: "ã€Œë•ë¶„ì—ã€ã¯è‚¯å®šçš„ãªåŸå› ã‚„ç†ç”±ã‚’è¡¨ã™ã¨ãã«ä½¿ã„ã¾ã™ã€‚ã€Œï½ã®ãŠã‹ã’ã§ã€" }
            },
            {
                question: { ko: 'ì²˜ìŒ ë¬´ëŒ€ì— ì„°ë˜ ë•Œê°€ ___.', vi: 'Láº§n Ä‘áº§u tiÃªn Ä‘á»©ng trÃªn sÃ¢n kháº¥u cá»© nhÆ° thá»ƒ ___.', ja: 'åˆã‚ã¦ã‚¹ãƒ†ãƒ¼ã‚¸ã«ç«‹ã£ãŸæ™‚ãŒ___ã‚ˆã†ã§ã™ã€‚' },
                options: { ko: ['ë‚´ì¼ ê°™ì•„ìš”', 'ì–´ì œ ê°™ì•„ìš”', 'ì—Šê·¸ì œ ê°™ì•„ìš”'], vi: ['ngÃ y mai', 'hÃ´m qua', 'hÃ´m kia'], ja: ['æ˜æ—¥ã®ã‚ˆã†', 'æ˜¨æ—¥ã®ã‚ˆã†', 'ä¸€æ˜¨æ—¥ã®ã‚ˆã†'] },
                answer: 'ì—Šê·¸ì œ ê°™ì•„ìš”',
                explanation: { ko: "'ì—Šê·¸ì œ ê°™ë‹¤'ëŠ” ì‹œê°„ì´ ë§¤ìš° ë¹¨ë¦¬ í˜ë €ìŒì„ ë¹„ìœ ì ìœ¼ë¡œ í‘œí˜„í•˜ëŠ” ë§ì…ë‹ˆë‹¤.", vi: "'ì—Šê·¸ì œ ê°™ë‹¤' lÃ  má»™t biá»ƒu hiá»‡n vÃ­ von cho tháº¥y thá»i gian trÃ´i qua ráº¥t nhanh.", ja: "ã€Œì—Šê·¸ì œ ê°™ë‹¤ã€ã¯æ™‚é–“ãŒéå¸¸ã«æ—©ãéããŸã“ã¨ã‚’æ¯”å–©çš„ã«è¡¨ç¾ã™ã‚‹è¨€è‘‰ã§ã™ã€‚" }
            },
        ];
        const grammarData = [
            {
                rule: '-ê³  -ì•„ì„œ',
                explanation: { ko: 'ë‘ ê°€ì§€ ì´ìƒì˜ ì´ìœ ë‚˜ ì›ì¸ì„ ë‚˜ì—´í•  ë•Œ ì‚¬ìš©í•©ë‹ˆë‹¤. ê°ì •ì˜ ì´ìœ ë¥¼ ë§í•  ë•Œ ìì£¼ ì“°ì…ë‹ˆë‹¤.', vi: 'ÄÆ°á»£c sá»­ dá»¥ng khi liá»‡t kÃª hai hoáº·c nhiá»u lÃ½ do hoáº·c nguyÃªn nhÃ¢n. ThÆ°á»ng Ä‘Æ°á»£c dÃ¹ng Ä‘á»ƒ nÃ³i vá» lÃ½ do cá»§a cáº£m xÃºc.', ja: 'äºŒã¤ä»¥ä¸Šã®ç†ç”±ã‚„åŸå› ã‚’ä¸¦ã¹ã‚‹ã¨ãã«ä½¿ã„ã¾ã™ã€‚æ„Ÿæƒ…ã®ç†ç”±ã‚’è¿°ã¹ã‚‹ã¨ãã«ã‚ˆãä½¿ã‚ã‚Œã¾ã™ã€‚' },
                examples: {
                    ko: ['í•¨ê»˜ ì›ƒê³  ìš¸ì–´ ì¤˜ì„œ ì •ë§ ê³ ë§ˆì› ì–´ìš”.', 'í•­ìƒ ì‘ì›í•´ ì£¼ì‹œê³  ì‚¬ë‘í•´ ì£¼ì…”ì„œ í–‰ë³µí–ˆìŠµë‹ˆë‹¤.'],
                    vi: ['Cáº£m Æ¡n báº¡n ráº¥t nhiá»u vÃ¬ Ä‘Ã£ cÃ¹ng cÆ°á»i cÃ¹ng khÃ³c.', 'TÃ´i Ä‘Ã£ ráº¥t háº¡nh phÃºc vÃ¬ cÃ¡c báº¡n Ä‘Ã£ luÃ´n á»§ng há»™ vÃ  yÃªu thÆ°Æ¡ng tÃ´i.'],
                    ja: ['ä¸€ç·’ã«ç¬‘ã£ã¦æ³£ã„ã¦ãã‚Œã¦æœ¬å½“ã«ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã—ãŸã€‚', 'ã„ã¤ã‚‚å¿œæ´ã—ã¦æ„›ã—ã¦ãã ã•ã£ã¦å¹¸ã›ã§ã—ãŸã€‚']
                },
                quiz: {
                    question: { ko: 'ë…¸ë˜ë¥¼ ë“¤ì–´ ì£¼ì‹œê³  ___ ì •ë§ ê°ì‚¬í•©ë‹ˆë‹¤.', vi: 'Cáº£m Æ¡n báº¡n ráº¥t nhiá»u vÃ¬ Ä‘Ã£ láº¯ng nghe bÃ i hÃ¡t vÃ  ___.', ja: 'æ­Œã‚’è´ã„ã¦ãã ã•ã‚Šã€___æœ¬å½“ã«ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã™ã€‚' },
                    options: { ko: ['í˜ì´ ë˜ì–´ ì£¼ì…”ì„œ', 'í˜ì´ ë˜ì–´ ì£¼ë ¤ê³ ', 'í˜ì´ ë˜ì–´ ì£¼ì§€ë§Œ'], vi: ['vÃ¬ Ä‘Ã£ lÃ  sá»©c máº¡nh cá»§a tÃ´i', 'Ä‘á»ƒ trá»Ÿ thÃ nh sá»©c máº¡nh', 'tuy lÃ  sá»©c máº¡nh'], ja: ['åŠ›ã«ãªã£ã¦ãã ã•ã£ã¦', 'åŠ›ã«ãªã‚ã†ã¨', 'åŠ›ã«ãªã‚Šã¾ã™ãŒ'] },
                    answer: 'í˜ì´ ë˜ì–´ ì£¼ì…”ì„œ'
                }
            },
            {
                rule: '-(ìœ¼)ã„¹ í…Œë‹ˆ(ê¹Œ)',
                explanation: { ko: 'ë§í•˜ëŠ” ì‚¬ëŒì˜ ê°•í•œ ì˜ì§€ë‚˜ ì¶”ì¸¡ì„ ë‚˜íƒ€ë‚´ë©°, ë“£ëŠ” ì‚¬ëŒì—ê²Œ ë¬´ì–¸ê°€ë¥¼ ì œì•ˆí•˜ê±°ë‚˜ ê¶Œìœ í•  ë•Œ ì‚¬ìš©í•©ë‹ˆë‹¤.', vi: 'Thá»ƒ hiá»‡n Ã½ chÃ­ máº¡nh máº½ hoáº·c sá»± phá»ng Ä‘oÃ¡n cá»§a ngÆ°á»i nÃ³i, vÃ  Ä‘Æ°á»£c sá»­ dá»¥ng khi Ä‘á» nghá»‹ hoáº·c khuyÃªn nhá»§ ngÆ°á»i nghe Ä‘iá»u gÃ¬ Ä‘Ã³.', ja: 'è©±ã—æ‰‹ã®å¼·ã„æ„å¿—ã‚„æ¨æ¸¬ã‚’è¡¨ã—ã€èãæ‰‹ã«ä½•ã‹ã‚’ææ¡ˆã—ãŸã‚Šå‹§ã‚ãŸã‚Šã™ã‚‹ã¨ãã«ä½¿ã„ã¾ã™ã€‚' },
                examples: {
                    ko: ['ì €ëŠ” ì˜ ë‹¤ë…€ì˜¬ í…Œë‹ˆ ê±±ì •í•˜ì§€ ë§ˆì„¸ìš”.', 'ë” ë©‹ì§„ ëª¨ìŠµìœ¼ë¡œ ëŒì•„ì˜¬ í…Œë‹ˆ ì¡°ê¸ˆë§Œ ê¸°ë‹¤ë ¤ ì£¼ì„¸ìš”.'],
                    vi: ['TÃ´i sáº½ Ä‘i rá»“i vá» bÃ¬nh an nÃªn Ä‘á»«ng lo láº¯ng.', 'TÃ´i sáº½ trá»Ÿ láº¡i vá»›i hÃ¬nh áº£nh tuyá»‡t vá»i hÆ¡n nÃªn hÃ£y Ä‘á»£i má»™t chÃºt nhÃ©.'],
                    ja: ['ç§ã¯ç„¡äº‹ã«è¡Œã£ã¦ãã¾ã™ã‹ã‚‰ã€å¿ƒé…ã—ãªã„ã§ãã ã•ã„ã€‚', 'ã‚‚ã£ã¨ç´ æ•µãªå§¿ã§æˆ»ã£ã¦ãã¾ã™ã‹ã‚‰ã€å°‘ã—ã ã‘å¾…ã£ã¦ã„ã¦ãã ã•ã„ã€‚']
                },
                quiz: {
                    question: { ko: 'ì œê°€ ê³§ ëŒì•„ì˜¬ ___ ë„ˆë¬´ ìŠ¬í¼í•˜ì§€ ë§ˆì„¸ìš”.', vi: 'TÃ´i sáº½ sá»›m trá»Ÿ láº¡i ___ Ä‘á»«ng quÃ¡ Ä‘au buá»“n.', ja: 'ç§ãŒã™ãæˆ»ã£ã¦ãã‚‹___ã€ã‚ã¾ã‚Šæ‚²ã—ã¾ãªã„ã§ãã ã•ã„ã€‚' },
                    options: { ko: ['í…Œë‹ˆ', 'í…ë°', 'í…Œë„'], vi: ['nÃªn', 'cháº¯c lÃ ', 'dÃ¹'], ja: ['ã‹ã‚‰', 'ã¯ãšãªã®ã«', 'ã¦ã‚‚'] },
                    answer: 'í…Œë‹ˆ'
                }
            },
        ];

        // --- GLOBAL STATE ---
        let currentLang = 'ko';
        let currentVocabView = 'card';
        // ... (rest of the state variables)
        let currentScreen = 'main-menu';
        let currentVocabIndex = 0;
        let currentExpIndex = 0;
        let currentGrammarIndex = 0;

        // --- DOM ELEMENTS ---
        const allScreens = document.querySelectorAll('#app-container > div[id]');
        const screens = {
            'main-menu': document.getElementById('main-menu'),
            'vocab-app': document.getElementById('vocab-app'),
            'expression-app': document.getElementById('expression-app'),
            'grammar-app': document.getElementById('grammar-app')
        };
        const vocabCardView = document.getElementById('vocab-card-view');
        const vocabGridView = document.getElementById('vocab-grid-view');
        const cardViewBtn = document.getElementById('card-view-btn');
        const gridViewBtn = document.getElementById('grid-view-btn');
        // ... (rest of the DOM elements)
        const flashcard = document.getElementById('flashcard');
        const vocabCategory = document.getElementById('vocab-category');
        const vocabKorean = document.getElementById('vocab-korean');
        const vocabTranslation = document.getElementById('vocab-translation');
        const vocabExample = document.getElementById('vocab-example');
        const prevVocabBtn = document.getElementById('prev-vocab');
        const nextVocabBtn = document.getElementById('next-vocab');
        const vocabCounter = document.getElementById('vocab-counter');
        const expQuestion = document.getElementById('exp-question');
        const expOptionsContainer = document.getElementById('exp-options');
        const expFeedback = document.getElementById('exp-feedback');
        const nextExpBtn = document.getElementById('next-exp');
        const expCounter = document.getElementById('exp-counter');
        const grammarRule = document.getElementById('grammar-rule');
        const grammarExplanation = document.getElementById('grammar-explanation');
        const grammarExamples = document.getElementById('grammar-examples');
        const grammarQuestion = document.getElementById('grammar-question');
        const grammarOptionsContainer = document.getElementById('grammar-options');
        const grammarFeedback = document.getElementById('grammar-feedback');
        const prevGrammarBtn = document.getElementById('prev-grammar');
        const nextGrammarBtn = document.getElementById('next-grammar');
        const grammarCounter = document.getElementById('grammar-counter');

        // --- FUNCTIONS ---
        function setLanguage(lang) {
            currentLang = lang;
            document.documentElement.className = `lang-${lang}`;
            
            // Update active button
            document.querySelectorAll('.lang-button').forEach(btn => {
                btn.classList.remove('active');
            });
            document.querySelector(`.lang-button:nth-child(${['ko', 'vi', 'ja'].indexOf(lang) + 1})`).classList.add('active');

            // Translate all static UI text
            document.querySelectorAll('[data-translate-key]').forEach(el => {
                const key = el.dataset.translateKey;
                if (uiStrings[key] && uiStrings[key][currentLang]) {
                    el.textContent = uiStrings[key][currentLang];
                }
            });

            // Re-render current screen with new language
            switch (currentScreen) {
                case 'vocab-app':
                    renderVocabApp();
                    break;
                case 'expression-app':
                    loadExpression(currentExpIndex);
                    break;
                case 'grammar-app':
                    loadGrammar(currentGrammarIndex);
                    break;
            }
        }
        
        function showScreen(screenId) {
            allScreens.forEach(screen => screen.classList.add('hidden'));
            screens[screenId].classList.remove('hidden');
            currentScreen = screenId;

            if (screenId === 'vocab-app') initVocabApp();
            if (screenId === 'expression-app') initExpressionApp();
            if (screenId === 'grammar-app') initGrammarApp();
        }

        // --- Vocabulary App Logic ---
        function initVocabApp() {
            currentVocabIndex = 0;
            setVocabView('card');
        }

        function setVocabView(view) {
            currentVocabView = view;
            if (view === 'card') {
                vocabCardView.classList.remove('hidden');
                vocabGridView.classList.add('hidden');
                cardViewBtn.classList.add('bg-white', 'text-sky-800', 'shadow-sm');
                cardViewBtn.classList.remove('text-gray-600');
                gridViewBtn.classList.add('text-gray-600');
                gridViewBtn.classList.remove('bg-white', 'text-sky-800', 'shadow-sm');
                loadCardView(currentVocabIndex);
            } else {
                vocabCardView.classList.add('hidden');
                vocabGridView.classList.remove('hidden');
                gridViewBtn.classList.add('bg-white', 'text-sky-800', 'shadow-sm');
                gridViewBtn.classList.remove('text-gray-600');
                cardViewBtn.classList.add('text-gray-600');
                cardViewBtn.classList.remove('bg-white', 'text-sky-800', 'shadow-sm');
                loadGridView();
            }
        }
        
        function renderVocabApp() {
             if (currentVocabView === 'card') {
                 loadCardView(currentVocabIndex);
             } else {
                 loadGridView();
             }
        }

        function loadCardView(index) {
            flashcard.classList.remove('is-flipped');
            const vocab = vocabularyData[index];
            vocabCategory.textContent = vocab.category[currentLang];
            vocabKorean.textContent = vocab.korean;
            vocabTranslation.textContent = vocab[currentLang];
            vocabExample.textContent = vocab.example[currentLang];
            vocabCounter.textContent = `${index + 1} / ${vocabularyData.length}`;
            prevVocabBtn.disabled = index === 0;
            nextVocabBtn.disabled = index === vocabularyData.length - 1;
        }

        function loadGridView() {
            vocabGridView.innerHTML = '';
            vocabularyData.forEach(vocab => {
                const card = document.createElement('div');
                card.className = "bg-sky-50 border border-sky-200 rounded-lg p-3 text-center";
                card.innerHTML = `
                    <p class="font-bold text-sky-900">${vocab.korean}</p>
                    <p class="text-sm text-gray-700">${vocab[currentLang]}</p>
                `;
                vocabGridView.appendChild(card);
            });
        }
        
        flashcard.addEventListener('click', () => flashcard.classList.toggle('is-flipped'));
        prevVocabBtn.addEventListener('click', () => { if (currentVocabIndex > 0) loadCardView(--currentVocabIndex); });
        nextVocabBtn.addEventListener('click', () => { if (currentVocabIndex < vocabularyData.length - 1) loadCardView(++currentVocabIndex); });


        // --- Expression App Logic ---
        function initExpressionApp() {
            currentExpIndex = 0;
            loadExpression(currentExpIndex);
        }

        function loadExpression(index) {
            const exp = expressionData[index];
            expQuestion.textContent = exp.question[currentLang];
            expOptionsContainer.innerHTML = '';
            
            exp.options.ko.forEach((opt_ko, i) => {
                const button = document.createElement('button');
                button.className = "quiz-option w-full text-left p-4 rounded-lg border-2 border-indigo-200 bg-white text-indigo-800 font-semibold";
                button.textContent = exp.options[currentLang][i];
                button.dataset.answerKey = opt_ko; // Store Korean answer as the key
                button.onclick = () => checkExpressionAnswer(button, exp.answer, exp.explanation);
                expOptionsContainer.appendChild(button);
            });

            expFeedback.innerHTML = '';
            nextExpBtn.classList.add('hidden');
            expCounter.textContent = `${index + 1} / ${expressionData.length}`;
        }
        
        function checkExpressionAnswer(selectedButton, correct, explanation) {
            const selected = selectedButton.dataset.answerKey;
            const options = expOptionsContainer.querySelectorAll('button');
            options.forEach(option => {
                option.disabled = true;
                if (option.dataset.answerKey === correct) {
                    option.classList.remove('border-indigo-200', 'bg-white');
                    option.classList.add('border-green-500', 'bg-green-100');
                }
            });

            if (selected === correct) {
                expFeedback.innerHTML = `<p class="text-green-600 font-bold">${uiStrings.correct[currentLang]}</p>`;
            } else {
                selectedButton.classList.remove('border-indigo-200', 'bg-white');
                selectedButton.classList.add('border-red-500', 'bg-red-100');
                expFeedback.innerHTML = `<p class="text-red-600 font-bold">${uiStrings.incorrect[currentLang]}</p><p class="text-sm text-gray-600 mt-1">${explanation[currentLang]}</p>`;
            }
            if (currentExpIndex < expressionData.length - 1) {
                nextExpBtn.classList.remove('hidden');
            }
        }

        nextExpBtn.addEventListener('click', () => loadExpression(++currentExpIndex));

        // --- Grammar App Logic ---
        function initGrammarApp() {
            currentGrammarIndex = 0;
            loadGrammar(currentGrammarIndex);
        }

        function loadGrammar(index) {
            const grammar = grammarData[index];
            grammarRule.textContent = grammar.rule;
            grammarExplanation.textContent = grammar.explanation[currentLang];
            grammarExamples.innerHTML = grammar.examples[currentLang].map(ex => `<p>ì˜ˆ) ${ex}</p>`).join('');
            
            const quiz = grammar.quiz;
            grammarQuestion.textContent = quiz.question[currentLang];
            grammarOptionsContainer.innerHTML = '';

            quiz.options.ko.forEach((opt_ko, i) => {
                 const button = document.createElement('button');
                button.className = "quiz-option w-full text-left p-3 rounded-lg border-2 border-emerald-200 bg-white text-emerald-800";
                button.textContent = quiz.options[currentLang][i];
                button.dataset.answerKey = opt_ko;
                button.onclick = () => checkGrammarAnswer(button, quiz.answer);
                grammarOptionsContainer.appendChild(button);
            });

            grammarFeedback.innerHTML = '';
            grammarCounter.textContent = `${index + 1} / ${grammarData.length}`;
            prevGrammarBtn.disabled = index === 0;
            nextGrammarBtn.disabled = index === grammarData.length - 1;
        }
        
        function checkGrammarAnswer(selectedButton, correct) {
            const selected = selectedButton.dataset.answerKey;
            const options = grammarOptionsContainer.querySelectorAll('button');
            options.forEach(option => {
                 option.disabled = true;
                if (option.dataset.answerKey === correct) {
                    option.classList.remove('border-emerald-200', 'bg-white');
                    option.classList.add('border-green-500', 'bg-green-100');
                }
            });

            if (selected === correct) {
                grammarFeedback.innerHTML = `<p class="text-green-600 font-bold">${uiStrings.correct[currentLang]}</p>`;
            } else {
                selectedButton.classList.remove('border-emerald-200', 'bg-white');
                selectedButton.classList.add('border-red-500', 'bg-red-100');
                const correctOptionText = options.find(opt => opt.dataset.answerKey === correct).textContent;
                grammarFeedback.innerHTML = `<p class="text-red-600 font-bold">${uiStrings.incorrect_answer[currentLang]} '${correctOptionText}'${uiStrings.is[currentLang]}</p>`;
            }
        }

        prevGrammarBtn.addEventListener('click', () => { if (currentGrammarIndex > 0) loadGrammar(--currentGrammarIndex); });
        nextGrammarBtn.addEventListener('click', () => { if (currentGrammarIndex < grammarData.length - 1) loadGrammar(++currentGrammarIndex); });

        // Initialize with default language
        setLanguage('ko');

    </script>
</body>
</html>

